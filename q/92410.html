<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::92410</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>114</td><td>Ruby</td><td>240529T232819Z</td><td><a href="https://codegolf.stackexchange.com/questions/92410/a-cube-of-text%e1%9e%b5/273356#273356">Level Ri</a></td></tr>
<tr d-ix="1"><td>013</td><td>Vyxal</td><td>240530T205336Z</td><td><a href="https://codegolf.stackexchange.com/questions/92410/a-cube-of-text%e1%9e%b5/273361#273361">emanresu</a></td></tr>
<tr d-ix="2"><td>012</td><td>05AB1E</td><td>240528T091622Z</td><td><a href="https://codegolf.stackexchange.com/questions/92410/a-cube-of-text%e1%9e%b5/273329#273329">Kevin Cr</a></td></tr>
<tr d-ix="3"><td>078</td><td>Pyth</td><td>160909T212058Z</td><td><a href="https://codegolf.stackexchange.com/questions/92410/a-cube-of-text%e1%9e%b5/92835#92835">Steven H</a></td></tr>
<tr d-ix="4"><td>283</td><td>Java 7</td><td>160909T204122Z</td><td><a href="https://codegolf.stackexchange.com/questions/92410/a-cube-of-text%e1%9e%b5/92832#92832">QBrute</a></td></tr>
<tr d-ix="5"><td>144</td><td>Ruby</td><td>160907T000930Z</td><td><a href="https://codegolf.stackexchange.com/questions/92410/a-cube-of-text%e1%9e%b5/92444#92444">Value In</a></td></tr>
<tr d-ix="6"><td>198</td><td>Javascript</td><td>160906T225448Z</td><td><a href="https://codegolf.stackexchange.com/questions/92410/a-cube-of-text%e1%9e%b5/92427#92427">Hedi</a></td></tr>
<tr d-ix="7"><td>189</td><td>Python 2</td><td>160906T225718Z</td><td><a href="https://codegolf.stackexchange.com/questions/92410/a-cube-of-text%e1%9e%b5/92430#92430">Joshua d</a></td></tr>
<tr d-ix="8"><td>126</td><td>x86 IA32 machine code</td><td>160907T180733Z</td><td><a href="https://codegolf.stackexchange.com/questions/92410/a-cube-of-text%e1%9e%b5/92589#92589">anatolyg</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://www.ruby-lang.org/" rel="nofollow noreferrer">Ruby</a>, 114 bytes</h1>

<pre class="lang-ruby prettyprint-override"><code>-&gt;s{t=&quot;#{&quot; &quot;*w=2*v=s.size}
&quot;*u=w-1
v.times{|i|9.times{|j|t[[u*v,~v,u][j/3]-[1,~w,w][j%3]*~(j%-4/3*2)*i]=s[~i]}}
t}
</code></pre>
<p><a href="https://tio.run/##Nce7DsIgFADQvV/RYJroDbRpcXHAxc8gLEYwEE0beUV5/Dq6uJ3z8td3U6yRs02OoV1CPYLIFgjMjlZ/ZOkQeBbJ3IXR6ae0Ket8@tNkx7mHgGvAXnAzUUH4jGvE8beBCqh7M5DjRGE5gBbM8qpFKZ0rbfPO9oqjy3qT9/WhkGhf" rel="nofollow noreferrer" title="Ruby – Try It Online">Try it online!</a></p>
<h1><a href="https://www.ruby-lang.org/" rel="nofollow noreferrer">Ruby</a>, <s>120</s> 118 bytes</h1>

<pre class="lang-ruby prettyprint-override"><code>-&gt;s{w=2*v=s.size
t=(&quot; &quot;*w+$/)*w
v.times{|i|9.times{|j|t[[v*w+~v,~v*3,w-2][j/3]-[1,~w,w][j%3]*~(j%-4/3*2)*i]=s[~i]}}
t}
</code></pre>
<p><a href="https://tio.run/##NcoxDsIgGEDhvadoiE3aX2gjuDjg4jEIixEMRFMjFKIFro5d3N6XvPdy/VTNKzm7NXIKgbvRma9qPO9RiyDud9MAsQmjN0/l1mTS6Z82eSHCtpSASwCGI6FS2IlJIg64RBw3dUxC6W1HjhMDOoCR3IliZM6Nz/W1eNdqgS7zTd3nh0ay/gA" rel="nofollow noreferrer" title="Ruby – Try It Online">Try it online!</a></p>
<p>An anonymous function that takes the input string as an argument <code>s</code> and returns a string <code>t</code>.</p>
<p><strong>Explanation</strong></p>
<p>We start by setting up a field of <code>w=2*s.size</code> rows each of <code>w</code> spaces terminated by a newline.</p>
<p>We then substitute, character by character, nine copies of the input string, starting at the endpoint. There are 3 endpoints each with text in 3 different directions <code>x,y,z</code>. This is easier to handle than starting at the beginning, since there are 4 possible startpoints each with text either in 2 or 3 directions. Variable <code>i</code> denotes the distance from the endpoint and <code>s[~i]</code> represents the character in the string, indexed in the reverse direction.</p>
<p>The expressions for the three endpoints are <code>[v*w+~v,~v*3,w-2]</code> (note that <code>~v*3</code> is negative - Ruby counts negative numbers backwards from the end of the string starting at <code>-1</code>). The three forward directions (for text on the outside edge of the figure) are <code>[1,~w,w]</code>. <code>w</code> is the diagonal <code>z</code> direction (because each line is newline terminated it has <code>1+w</code> characters, so <code>w</code> is 1 less than this.) <code>1</code> is the <code>x</code> direction and <code>~w</code> = <code>-(1+w)</code> is the <code>y</code> direction.</p>
<p>Text for edges inside the figure (those that run from the top front right corner) run in the opposite direction. These edges are written when <code>j/3==j%3</code> or equivalently <code>j%4=0</code>. This is managed by the expression <code>(j%-4/3*2)</code> which evaluates to either <code>0</code> or <code>-2</code>. The <code>~</code> outside the bracket converts this to <code>-1</code> or <code>1</code>. After applying this sign correction we multiply by <code>i</code> to find the right point in the output string.</p>
<p><strong>Commented code</strong></p>
<pre class="lang-ruby prettyprint-override"><code>-&gt;s{                         #take an input s
  w=2*v=s.size                 #v is the input length. w is double this
  t=(&quot; &quot;*w+$/)*w               #set up a string of w rows of w spaces, newline terminated
  v.times{|i|                  #iterate through characters in s 
    9.times{|j|                  #iterate though edges
      t[[v*w+~v,~v*3,w-2][j/3]-    #pick an end point based on j/3
        [1,~w,w][j%3]*             #subtract direction based on j%3 mutiplied by
        ~(j%-4/3*2)*               #+1 or -1 depending on whether j/3==j%3
        i]=                        #multipy by i
        s[~i]                      #assign character from s to this cell
    }
  }
t}                            #return string t
</code></pre>
</div>
<div id="pu1" class="pu"><h1><a href="https://github.com/Vyxal/Vyxal/tree/version-2" rel="nofollow noreferrer">Vyxal</a>, 13 bytes</h1>
<pre><code>L?∞Ṫ»∨¹0²H»ø∧
</code></pre>
<p><a href="https://vyxal.pythonanywhere.com/?v=2&amp;c=1#WyIiLCIiLCJMP+KInuG5qsK74oiowrkwwrJIwrvDuOKIpyIsIiIsIkhlbGxvLCB3b3JsZCEiXQ==" rel="nofollow noreferrer">Try it Online!</a>
Indirectly -1 byte thanks to Kevin Cruijssen, I forgot how canvas operator overloading works.</p>
<pre><code>           ø∧ # Draw on the canvas with
L             # Line length: length of input
 ?∞Ṫ          # String: Input, palindromised with last character removed
    »∨¹0²H»   # Directions: digits of 24560125406


    .&gt;2&gt;.
   ⇗   ⇙v
  1   5 4
 ⇗   ⇙  v
.&lt;6&lt;.   .
^   v  ⇙
0   4 5
^   v⇙
.&lt;6&lt;.
</code></pre>
</div>
<div id="pu2" class="pu"><h1><a href="https://github.com/Adriandmen/05AB1E/wiki/Commands" rel="nofollow noreferrer">05AB1E</a>, <s>35</s> 12 <a href="https://github.com/Adriandmen/05AB1E/wiki/Codepage" rel="nofollow noreferrer">bytes</a></h1>
<pre><code>gIû¨•5ÏlÐθ•Λ
</code></pre>
<p>-23 bytes by porting <em>emanresuA</em>'s Vyxal answer, so make sure to upvote that answer as well!</p>
<p><a href="https://tio.run/##yy9OTMpM/f8/3fPw7kMrHjUsMj3cn3N4wrkdQOa52f//e6Tm5OTrKITnF@WkKAIA" rel="nofollow noreferrer">Try it online.</a></p>
<p><strong>Original 35 <a href="https://github.com/Adriandmen/05AB1E/wiki/Codepage" rel="nofollow noreferrer">bytes</a> answer:</strong></p>
<pre><code>g¸ÞI¸Þð13ÅÉǝ•6´XdªÅ~ßмñD&gt;γ•₃в)øvy`Λ
</code></pre>
<p><a href="https://tio.run/##yy9OTMpM/f8//dCOw/M8QcThDYbGh1sPdx6f@6hhkdmhLREph1Ydbq07PP/CnsMbXezObQYKP2pqvrBJ8/COssqEc7P///dIzcnJ11EIzy/KSVEEAA" rel="nofollow noreferrer">Try it online.</a></p>
<p><strong>Explanation:</strong></p>

<pre class="lang-python prettyprint-override"><code>g               # Push the length of the (implicit) input-string
 I              # Push the input-string
  û             # Palindromize it
   ¨            # And then remove the last character
    •5ÏlÐθ•     # Push compressed integer 24560125406
           Λ    # Use the Canvas builtin with those three arguments
                # (which is output immediately as result)
</code></pre>

<pre class="lang-python prettyprint-override"><code>g               # Push the length of the (implicit) input-string
 ¸Þ             # Wrap it into a list, and repeat it infinitely
I               # Push the input-string
 ¸Þ             # Repeat it infinitely as well
   ð            # Push a space character &quot; &quot;
    13ÅÉ        # Push a list of odd integers &lt;= 13: [1,3,5,7,9,11,13]
        ǝ       # Insert spaces at those 0-based indices into the infinite list
•6´XdªÅ~ßмñD&gt;γ• # Push compressed integer 506660546965149280261611581961
  ₃в            # Convert it to base-95 as list:
                #  [1,8,84,80,2,80,5,82,0,82,5,85,2,85,0,86]
)               # Wrap all three lists on the stack into a list
 ø              # Zip/transpose; swapping rows/columns,
                # which also discards the infinite portions
  vy            # Loop over each triplet:
    `           #  Pop and push the three values in the triplet to the stack
     Λ          #  Use the Canvas builtin with these three values as arguments
                #  (which is output immediately every iteration)
</code></pre>
<p><a href="https://codegolf.stackexchange.com/a/166851/52210">See this 05AB1E tip of mine (sections <em>How to compress large integers?</em> and <em>How to compress integer lists?</em>)</a> to understand why <code>•6´XdªÅ~ßмñD&gt;γ•</code> is <code>506660546965149280261611581961</code> and <code>•6´XdªÅ~ßмñD&gt;γ•₃в</code> is <code>[1,8,84,80,2,80,5,82,0,82,5,85,2,85,0,86]</code>.</p>
<p><em>Additional explanation of the Canvas builtin <code>Λ</code>/<code>.Λ</code></em>:</p>
<p>It takes 3 arguments to draw an ASCII shape:</p>
<ol>
<li>Length of the lines we want to draw</li>
<li>Character/string to draw</li>
<li>The direction to draw in, where each digit represents a certain direction:</li>
</ol>

<pre class="lang-python prettyprint-override"><code>7   0   1
  ↖ ↑ ↗
6 ← X → 2
  ↙ ↓ ↘
5   4   3
</code></pre>
<p>And there are certain special 'directions': <code>+×8</code>.</p>
<p><code>g16иI16иð13ÅÉǝ•6´XdªÅ~ßмñD&gt;γ•₃в)ø</code> with input <code>Hello, world!</code> creates the following list of Canvas arguments:</p>
<pre class="lang-python prettyprint-override"><code>[[13,&quot;Hello, world!&quot;,1],
 [13,&quot; &quot;,8],
 [13,&quot;Hello, world!&quot;,84],
 [13,&quot; &quot;,80],
 [13,&quot;Hello, world!&quot;,2],
 [13,&quot; &quot;,80],
 [13,&quot;Hello, world!&quot;,5],
 [13,&quot; &quot;,82],
 [13,&quot;Hello, world!&quot;,0],
 [13,&quot; &quot;,82],
 [13,&quot;Hello, world!&quot;,5],
 [13,&quot; &quot;,85],
 [13,&quot;Hello, world!&quot;,2],
 [13,&quot; &quot;,85],
 [13,&quot;Hello, world!&quot;,0],
 [13,&quot;Hello, world!&quot;,86]]
</code></pre>
<ol>
<li>The first <code>13,&quot;Hello, world!&quot;,1</code> will draw (all) <code>13</code> characters of string <code>&quot;Hello, world!&quot;</code> in direction <code>1</code>/↗: <a href="https://tio.run/##yy9OTMpM/f/f0FjJIzUnJ19HoTy/KCdFUcnw3Oz//wE" rel="nofollow noreferrer">try just this first step online</a>;</li>
<li>The second <code>13,&quot; &quot;,8</code> will with special direction <code>8</code> reset back to the origin (the <code>13</code> and <code>&quot; &quot;</code> are ignored): <a href="https://tio.run/##yy9OTMpM/f/f0FjJIzUnJ19HoTy/KCdFUcnw3GwuQ@PDGyzOzf7/HwA" rel="nofollow noreferrer">try just the first two steps online</a>;</li>
<li>The third <code>13,&quot;Hello, world!&quot;,84</code> will first reset back to the origin with direction <code>8</code> (step 2 is kinda a no-op to save a byte on the <code>13ÅÉ</code>), and then again draw (all) <code>13</code> characters of string <code>&quot;Hello, world!&quot;</code> in direction <code>4</code>/↓: <a href="https://tio.run/##yy9OTMpM/f/f0FjJIzUnJ19HoTy/KCdFUcnw3GwuQ@PDGyzANJqkhcm52f//AwA" rel="nofollow noreferrer">try just the first three steps online</a>;</li>
<li>The fourth <code>13,&quot; &quot;,80</code> will first reset back to the origin with direction <code>8</code> again, and then draw 13 space characters in direction <code>0</code>/↑: <a href="https://tio.run/##yy9OTMpM/f/f0FjJIzUnJ19HoTy/KCdFUcnw3GwuQ@PDGyzANJqkhQlM1uDc7P//AQ" rel="nofollow noreferrer">try just the first four steps online</a>;</li>
<li>The fifth <code>13,&quot;Hello, world!&quot;,2</code> will then continuing from that position to draw (all) <code>13</code> characters of string <code>&quot;Hello, world!&quot;</code> in direction <code>2</code>/→: <a href="https://tio.run/##yy9OTMpM/f/f0FjJIzUnJ19HoTy/KCdFUcnw3GwuQ@PDGyzANJqkhQlM1gCbtNG52f//AwA" rel="nofollow noreferrer">try just the first five steps online</a>;</li>
<li>etc. etc.</li>
</ol>
<ul>
<li>The sixteenth <code>13,&quot;Hello, world!&quot;,86</code> will again reset, and then draw in direction <code>6</code>/←, which also fixes the space at the origin position to the first letter of the input: <a href="https://tio.run/##yy9OTMpM/f/f0FjJIzUnJ19HoTy/KCdFUcnw3GwuQ@PDGyzANJqkhQlM1gCbtBFeWVOYrBE2WQO8snC9pnjtNcVtMrpPzM7N/v8fAA" rel="nofollow noreferrer">try all sixteen steps online</a> (feel free to remove trailing lines to see the other untreated intermediate steps).</li>
</ul>
<p><a href="https://codegolf.stackexchange.com/a/175520/52210">See this 05AB1E tip of mine to learn more about the Canvas builtin.</a></p>
</div>
<div id="pu3" class="pu"><h1>Pyth, 78 bytes</h1>
<pre><code>AtBtlQJ_SH
+*dGQVJs[*Nd@Q-GN*dHK@QN*d-HNK;
++_Q*dHhQVJs[@QN*dH@Q-GN*dtN@Q-GN;
</code></pre>
<p>With trailing newline.   Inspired by Joshua de Haan's Python 3 answer.</p>
<p><a href="http://pyth.herokuapp.com/?code=AtBtlQJ_SH%0A%2B%2adGQVJs%5B%2aNd%40Q-GN%2adHK%40QN%2ad-HNK%3B%0A%2B%2B_Q%2adHhQVJs%5B%40QN%2adH%40Q-GN%2adtN%40Q-GN%3B%0A&amp;input=%22head%22&amp;debug=0" rel="nofollow noreferrer">Try it online here!</a></p>
</div>
<div id="pu4" class="pu"><h1>Java 7, 283 bytes</h1>

<pre><code>void a(String s){int h=s.length(),n=h*2-1,t=n-h,u=n-1;char[][]c=new char[n][n];for(int i=0;i&lt;h;i++){c[0][t+i]=c[i][t-i]=c[t][t-i]=c[t+i][t]=c[t+i][u-i]=c[t-i][t+i]=c[t-i][u]=c[u][i]=c[u-i][0]=s.charAt(i);}for(int y=0;y&lt;n;y++){System.out.println(new String(c[y]).replace('\0',' '));}}
</code></pre>

<p><a href="https://ideone.com/si1aKH" rel="nofollow"><strong>Try it here!</strong></a></p>

<p><strong>Ungolfed:</strong></p>

<pre><code>void a(String s) {
    int length=s.length(),
        n=length*2-1,
        mid=n-length,
        doubleMid=n-1;
    char[][]c=new char[n][n];
    for(int i=0;i&lt;length;i++) {
        c[0][mid+i]= 
        c[i][mid-i]=
        c[mid][mid-i]=
        c[mid+i][mid]=
        c[mid+i][doubleMid-i]=
        c[mid-i][mid+i]=
        c[mid-i][doubleMid]=
        c[doubleMid][i]=
        c[doubleMid-i][0]=s.charAt(i);
    }
    for(int y=0;y&lt;n;y++){
        System.out.println(new String(c[y]).replace('\0',' '));
    }
}
</code></pre>
</div>
<div id="pu5" class="pu"><h1>Ruby, <s>148</s> 144 bytes</h1>
<p>+1 byte from the <code>n</code> flag. Shows newlines instead of semicolons for readability (same functionality).</p>
<pre><code>S=&quot; &quot;
X=S*s=$_.size-2
puts X+S+I=$_,(r=1..s).map{|i|c=I[~i];S*(s-i+1)+I[i]+X+c+S*~-i+c},I.reverse+X+I[0],r.map{|i|c=I[i];I[~i]+X+c+S*(s-i)+c},I
</code></pre>
<p>Run like so. Input is a line of STDIN, with no trailing newline, so it likely needs to be piped from file.</p>
<pre><code>ruby -ne 'S=&quot; &quot;;X=S*s=$_.size-2;puts X+S+I=$_,(r=1..s).map{|i|c=I[~i];S*(s-i+1)+I[i]+X+c+S*~-i+c},I.reverse+X+I[0],r.map{|i|c=I[i];I[~i]+X+c+S*(s-i)+c},I'
</code></pre>
</div>
<div id="pu6" class="pu"><h2>Javascript, <s>225</s> 198 bytes</h2>

<p>Saved 27 bytes thanks to @Neil</p>
<pre class="lang-js prettyprint-override"><code>f=(s,l=s.length-2,d=' ',r='repeat',t=d[r](l))=&gt;[d+t+s,...a=[...Array(l)].map((_,i)=&gt;d[r](l-i)+s[i+1]+t+(p=s[l-i])+d[r](i)+p),[...s].reverse().join``+t+s[0],...a.map(v=&gt;v.trim()).reverse(),s].join`
`
</code></pre>
<ul>
<li>[...] instead of .concat</li>
<li>[...]+map instead of <em>for</em> loop</li>
<li>only one statement by moving variables as function parameters</li>
<li>better initialization for <em>l</em> and <em>t</em></li>
</ul>
<p><strong>Original answer:</strong></p>
<pre class="lang-js prettyprint-override"><code>f=s=&gt;{l=s.length,d=' ',r='repeat',a=[],t=d[r](l-2)+s;for(i=1;i++&lt;l-1;)a.push(d[r](l-i)+s[i-1]+d[r](l-2)+(p=s[l-i])+d[r](i-2)+p);console.log(d+[t].concat(a,[...t].reverse().join``+s[0],a.map(v=&gt;v.trim()).reverse(),s).join`
`)}
</code></pre>
</div>
<div id="pu7" class="pu"><h1>Python 2, <s>228</s> <s>223</s> <s>221</s> <s>203</s> <s>199</s> <s>195</s> 189</h1>



<pre class="lang-python prettyprint-override"><code>t=input()
x=" "
l=len(t)-1
q=l-1
f=range(q,0,-1)
print x*l+t
for i in f:print x*i+t[l-i]+x*q+t[i]+x*(q-i)+t[i]
print t[::-1]+x*q+t[0]
for i in f:print t[i]+x*q+t[l-i]+x*(i-1)+t[l-i]
print t
</code></pre>

<h1>Python 3, <s>192</s> <s>188</s> 182</h1>

<pre class="lang-python prettyprint-override"><code>t=input()
x=" "
l=len(t)-1
q=l-1
p=print
f=range(q,0,-1)
p(x*l+t)
for i in f:p(x*i+t[l-i]+x*q+t[i]+x*(q-i)+t[i])
p(t[::-1]+x*q+t[0])
for i in f:p(t[i]+x*q+t[l-i]+x*(i-1)+t[l-i])
p(t)
</code></pre>
</div>
<div id="pu8" class="pu"><h1>x86 (IA-32) machine code, 126 bytes</h1>

<p>Hexdump:</p>

<pre><code>60 8b f9 57 33 c0 f2 ae 5e 2b fe 4f 87 fa 8d 1c
12 8b c3 48 f6 e3 c6 04 07 00 48 c6 04 07 20 75
f9 8b ea 4d 53 8d 04 2a 50 53 8b c5 f6 e3 8d 44
68 01 50 53 2b c2 8b c8 50 4b 53 55 53 03 c5 50
f7 d3 53 50 53 95 f6 e2 6b c0 04 50 43 53 51 6a
01 4a 52 6a 01 50 6a ff 51 b0 0a 6a 0b 8b dc 59
8b 6c cb fc 88 04 2f 03 2c cb 89 6c cb fc 83 f9
0a 75 01 ac e2 ea 4a 79 e0 83 c4 58 61 c3
</code></pre>

<p>This is a bit long, so to explain it I'll give C code first:</p>

<pre><code>void doit(const char* s, char out[])
{
    int n = strlen(s);
    int w = 2 * n;
    int h = w - 1;
    int m = n - 1;

    memset(out, ' ', h * w);
    out[h * w] = 0;

    int offset1 = n + m;
    int offset2 = w * m + 2 * m + 1; // 2 * n * n - 1
    int offset3 = offset2 - n; // 2 * n * n - n - 1
    int offset4 = 4 * n * m; // 4 * n * n - 4 * n

    int offsets[] = {
        offset3, -1,
        offset4, 1,
        m, 1,
        offset3, 1 - w,
        offset4, -w,
        offset2 - 1, -w,
        offset2 - 1, w - 1,
        m, w - 1,
        offset3, w,
        offset2, w,
        offset1, w,
    };

    do
    {
        char c = *s++;
        for (int i = 0; i &lt; 11; ++i)
        {
            if (i == 9)
                c = '\n';
            int offset = offsets[i * 2];
            assert(offset &gt; 0 &amp;&amp; offset &lt; w * h);
            out[offset] = c;
            offsets[i * 2] += offsets[i * 2 + 1];
        }
    } while (--n);
}
</code></pre>

<p>Here <code>n</code> is the length of the input string.</p>

<p>The dimensions of the output area are <code>2n</code> (width) by <code>2n-1</code> (height). First, it fills everything with spaces (and adds a terminating null byte). Then, it travels along 11 straight lines in the output area, and fills them with text:</p>

<ul>
<li>2 lines are filled with end-of-line bytes (=10)</li>
<li>9 lines are filled with the consecutive bytes of the input string</li>
</ul>

<p>Each line is represented by two numbers, a start offset and a stride. I stuffed them both into the array <code>offsets</code>, to make access "easy".</p>

<p>The interesting part is filling the array. There is little importance for the order of the entries in the array; I tried to rearrange them to minimize the number of register conflicts. In addition, quadratic formulas have some freedom in choosing the way of calculation; I tried to minimize the number of subtractions (because additions can be implemented by the flexible <code>LEA</code> instruction).</p>

<p>Assembly source:</p>

<pre><code>    pushad;

    ; // Calculate the length of the input string
    mov edi, ecx;
    push edi;
    xor eax, eax;
    repne scasb;
    pop esi; // esi = input string
    sub edi, esi;
    dec edi;

    ; // Calculate the size of the output area
    xchg edi, edx;  // edx = n
                    // edi = output string
    lea ebx, [edx + edx]; // ebx = w
    mov eax, ebx;
    dec eax; // eax = h
    mul bl; // eax = w * h

    ; // Fill the output string with spaces and zero terminate it
    mov byte ptr [edi + eax], 0;
myfill:
    dec eax;
    mov byte ptr [edi + eax], ' ';
    jnz myfill;

    mov ebp, edx;
    dec ebp; // ebp = m

    ; // Fill the array of offsets
    push ebx; // w
    lea eax, [edx + ebp];
    push eax; // offset1
    push ebx; // w
    mov eax, ebp;
    mul bl;
    lea eax, [eax + 2 * ebp + 1];
    push eax; // offset2
    push ebx; // w
    sub eax, edx;
    mov ecx, eax; // ecx = offset3
    push eax; // offset3
    dec ebx;
    push ebx; // w - 1
    push ebp; // m
    push ebx; // w - 1
    add eax, ebp;
    push eax; // offset2 - 1
    not ebx;
    push ebx; // -w
    push eax; // offset2 - 1
    push ebx; // -w
    xchg eax, ebp; // eax = m
    mul dl;
    imul eax, eax, 4;
    push eax; // offset4
    inc ebx;
    push ebx; // 1 - w
    push ecx; // offset3
    push 1;
    dec edx; // edx = n - 1
    push edx;
    push 1;
    push eax;
    push -1;
    push ecx;

    ; // Use the array of offsets to write stuff to output
myout:
    mov al, '\n';
    push 11;
    mov ebx, esp;
    pop ecx;
myloop:
    mov ebp, [ebx + ecx * 8 - 4];
    mov [edi + ebp], al;
    add ebp, [ebx + ecx * 8];
    mov [ebx + ecx * 8 - 4], ebp;
    cmp ecx, 10;
    jne skip_read;
    lodsb;
skip_read:
    loop myloop;
    dec edx;
    jns myout;

    add esp, 11 * 8;

    popad;
    ret;
</code></pre>

<p>I used byte multiplications here, limiting the length of the input string to 127. This avoids clobbering the register <code>edx</code> - the product is calculated in <code>ax</code> instead.</p>

<p>A minor glitch: when filling the array, the length of the string gets decreased by 1. So I adjusted the loop exit condition:</p>

<pre><code>    jns myout
</code></pre>

<p>It counts down to -1.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/92410/">92410</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




