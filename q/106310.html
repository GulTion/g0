<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::106310</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>439</td><td>Python3</td><td>240308T172141Z</td><td><a href="https://codegolf.stackexchange.com/questions/106310/solve-an-ice-maze/271637#271637">Ajax1234</a></td></tr>
<tr d-ix="1"><td>nan</td><td></td><td>170111T091704Z</td><td><a href="https://codegolf.stackexchange.com/questions/106310/solve-an-ice-maze/106459#106459">edc65</a></td></tr>
<tr d-ix="2"><td>247</td><td>Mathematica</td><td>170111T001531Z</td><td><a href="https://codegolf.stackexchange.com/questions/106310/solve-an-ice-maze/106418#106418">user6198</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>Python3, 439 bytes</h1>
<pre class="lang-py prettyprint-override"><code>def f(b,s,S,e,E):
 q=[(s,S,[[(s,S)]],'')]
 for x,y,d,p in q:
  if(x,y)==(e,E):return p
  for D,X,Y in[('E',0,1),('W',0,-1),('N',-1,0),('S',1,0)]:
   if'~'==b[x][y]and(T:=[(x+X,y+Y)])not in d and'O'!=b[x+X][y+Y]:q+=[(*T[0],d+[T],p+D)]
   elif'.'==b[x][y]:
    T,Q,W=[],x,y
    while 1:
     if(S:=b[Q+X][W+Y])in'.~':
      T+=[(Q+X,W+Y)];Q+=X;W+=Y
      if'~'==S:break
     else:break
    if(U:=sorted(T))not in d and U:q+=[(Q,W,d+[U],p+D)]
</code></pre>
<p><a href="https://tio.run/##hVRRj5pAEH4uv2Lry@4eUyJq04YLb3evR4waNHTTaIAcqQEEmurL/nU7u6Cg4N2Y4PLNN7PzzS6Tn6r3LJ3@zIvzOYxiErMdlLCACF65Y5CDGzD1Gug/LgRQyoVB4qwgRzhBCDlJUnJAKklihhB3XaaDi6j6W6QkR49iv8AaNsgNGH2lMAabA6O@Wn3TyzeKCxir5YKCWgmVFLNSSV13FxxFcBLbNGRLB4s6mms4mRsueJpVqoSQoI969KuimmskmxvhHEzkPi2DsYDQDJYCcvNF1U9ItMfMVptZb0aWMAffDQSgEg38e0/2EbFrr5K4cDBirjbwcQOepNSStHGTpdoOneCr0p7nprt@9k1307gbLQtnV0TbPzUY7cuo8447rBy3zIoqQqX8Rh1Z1XqwRKVm1ag5lzZxyWg0Mjxl@LTU07Isr0GUr5x0SV3TVG314hJsXa3LqXGNdBg14g3l6VKuyMUhNdKlyQ@iLsQr4t3UY/Xq6ZqU3oB21RGjnD7ojYFRaE28zoAP2Wbst6rXzV5hbZ@sQcZFi2y7PZCjn3RAWTl7dOhXbVL2sLrpLYaC5Q1UH5r3SUlXzLvn3QDytmmed983bwhTdd9hsqn9M6xzj5rLJz/SgYTudXvMGzqFy0Go0Vplv3fZtghZiZP1SzMeg@ApEXpAJuo7j5N9FRXsLUsjIKVV5vukYvRXSjlOLSMvkrRiMWsz4eic4M@GCecD7gkH2wZ7Bj/A/j7ImCJDhYM9HfTPar@NA3vM@fk/" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu1" class="pu"><h1>JavaScript (ES6) 180 <s>183</s></h1>
<pre class="lang-js prettyprint-override"><code>(m,[x,y],[t,u],o=~m.search`
`,s=[[x-y*o,[]]],k=[])=&gt;eval(&quot;for(i=0;[p,l]=s[i++],k[p]=t-u*o-p;)[-1,o,1,-o].map(d=&gt;k[q=(M=p=&gt;+m[p+=d]?m[p]&lt;8?M(p):p:p-d)(p)]||s.push([q,[...l,d]]));l&quot;)
</code></pre>
<p>Using a <a href="https://en.wikipedia.org/wiki/Breadth-first_search" rel="nofollow noreferrer">BFS</a>, like I did to solve <a href="https://codegolf.stackexchange.com/a/50077/21348">this related challenge</a></p>
<p><strong>Input</strong><br />
The maze map is a multiline string, using <code>O</code> or <code>0</code> for stone, <code>8</code> for soil and any nonzero digit less than 8 for ice (<code>7</code> look good).<br />
Start and end position are zero based.</p>
<p><strong>Output</strong><br />
A list of offset, where -1 is <code>W</code>, 1 is <code>E</code>, negative less than -1 is <code>N</code> and a positive greater than 1 is <code>S</code></p>
<p><em>Less golfed</em></p>
<pre class="lang-js prettyprint-override"><code>(m,[x,y],[t,u])=&gt;{
  o=~m.search`\n`
  s=[[x-y*o,[]]]
  k=[]
  for(i=0; [p,l]=s[i++], k[p]=1, t-u*o != p;)
  {
    [-1,o,1,-o].map(d=&gt;(
      M=p=&gt;+m[p+=d] ? m[p]&lt;8 ? M(p) : p : p-d,
      q=M(p),
      k[q]||s.push([q,[...l,d]])
    ))
  }
  return l
}
</code></pre>
<p><strong>Test</strong></p>
<p><div class="snippet" data-lang="js" data-hide="false" data-console="false" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js prettyprint-override"><code>Solve=
(m,[x,y],[t,u],o=~m.search`
`,s=[[x-y*o,[]]],k=[])=&gt;eval("for(i=0;[p,l]=s[i++],k[p]=t-u*o-p;)[-1,o,1,-o].map(d=&gt;k[q=(M=p=&gt;+m[p+=d]?m[p]&lt;8?M(p):p:p-d)(p)]||s.push([q,[...l,d]]));l")

function Go(maze) {
  var map = maze.textContent;
  var [sx,sy, dx,dy] = map.match(/\d+/g)
  --sx, --sy // zero based
  --dx, --dy // zero based
  map = map.split('\n').slice(1).join('\n') // remove first line
  var result = Solve(map.replace(/\./g, 7).replace(/~/g, 8), [sx,sy], [dx,dy])
  S.textContent = result
  Animate(maze, map, result, sx, sy)
}

function Display(maze, map, pos) {
  var row0 = maze.textContent.split('\n')[0]
  map = [...map]
  map[pos] = '☻'
  maze.textContent = row0+'\n'+map.join('')
}

function Animate(maze, map, moves, x, y) {
  console.log('A',moves)
  var offset = map.search('\n')+1
  var curPos = x + offset * y
  var curMove = 0
  var step = _ =&gt; {
    Display(maze, map, curPos)
    if (curMove &lt; moves.length) 
    {
      curPos += moves[curMove]
      if (map[curPos] == 'O')
      {
        curPos -= moves[curMove]
        ++curMove
      }  
      else 
      {
        if (map[curPos] == '~') {
          ++curMove
        }
      }
      setTimeout(step, 100)
    }
    else
      setTimeout(_=&gt;Display(maze,map,-1),500)
  }
  step()
}</code></pre>
<pre class="snippet-code-css lang-css prettyprint-override"><code>td { 
  border: 1px solid #888;
}</code></pre>
<pre class="snippet-code-html lang-html prettyprint-override"><code>Select maze&lt;pre id=S&gt;&lt;/pre&gt;
&lt;table cellspacing=5&gt;&lt;tr&gt;
&lt;td valign=top&gt;&lt;input type=radio name=R onclick='Go(M1)'&gt;&lt;br&gt;
&lt;pre id=M1&gt;3,3 to 3,2  
OOOOO
OO.OO
O...O
OOOOO&lt;/pre&gt;&lt;/td&gt;
&lt;td valign=top&gt;&lt;input type=radio name=R onclick='Go(M2)'&gt;&lt;br&gt;
&lt;pre id=M2&gt;15,12 to 16,8
OOOOOOOOOOOOOOOOO
O........O.....OO
O...O..........OO
O.........O....OO
O.O............OO
OO.......O.....OO
O.............OOO
O......O.......~O
O..O...........~O
O.............OOO
O.......O......OO
O.....O...O....OO
O..............OO
OOOOOOOOOOOOOO~~O
OOOOOOOOOOOOOOOOO&lt;/pre&gt;&lt;/td&gt;
&lt;td valign=top&gt;&lt;input type=radio name=R onclick='Go(M3)'&gt;&lt;br&gt;
&lt;pre id=M3&gt;2,2 to 14,3
OOOOOOOOOOOOOOOO
O~~~~~OOOOO~~~~O
O~~O~OOOOOOO~~OO
O...O..........O
O........O.....O
O..............O
OO.............O
O.............OO
O....~....O....O
O..............O
O..............O
OOOOOOOOOOOOOOOO&lt;/pre&gt;&lt;/td&gt;
&lt;td valign=top&gt;&lt;input type=radio name=R onclick='Go(M4)'&gt;&lt;br&gt;
&lt;pre id=M4&gt;2,2 to 11,11
OOOOOOOOOOOOOOOOOOO
O~~~~~~~OOOOOOOOOOO
O~~~~...OOOOOOOOOOO
OO~O~..OOOOOOOOOOOO
O..OO.............O
O..............O..O
O....O............O
O.O............~..O
O........OOOO.....O
O.......OOOOO.....O
O.......O~~~O.....O
O.......~~~~~.....O
O.......~~~~~.....O
O..........O......O
O..O..~...........O
O...............O.O
O.....O...........O
O.................O
OOOOOOOOOOOOOOOOOOO&lt;/pre&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;</code></pre>
</div>
</div>
</p>
</div>
<div id="pu2" class="pu"><h2>Mathematica, 247 bytes</h2>

<pre><code>(p=x#[[##&amp;@@x]];m={c,v}Switch[p[c+v],0,m[c+v,v],1,c+v,_,c];g=Cases[Array[List,Dimensions@#],c_/;p@c&lt;2,{2}];a=cm[c,#]&amp;/@{{1,0},{-1,0},{0,1},{0,-1}};e=Flatten[Table[#-&gt;c,{c,a@#}]&amp;/@g,1];Normalize/@Differences@FindPath[Graph[e],#2,#3][[1]])&amp;
</code></pre>

<p>With line breaks:</p>

<pre><code>(
p=x#[[##&amp;@@x]];
m={c,v}Switch[p[c+v],0,m[c+v,v],1,c+v,_,c];
g=Cases[Array[List,Dimensions@#],c_/;p@c&lt;2,{2}];
a=cm[c,#]&amp;/@{{1,0},{-1,0},{0,1},{0,-1}};
e=Flatten[Table[#-&gt;c,{c,a@#}]&amp;/@g,1];
Normalize/@Differences@FindPath[Graph[e],#2,#3][[1]]
)&amp;
</code></pre>

<p>My immediate idea was to represent the ice and soil positions as nodes in a graph with directed edges corresponding to legal moves, then use <code>FindPath</code>. One might think that determining the legal moves would be the easy part and finding the solution would be the hard part. For me, it was the opposite. Open to suggestions on how to compute the edges. </p>

<p>First argument <code>#</code> is a 2D array where <code>0</code> represents ice, <code>1</code> represents soil, and <code>2</code> represents stone.</p>

<p>Second argument <code>#2</code> and third argument <code>#3</code> are the starting and ending points, respectively, in the form <code>{row,column}</code>.</p>

<p><code></code> is the 3 byte private use character <code>U+F4A1</code> representing <code>\[Function]</code>.</p>

<h2>Explanation</h2>

<pre><code>p=x#[[##&amp;@@x]];
</code></pre>

<p>Defines a function <code>p</code> which takes a list <code>x</code> of the form <code>{row,column}</code> and outputs <code>#[[row,column]]</code>; i.e., the ice/soil/stone value at that coordinate.</p>

<pre><code>m={c,v}Switch[p[c+v],0,m[c+v,v],1,c+v,_,c]
</code></pre>

<p>Defines a function <code>m</code> which takes a starting position <code>c</code> and direction vector <code>v</code> and recursively determines where you would end up. If <code>c+v</code> is ice, then we continue sliding from that point, so it returns <code>m[c+v,v]</code>. If <code>c+v</code> is soil, then we move to <code>c+v</code> and stop. Otherwise (if <code>c+v</code> is stone or out of bounds), you don't move. Note that this is only intended to be called on ice or soil positions.</p>

<pre><code>g=Cases[Array[List,Dimensions@#],c_/;p@c&lt;2,{2}];
</code></pre>

<p>Defines the list <code>g</code> of ice and soil positions (<code>p</code> value less than <code>2</code>).</p>

<pre><code>a=cm[c,#]&amp;/@{{1,0},{-1,0},{0,1},{0,-1}}; 
</code></pre>

<p>Defines a function <code>a</code> which takes a starting position <code>c</code> and returns the results of moving in the <code>{1,0}</code>, <code>{-1,0}</code>, <code>{0,1}</code>, and <code>{0,-1}</code> directions. There may be some redundancy. Again, this assumes that <code>c</code> corresponds to ice or soil.</p>

<pre><code>e=Flatten[Table[#-&gt;c,{c,a@#}]&amp;/@g,1];
</code></pre>

<p>Defines the list <code>e</code> of directed edges representing legal moves. For each position <code>#</code> in <code>g</code>, compute the table of edges <code>#-&gt;c</code> for each <code>c</code> in <code>a@#</code>. Then since we'll end up with a sublist for each position <code>#</code>, I flatten the first level. There may be some loops and multiple edges.</p>

<pre><code>Normalize/@Differences@FindPath[Graph[e],#2,#3][[1]]
</code></pre>

<p><code>Graph[e]</code> is the graph where the nodes are the legal positions (ice or soil) and the edges represent legal moves (possibly bumping into a stone and not moving). We then use <code>FindPath</code> to find a path from <code>#2</code> to <code>#3</code> represented as a list of nodes. Since <code>FindPath</code> can take additional arguments to find more than one path, the result will actually be a list containing a single path, so I take the first element using <code>[[1]]</code>. Then I take the successive <code>Differences</code> of the coordinates and <code>Normalize</code> them. Thus up is <code>{-1,0}</code>, down is <code>{1,0}</code>, right is <code>{0,1}</code> and left is <code>{0,-1}</code>.</p>

<h2>Test cases</h2>

<p><a href="https://i.stack.imgur.com/eKivw.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/eKivw.png" alt="enter image description here"></a></p>

<p><a href="https://i.stack.imgur.com/p2SiD.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/p2SiD.png" alt="enter image description here"></a></p>

<p><a href="https://i.stack.imgur.com/nhBPX.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/nhBPX.png" alt="enter image description here"></a></p>

<p><a href="https://i.stack.imgur.com/JFq5g.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/JFq5g.png" alt="enter image description here"></a></p>

<p><a href="https://i.stack.imgur.com/JphWv.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/JphWv.png" alt="enter image description here"></a></p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/106310/">106310</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




