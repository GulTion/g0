<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::272110</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>361</td><td>JavaScript ES6</td><td>240329T141254Z</td><td><a href="https://codegolf.stackexchange.com/questions/272110/implement-a-2-player-version-of-1d-chess/272188#272188">Arnauld</a></td></tr>
<tr d-ix="1"><td>244</td><td>Charcoal</td><td>240328T140808Z</td><td><a href="https://codegolf.stackexchange.com/questions/272110/implement-a-2-player-version-of-1d-chess/272171#272171">Neil</a></td></tr>
<tr d-ix="2"><td>513</td><td>Python 3</td><td>240327T061553Z</td><td><a href="https://codegolf.stackexchange.com/questions/272110/implement-a-2-player-version-of-1d-chess/272111#272111">Alec</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>JavaScript (ES6), 361 bytes</h1>
<p>A full program that uses <code>prompt()</code> and <code>console.log()</code> for I/O.</p>
<pre class="lang-javascript prettyprint-override"><code>for(b=[5,9,C=1,0,0,2,10,6],P=([x,X])=&gt;b[b[X]=b[x],x]=0,M=c=&gt;b.map((v,x)=&gt;(h=n=&gt;v*/[129]/.test(b)&amp;c&amp;&amp;b[X=x+n]%4-c&amp;&amp;!b[k|=b[X]==C+4,m.push(x+[X]),X]&amp;v&lt;3&amp;&amp;h(n+d))(d=~(v&gt;8))|h(d=-d),k=m=[]);g=_=&gt;M(C^3)|k,f=g(B=[...b]),M(C),m=m.filter(a=&gt;!g(P(a))|(b=[...B])),console.log(&quot;SwbBW&quot;[m+m?C:f&amp;&amp;C+2]+b.map(v=&gt;&quot;.Rr__Kk__Nn&quot;[v]).join``),m+m;)m.includes(q=prompt())&amp;&amp;P(q,C^=3)
</code></pre>
<p><a href="https://tio.run/##TZFNj5swEIbv/hUEqcgujjd8pd2yQ6Ug7aXaKmoOXcnrZflKwgYMAUKpFPWvpyY5tPLB4/Ez7@sZv8dD3KVt0fRzWWf5pcx7rZDNqddAa/PjqWhzrG87nbA2j7PHosw3v2WKF4T19aZvC7nDhHVNWfRYf5EvUoFV3OBOg0Dr/l3ohFBNZiPVmr710eTStHXVTDbRxF49uSIEV4RpCh9t6xarhCIW/lQ2BVcR7eGGszKXu36vGYY2u5IqSGvZ1WXOylo9jPgTbprkMmklwD16T0Ow6EItm1oLuhR0DZiP9FkQCBKe8GcBCR8FHQUs6BOkKnvtCA90VAjeg4Rg@HjHLfte3LE@73qcECM1DFULoynFB3euTrOEH85w1YPQdGnFmlO3x6OpMkTZGcODYxh7LM2MEJzBHzwEnwk571U8zwg9QAVcEH8HEQRPOHx1yPlAt7DDK@CMsUSpqDShFVRsW5R93uIYgtkOr3GsdKZ2FbYSavL/D0Xf/EpWP3VemdXX8MvWMELTFuatxwECnf1oo@jbIYq@S50PgrD3upBvb8rHrHxSsUKm5SnLO3yE2w@qMRvGGh9p@AoOuVxsDyHbRZ6LLAe5Dpq2pYscD31aIlvFHnIs5C2R5f4F" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<h3>Board encoding</h3>
<p>The board is stored as an array <code>b[]</code> of 8 entries.</p>
<p>Empty squares are encoded as <code>0</code>. Pieces are encoded as <code>TTCC</code> nibbles, with:</p>
<pre><code>TT = type  -&gt; 00: rook, 01: king, 10: knight
CC = color -&gt; 01: white, 10: black
</code></pre>
<p>which gives:</p>
<div class="s-table-container"><table class="s-table">
<thead>
<tr>
<th style="text-align: center;">color</th>
<th style="text-align: center;">type</th>
<th style="text-align: center;">binary</th>
<th style="text-align: center;">decimal</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">white</td>
<td style="text-align: center;">rook</td>
<td style="text-align: center;">0001</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">white</td>
<td style="text-align: center;">king</td>
<td style="text-align: center;">0101</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: center;">white</td>
<td style="text-align: center;">knight</td>
<td style="text-align: center;">1001</td>
<td style="text-align: center;">9</td>
</tr>
<tr>
<td style="text-align: center;">black</td>
<td style="text-align: center;">rook</td>
<td style="text-align: center;">0010</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: center;">black</td>
<td style="text-align: center;">king</td>
<td style="text-align: center;">0110</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: center;">black</td>
<td style="text-align: center;">knight</td>
<td style="text-align: center;">1010</td>
<td style="text-align: center;">10</td>
</tr>
</tbody>
</table></div>
<p>Some useful properties:</p>
<ul>
<li>The color of the piece is <code>v % 4</code>.</li>
<li>Assuming <code>v ≠ 0</code>, a rook can be identified with <code>v &lt; 3</code>.</li>
<li>A knight can be identified with <code>v &gt; 8</code>.</li>
<li>The presence of a piece other than a king on the board can be detected by applying the regular expression <code>/[129]/</code> to <code>b</code>.</li>
</ul>
<h3>Functions</h3>
<p>The helper function <code>P</code> moves a piece from <code>x</code> to <code>X</code>:</p>
<pre class="lang-javascript prettyprint-override"><code>P = ([x, X]) =&gt; b[b[X] = b[x], x] = 0
</code></pre>
<p>The helper function <code>M</code> generates all pseudo-legal moves for the color <code>c</code> and stores them in the array <code>m[]</code>. It also sets a flag <code>k</code> if one of these moves is the capture of the king of the current side.</p>
<pre class="lang-javascript prettyprint-override"><code>M = c =&gt;           // c = color
b.map((v, x) =&gt;    // for each square v at position x in b[]:
  h(d = ~(v &gt; 8))  //   process moves to the left by setting
  |                //   d to -2 for a knight, or -1 otherwise
  h(d = -d),       //   process moves to the right
  k =              //   start with k zero'ish
  m = []           //   start with m[] = empty array
)                  // end of map()
</code></pre>
<p>The recursive function <code>h</code> is responsible for generating the moves in a direction <code>d</code>:</p>
<pre class="lang-javascript prettyprint-override"><code>h = n =&gt;           // n = signed distance from the source square
v *                // get the value of this square
/[129]/.test(b)    // or force it to 0 if only kings remain
&amp; c &amp;&amp;             // if it's a piece of color c
b[                 // and the value on ...
  X = x + n        //   ... the target square X
] % 4 - c          // is not that of a piece of the same color
                   // (and we're not outside the board)
&amp;&amp;                 // then:
!b[                //
  k |= b[X]        //   set k if the target square
       == C + 4,   //   contains the king of the current side
  m.push(x + [X]), //   push the move in m[] as a string
  X                //
] &amp;                // if the target square is empty
v &lt; 3 &amp;&amp;           // and this is a rook:
  h(n + d)         //   do a recursive call with n + d
</code></pre>
<p>The helper function <code>g</code> tests whether the king of the current side is in check:</p>
<pre class="lang-javascript prettyprint-override"><code>g = _ =&gt; M(C ^ 3) | k
</code></pre>
<h3>Main program</h3>
<p>Once the definitions of the above helper functions have been redacted, the main program looks like this:</p>
<pre class="lang-javascript prettyprint-override"><code>for(                   // loop:
  b = [                //   initialize the board b[] and the color C:
    5, 9, C = 1,       //     white pieces
    0, 0,              //     empty squares
    2, 10, 6           //     black pieces
  ],                   //
  f = g(B = [...b]),   //   set the flag f if the king is in check
                       //   and save a copy of b[] in B[]
  M(C),                //   generate the moves for the current side
  m = m.filter(a =&gt;    //   keep only the moves for which ...
    !g(P(a)) |         //     ... the king is not left in check
    (b = [...B])       //     (restore the board after each iteration)
  ),                   //   end of filter()
  console.log(         //   print the game state:
    &quot;SwbBW&quot;[           //     the first character is ...
      m + m ?          //       if there's at least one move to play:
        C              //         'b' or 'w'
      :                //       else:
        f &amp;&amp;           //         'S' if f = 0
        C + 2          //         'B' or 'W' otherwise
    ] +                //
    b.map(v =&gt;         //     the next characters are taken
      &quot;.Rr__Kk__Nn&quot;[v] //     from this lookup table
    ).join``           //     and joined together
  ),                   //
  m + m;               //   stop when there are no more moves to play
)                      //
  m.includes(          //   if the move q ...
    q = prompt()       //     ... taken from prompt()
  ) &amp;&amp;                 //   exists in m[]:
  P(q, C ^= 3)         //     play the move and change the color
</code></pre>
</div>
<div id="pu1" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, <s>254</s> 244 bytes</h1>
<pre><code>≔KNR..rnkη≔⁰ζＷ∧›⁶№η.Φ⪪⭆η⭆η⭆×‹№⎇ζβαμ∧№⎇ζβακ⎇⁼R↥κ⬤η∨⁼ξ.›¹×⁻πν⁻λπ⁼∨⁼K↥κ²↔⁻νλη⎇⁼πλ.⎇⁼πνκξ⁸∧⊖↔⁻⌕κK⌕κk⬤⌕Ａκ§Kkζ›⬤⌕Ａκ§nNζ⁻²↔⁻ξμ⊙⌕Ａκ§rRζ⬤κ∨⁼ρ.›¹×⁻ςξ⁻μς«§wbζηＤ⎚Ｓθ≔⭆η⎇⁼λＩ§θ⁰.⎇⁼λＩ§θ¹§ηＩ§θ⁰κδ¿№ιδ«≔δη≦¬ζ»»¿⊙⌕Ａη§Kkζ∨⊙⌕Ａη§nNζ⁼²↔⁻λι⊙⌕Ａη§rRζ⬤η∨⁼ν.›¹×⁻ξλ⁻ιξ§bwζsη
</code></pre>
<p><a href="https://tio.run/##hVNtb5swEP5MfsWJT0byopI02aR@itJ1qrpmU9r9AJJ4xcI4xIaEZupvZz5smjSAigT4XnzP3T136zhS620kqmqmNX@RxH9YLIdDJROfQhzcDJz6isLRSIeYCwZkJjfkh2JRzhSZUphvC5mTmII/9IOAwh0XaHnKBM/JU664fHmMMnToEZ55yjT5ybQmNtYzUzJSr@RIYUUhMjFT8yJsnz0xb6P9visioYm/NDX8yTKm1pFmJMHUZkIg9C/VOJU2awpNPaGJU6fzyGWhSUZBGqsVBIUswIeCu34K5D@00UaIuNJbUeTMxZMUhAsRt1PO0Fpn1GXCRBIKpbv/zbXklq0VS5nM2YZcoN1xYzdXTHI1L05KfBsBu4FK/Bv9LL@XG1aaUpD9Y3DWlT5PuWg8LeCoVXCJ3Fk0@doZQy2bGM5yaqr6hJ09dqPBTinsg7MH/g2832bEcvIOdVhZqJvGgiPu3RZpRvAwFyxS9eleZkVuB5TsUOH24MMAXzBkpmMe6RPajsJVXXgXnR3Ooe2SU8R90ZL6u8Gk@F9wC8FRU1fcZLqx@@t5JlmnWmxzu8be2@BtgJfPKYk7B8Bw0ed04t7V1CbfVMnb5Me95H9YTfkJ@aVdFivwZi9q5i9oXx0c7cCEZs7qa9@04n0Mqiocw/QaxhP4OoWROU9gHMJkCuF19WUv/gM" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Explanation:</p>
<pre><code>≔KNR..rnkη≔⁰ζ
</code></pre>
<p>Start with the initial position with white to play.</p>
<pre><code>Ｗ∧›⁶№η.Φ⪪
</code></pre>
<p>While there are at least three pieces on the board, and filtering on...</p>
<pre><code>⭆η⭆η⭆×‹№⎇ζβαμ∧№⎇ζβακ
</code></pre>
<p>... all pairs of starting square (which must contain a piece of the current player's colour) and ending square (which must not), ...</p>
<pre><code>⎇⁼R↥κ⬤η∨⁼ξ.›¹×⁻πν⁻λπ⁼∨⁼K↥κ²↔⁻νλη
</code></pre>
<p>... where the piece's movement is legal, ...</p>
<pre><code>⎇⁼πλ.⎇⁼πνκξ⁸
</code></pre>
<p>... generating the resulting positions after those moves, and...</p>
<pre><code>∧⊖↔⁻⌕κK⌕κk⬤⌕Ａκ§Kkζ›⬤⌕Ａκ§nNζ⁻²↔⁻ξμ⊙⌕Ａκ§rRζ⬤κ∨⁼ρ.›¹×⁻ςξ⁻μς«
</code></pre>
<p>... excluding those that move into check, is not empty:</p>
<pre><code>§wbζηＤ⎚
</code></pre>
<p>Output the current player and position.</p>
<pre><code>Ｓθ≔⭆η⎇⁼λＩ§θ⁰.⎇⁼λＩ§θ¹§ηＩ§θ⁰κδ
</code></pre>
<p>Input the (0-indexed) move and calculate the resulting position.</p>
<pre><code>¿№ιδ«≔δη≦¬ζ
</code></pre>
<p>If this is one of the legal positions then set this as the current position and switch player.</p>
<pre><code>»»¿⊙⌕Ａη§Kkζ∨⊙⌕Ａη§nNζ⁼²↔⁻λι⊙⌕Ａη§rRζ⬤η∨⁼ν.›¹×⁻ξλ⁻ιξ§bwζsη
</code></pre>
<p>If the current player is in check then show that the other player won otherwise show that the current position is a tie.</p>
</div>
<div id="pu2" class="pu"><h1>Python 3, <s>836</s> 513 bytes</h1>
<pre><code>def v(f,s,e):a=1-(f[s]in P[t][1:])+(f[e]in P[t])+any(f[s].upper()==p!='RKN.....NK'[s-e]for p in&quot;R&quot;*(1-r(f,s,e))+&quot;KN&quot;);f[s],f[e]=d,f[s];return a&lt;1&gt;c(f,f.index)!=s-e
c=lambda f,i:[(N in f and abs(i(N)-i(K))==2)+(R in f and r(f,i(R),i(K)))for K,N,R,_ in P][~t]
r=lambda f,s,e:{*f[s+1:e]+f[e+1:s]}&lt;={d}
t=1
d,*b='.KNR..rnk'
P=&quot;Knrk&quot;,&quot;kNRK&quot;
R=range(8)
J=''.join
while any(v(b[:],s,e)for s in R for e in R)*6&gt;b.count(d):
    print('bw'[t]+J(b));*n,=b
    if v(n,*map(int,input())):b,t=n,1-t
print(&quot;SBW&quot;[~t*c(b,b.index)]+J(b))
</code></pre>
<p>Much shorter thanks to Mukundan314, Jonathan Allan, and
l4m2. <a href="https://tio.run/##RZFBb@MgEIXPnV9BuRhsbImmya6c0sMea8mKvIc9WKiCGG/ZtMTCpN2qav96FrKpyumJebz5Zphew8PeLY7HwYzomYxsZobWSvCSjP0srUObPsie15IW8cZ83tBCudeTpTpMk/GECjFdiqxr2iqdtsn6uTRy3Hs0Ietwh3PCS3/uQAvctJiuUwBLsWJgSa@9CQfvkLrht9voHSvrBvOXXooYBlvxqJ70oNDIbN2TNuaiESk3IKVnYklLS0saGlGuIm33VU5tLekoO5VpgmpYyzp2nzwb2X8ECf4rPSLWb3kEKnhtZBEBo5jl@414G94hCA4Dy7XIqqbtqsq7XQYbgRvnd5jhXds1GDrhlfttyHcKdyLLqj976@DlwT4alDb3THRfy9MuEs2cODqUpDlJmq9udbXdH1wgA63hYvI2yky/ZHH7xR3RlK5zx4SGC5t@zrH8SU0kmph10yGQOGetWRCO8TLA/@f4549fOA6bb4lm@rzbc9rxyBewuobFEr6t4CrqJSw4LFfAr/8B" rel="nofollow noreferrer">Try it online!</a></p>
<p><a href="https://tio.run/##dVJNj9owED3jX@H6YltrImVZaBWte@gVKQd66AFxiMHuprBOZJul/Ho64w00rNpII2XGb@a9@ejP6aXzs8tlZx19E05FZWVFJo0WSWt2Yo3fCbeOG98l2nq2rFesC9St7WbwpOxCxpqP2L0PIyx6GYsIzN0jnjYmiji18pMuR4@1z49Y6ArQ@nEEWIUbIAyqJZk47Ypt158F/gNQIbfmBVfokUmw6Rg8ZomGgrStcJC21Yfm1ewa6qpR04J51nrq6FWlK1q/s78xLqc3ZwlNDdJY@JuAom4YaFzdJcgPQxOsZvTfZPWYbD8iW/2HDDai6F0GfCTcesRZVSI@25wKc3koK7uBsR19EqxgQGCncZq3Eb9eURZQ8R4FSwEUMXrNl1zxGmwFVgwWwDzYnm9I0vzEyemlPWC9s3gTJq/MwQ4iNh4a/9OKLzlgxwGJ9GbghbryeQHX2YcW3PTAefGra70wuHwoqF@bXsCTan1/TAKjLZ71O1tl8CQMnIRK@Siyzw0HDOwCJNpDtKj0vT6s5Ru7e2M/mITAFgiz@53JsYbLpZyRxROZzcnnBXmE/zmZlWS@IOXTHw" rel="nofollow noreferrer">836 byte version</a> matches up a bit more with the un-golfed explanation. The logic is similar to most chess programs. The core is about checking if a move is valid, i.e.:</p>
<ul>
<li>the start and end positions are valid</li>
<li>the piece movement is legal</li>
<li>the movement does not put yourself in check</li>
</ul>
<p>Un-golfed functions are as follows:</p>
<pre><code>def v(f, s, e):  # Check if a move is valid
    # Check valid start and end positions
    if t==&quot;w&quot; and (b[s] not in &quot;KNR&quot; or b[e] in &quot;KNR&quot;):  return False
    if t==&quot;b&quot; and (b[s] not in &quot;knr&quot; or b[e] in &quot;knr&quot;):  return False

    # Check correct movement
    if b[s] in &quot;Kk&quot; and abs(s-e) != 1:  return False
    if b[s] in &quot;Nn&quot; and not abs(s-e) == 2: return False
    if b[s] in &quot;Rr&quot; and not r(b, s, e): return False
    
    # Check if move puts own king in check
    f = f.copy()
    f[s], f[e] = '.', f[s]
    if c(f): return False
    
    return True

def c(f):  # Is in check
    if t==&quot;w&quot;:
        K = f.index(&quot;K&quot;)
        if &quot;n&quot; in f and abs(f.index(&quot;n&quot;)-K) == 2: # black knight can hit king
            return True
        if &quot;r&quot; in f and r(f, f.index(&quot;r&quot;), K): # black rook can hit king
            return True
    if t==&quot;b&quot;:
        k = f.index(&quot;k&quot;)
        if &quot;N&quot; in f and abs(f.index(&quot;N&quot;)-k) == 2: # white knight can hit king
            return True
        if &quot;R&quot; in f and r(f, f.index(&quot;R&quot;), k): # white rook can hit king
            return True
    return False

def r(f, s, e): # Rook can move from s to e (i.e. there are no pieces in-between)
    if s &lt; e and f[s+1:e].count(&quot;.&quot;) == e-s-1:
        return True
    if s &gt; e and f[e+1:s].count(&quot;.&quot;) == s-e-1:
        return True
    return False

</code></pre>
<p>and the while loop just checks:</p>
<ul>
<li>there is any valid move <code>any(v(b, s, e) for s in range(8) for e in range(8))</code></li>
<li>the board doesn't only have kings on it <code>b.count('.')&lt;6</code></li>
</ul>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/272110/">272110</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




