<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::269940</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>109</td><td>Scala 3</td><td>240301T065341Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/271445#271445">138 Aspe</a></td></tr>
<tr d-ix="1"><td>034</td><td>Haskell + hgl</td><td>240209T202548Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/269952#269952">Wheat Wi</a></td></tr>
<tr d-ix="2"><td>022</td><td>APL+WIN</td><td>240213T082822Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/270047#270047">Graham</a></td></tr>
<tr d-ix="3"><td>019</td><td>J</td><td>240212T235125Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/270040#270040">Bubbler</a></td></tr>
<tr d-ix="4"><td>066</td><td>Python 3.8 prerelease</td><td>240212T224026Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/270037#270037">movatica</a></td></tr>
<tr d-ix="5"><td>081</td><td>Perl 5 MListUtil=max</td><td>240212T212506Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/270034#270034">Xcali</a></td></tr>
<tr d-ix="6"><td>071</td><td>Python 3</td><td>240209T140635Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/269944#269944">Stef</a></td></tr>
<tr d-ix="7"><td>049</td><td>Google Sheets</td><td>240211T160907Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/269993#269993">doubleun</a></td></tr>
<tr d-ix="8"><td>013</td><td>Jelly</td><td>240210T224304Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/269980#269980">Jonathan</a></td></tr>
<tr d-ix="9"><td>021</td><td>J</td><td>240210T064332Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/269970#269970">Jonah</a></td></tr>
<tr d-ix="10"><td>119</td><td>APLNARS</td><td>240209T173940Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/269947#269947">Rosario</a></td></tr>
<tr d-ix="11"><td>101</td><td>C GCC lm</td><td>240209T175459Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/269948#269948">Mukundan</a></td></tr>
<tr d-ix="12"><td>026</td><td>Charcoal</td><td>240209T235211Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/269962#269962">Neil</a></td></tr>
<tr d-ix="13"><td>044</td><td>Python + NumPy</td><td>240209T201957Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/269951#269951">Albert.L</a></td></tr>
<tr d-ix="14"><td>071</td><td>JavaScript Node.js</td><td>240209T134417Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/269942#269942">l4m2</a></td></tr>
<tr d-ix="15"><td>054</td><td>JavaScript ES6</td><td>240209T134513Z</td><td><a href="https://codegolf.stackexchange.com/questions/269940/compute-maximum-excluding-the-current-position/269943#269943">Arnauld</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://www.scala-lang.org/" rel="nofollow noreferrer">Scala 3</a>, 109 bytes</h1>
<p>109 bytes, it can be golfed more. Any improvement would be appreciated.</p>
<hr />
<p>Golfed version. <a href="https://ato.pxeger.com/run?1=fZDBSgMxEIbx2qcYlx4SyBbaWpCtWfDQgwcviqdSyjTN1tVNWjapVpc-iZd60ItPpE_hI5hNlgqKQnYnM3z_ZP55ejUCC-y_jaNYL--x1NHk4-BzObuRwsI55hqqFsBcZqBcQrBcmAROyxIfxpe2zPViQhO40rkF7kmAOyzASmONq3iQ-DIACVmXwYBB3GdwxKBHWQMNfD4Ih1L2S9Rj0N_TTt2v1T-52IFxL7SPu3vcl_cfpV5Ehy0f_bCdbFlKFNdQgUAjgSCDGQWeNv1rV8I5ygjSprRy9m2hiYnaFXbUbdgHicYRg-ZMIrqFOE5htFm5hcp5Au1q9jfr5hV2jUWNif-wC2nWhQ3dDCo5KqSS2hoi6DYKA25rd_5Xz54lzYrGZ9pOePp9dybhZW2z-PhdIU-r3FnsmPxRnvAuxWEtVtz5w42_G-4BsVxrS6acK5p2qQJZuKVhJ8sLK0syPXR1L6mFK7LhqVNtatoEVNFtePS5ibtdiF8" rel="nofollow noreferrer">Attempt This Online!</a></p>
<pre class="lang-scala prettyprint-override"><code>a=&gt;{if(a.size&lt;=1)a;val m=a.max;val s=if(a.count(_==m)&gt;1)m else a.filter(_!=m).max;a.map(x=&gt;if(x==m)s else m)}
</code></pre>
<p>Ungolfed version. <a href="https://ato.pxeger.com/run?1=fVJBbtswEARy9Cumgg8kQBmwHQOFGxnIwYccfEmQXoygWNOUrYSiDZEKFBh-SS6-tE_pI_qaUpSstikSgBKxy9nhDmdff1hJmsan0_fSpfHnXxc_d6tHJR0WlBkcesBapch9wKjY2Cmui4JelneuyMzmgU9xbzKHJCCBZ9JwyjrrMwHIQhpgTTQUmAjEY4FLgREXLWgS4kmzOBf_FY0Exh3aV4_r6re42APjUUMfDzt4SHcf56GIf-mFPTQ7SHeFIrnFAZKsAiOBFUcya_lrVdIrShnxNrX38p02zEb9Aw3yp-Y9WLSMBNr1EPEj4niGebX3D6rWU_QPq_exvl_pStI1TH4Eu1W21K5hs5SruVa5Ms4yyY9R0-CxVhd-tXu-77NvN8bVpv0JOuuy1OseaGU2bourBEOOQrmyMKBe521O1Ve_JfCaqerSVsmdWS_Ohw2V3JXGsW9IkraMY1azthxK-5emQZpppwoP-9TBAnXgrm_Zs8o7ETirv7n-uTOQtSdB-bEZ53aqz9P9Gw" rel="nofollow noreferrer">Attempt This Online!</a></p>
<pre class="lang-scala prettyprint-override"><code>object Main {
  def main(args: Array[String]): Unit = {
    val tests = Array(
      (Array(1, 5, -3, 4, 2), Array(5, 4, 5, 5, 5)),
      (Array(1, 2, 3), Array(3, 3, 2)),
      (Array(-1, -2, -3, -1), Array(-1, -1, -1, -1))
    );

    tests.foreach { case (a, b) =&gt;
      val c = f(a)
      println(s&quot;${a.mkString(&quot;[&quot;, &quot;, &quot;, &quot;]&quot;)} --&gt; Expected: ${b.mkString(&quot;[&quot;, &quot;, &quot;, &quot;]&quot;)}, Actual: ${c.mkString(&quot;[&quot;, &quot;, &quot;, &quot;]&quot;)}, Result: ${b.sameElements(c)}&quot;)
    }

  }

  def f(a: Array[Int]): Array[Int] = {
    if (a.length &lt;= 1) return a

    val maxVal = a.max
    val secondMaxVal = if (a.count(_ == maxVal) &gt; 1) maxVal else a.filter(_ != maxVal).max

    a.map(x =&gt; if (x == maxVal) secondMaxVal else maxVal)
  }
}
</code></pre>
</div>
<div id="pu1" class="pu"><h1><a href="https://www.haskell.org" rel="nofollow noreferrer">Haskell</a> + <a href="https://gitlab.com/wheatwizard/haskell-golfing-library" rel="nofollow noreferrer">hgl</a>, 34 bytes</h1>
<pre><code>zW ma&lt;tl&lt;g rS*^g lS
</code></pre>
<pre><code>g h=h ma~&lt;mn
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=LY2xDoIwAET3fsXppKYdAE0MKR_gYELC4EAwIaGFxhaxlMXBH3FhMX4TfyMC0-XeXe7e3ypvb0Lrflgp09ytw6PLtZJKFIit0F0hyBLEn85JdhzWMnpeYHLuNC9hk921hE5IiSqqRvzipl6ajROtaxGGSNNT7bKMzCAiQIrUozhQsIBiT-FnI6QT9CmCxbHRMn8uMe8PM0JMruppw5yxaSw45BbT8vzb97P-AA" rel="nofollow noreferrer">Attempt This Online!</a></p>
<h2>Explanation</h2>
<p>First this calculates the minimum value of the list (linear time). Then this scans the list rightwards calculating cumulative maxima, then it scans leftwards calculating cumulative maxima (both linear time). Finally it zips the two results together (lienar time).  Since the cumulative maxima are the maxima of the prefixes / suffixes this means that when we zip them together we get the maximum of the values in the prefix before our value and the suffix after. This, naturally is the entire list other than the value in question.  Since this is just a series of linear time operations the entire algorithm is linear time.</p>
<h2>Reflection</h2>
<p>It feels wrong that <code>g</code> isn't shorter in point-free, however I think this is mostly because in normal golf, writing things in point free saves 2 bytes automatically by removing the function declaration. However here we <em>need</em> the function declaration (inlining <code>g</code> completely is very long) so point-free has to compete on even ground.</p>
<ul>
<li><code>fid</code> should not be 3 bytes. This would make the point-free version of <code>g</code> shorter by a byte, replacing a <code>($ ma)</code> with <code>fi ma</code>, but would still be longer than the point-ful version.</li>
<li>What this really wants is a way to zip with an offset. I'm not sure how universally applicable this idea is, but if implemented it would really simplify this answer.</li>
</ul>
</div>
<div id="pu2" class="pu"><h1>APL+WIN, 22 bytes</h1>
<p>Prompts for vector. Index origin = 0</p>
<pre><code>⌈/0 1↓(⍳⍴n)⌽(2⍴⍴n)⍴n←⎕
</code></pre>
<p><a href="https://tio.run/##SyzI0U2pTMzJT9dNzkksLs5M/v@ob6qvz6O2CcZcQJanP5BlwPWooz3t/6OeDn0DBcNHbZM1HvVuftS7JU/zUc9eDSMgC8IBEkDVQF3/geq5/qdxGSqYKhxab6xgomDEBeIZKRgD6UPrDYGiRmAZIBsA" rel="nofollow noreferrer" title="APL (Dyalog Classic) – Try It Online">Try it online! Thanks to Dyalog Classic</a></p>
</div>
<div id="pu3" class="pu"><h1><a href="https://www.jsoftware.com" rel="nofollow noreferrer">J</a>, <sup><s>20</s></sup> 19 bytes</h1>
<pre><code>(]{~[=0{])(2$,\:,)/
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m70wa8FOJT0F9TQFWysFdR0FAwUrINbVU3AO8nFbWlqSpmuxWSO2ui7a1qA6VlPDSEUnxkpHUx8iczNWkysRpNHe0EDF0IArNTkjXyERQhna6enH6MF4aTCGujrxOiCWLFgAoQE" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>Copy of <a href="https://chat.stackexchange.com/transcript/message/65143744#65143744">my answer in chat</a> to the <a href="https://chat.stackexchange.com/transcript/message/65143701#65143701">CMC version of this challenge</a>.</p>
<p>-1 byte thanks to Jonah by spotting <code>\:~@,</code> → <code>,\:,</code>.</p>
<pre><code>(]{~[=0{])(2$\:~@,)/  input: v = a vector
          (       )/  tops = reduce from right:
             \:~@,      concatenate and sort descending
                        (this sorts a constant(2 or 3) number of values,
                        so it runs in constant time per element)
           2$           take the first two (largest and 2nd largest)
(        )            run the rest with v on the left and tops on the right:
      0{]               the largest
    [=                  per element, 1 if it is equal to the largest,
                        0 otherwise
 ]{~                    per element, 2nd largest if ^ is 1, largest otherwise
                        (gives 2nd largest for largest and largest otherwise)
</code></pre>
<h1><a href="https://github.com/DennisMitchell/jelly" rel="nofollow noreferrer">Jelly</a>, 9 bytes</h1>
<pre><code>=Ṁị;Ṣṫ-ʋ/
</code></pre>
<p><a href="https://tio.run/##ASwA0/9qZWxsef//PeG5gOG7izvhuaLhuastyosv////WzEsIDUsIC0zLCA0LCAyXQ" rel="nofollow noreferrer" title="Jelly – Try It Online">Try it online!</a></p>
<p>Jelly port of the above algorithm.</p>
<h1><a href="https://www.jsoftware.com" rel="nofollow noreferrer">J</a>, 16 bytes</h1>
<pre><code>(2$,\:,)/{~&gt;./=]
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m70wa8FOJT0F9TQFWysFdR0FAwUrINbVU3AO8nFbWlqSpmuxQcNIRSfGSkdTv7rOTk_fNhYifDNWkysRpMve0EDF0IArNTkjXyERQhkC1cXowXhpMIa6OvE6IJYsWAChAQ" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>J backport of the Jelly port of the above algorithm, which turns out to be shorter! Does not reuse the &quot;tops&quot; array and computes the maximum again instead, which does not affect the overall time complexity.</p>
<h1><a href="https://www.jsoftware.com" rel="nofollow noreferrer">J</a>, 20 bytes</h1>
<pre><code>(&gt;.|.)&amp;(#$__,&gt;./\)|.
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m70wa8FOJT0F9TQFWysFdR0FAwUrINbVU3AO8nFbWlqSpmuxRcNOr0ZPU01DWSU-XsdOTz9Gs0YPInUzVpMrEaTT3tBAxdCAKzU5I18hEUIZglTqwXhpMIa6OvE6IJYsWAChAQ" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>Port of <a href="https://codegolf.stackexchange.com/a/269952/78410">Wheat Wizard's Haskell+hgl answer</a>.</p>
<p><code>f/\</code> normally creates prefixes and reduces each prefix by <code>f</code> from the right, which costs quadratic time, but it is <a href="https://code.jsoftware.com/wiki/Vocabulary/SpecialCombinations#Partitions" rel="nofollow noreferrer">special-cased</a> for atomic and associative functions, which includes <code>&gt;.</code> (max of two numbers).</p>
<pre><code>(&gt;.|.)&amp;(#$__,&gt;./\)|.  input: v = a vector
                  |.  reverse(v)
                      call the rest with v on the left and reverse(v) on the right:
(    )&amp;(         )      apply the right to both sides:
             &gt;./\         cumulative max (linear)
        #$__,             prepend __ (negative infinity) and
                          chop one from the end (linear)
 &gt;.|.                   reverse the right side again and
                        take elementwise max (linear)
</code></pre>
</div>
<div id="pu4" class="pu"><h1><a href="https://docs.python.org/3.8/" rel="nofollow noreferrer">Python 3.8 (pre-release)</a>, <s>72</s> 66 bytes</h1>

<pre class="lang-python prettyprint-override"><code>def f(A):B=len(A)*[A.pop(i:=A.index(max(A)))];B[i]=max(A);return B
</code></pre>
<p><a href="https://tio.run/##RY/bCoMwDIbvfYrcrR2poE4YSgf6GqUXHiorbLXUDtzTu1rBhQSS/F9CYr/@OZvibt22jWqCiTS0avlLmZBcRZPa2RJd8SbVZlQreXdrECiVdSu05EdZO@U/zkC7ebX4hYNIIJgQGUKJwAqEG0IuEUQZ0/JwKfEP5gjFTgS42OFTY0Fk@bGGZTsSO2dImcgkmWYHHfagDcQjqjg9AA8vdTQW1mnjSYcXxh4X7HEIOOcw0O0H" rel="nofollow noreferrer" title="Python 3.8 (pre-release) – Try It Online">Try it online!</a></p>
<p>First, observe that <code>B</code> contains the second largest value of <code>A</code> at position <code>i</code> iff the largest value in <code>A</code> exists exactly once, at that very position. In all other cases (largest value exists more than once or <code>A</code> holds only one value), <code>B</code> consists solely of <code>max(A)</code>. So all we have to handle is that one special case.</p>
<p>Ungolfed:</p>
<pre class="lang-python prettyprint-override"><code>def f(A):
  l = len(A)
  m = max(A)
  B = l * [m]
  i = A.index(m)
  A.pop(i)
  B[i] = max(A)
  return B
</code></pre>
<p>As <code>max</code> and <code>index</code> are linear operations and <code>len</code>, <code>pop</code> and assignment are constant time, the runtime is <code>O(3n) = O(n)</code></p>
</div>
<div id="pu5" class="pu"><h1><a href="https://www.perl.org/" rel="nofollow noreferrer">Perl 5</a> <code>-MList::Util=max,first -a</code>, 81 bytes</h1>

<pre class="lang-perl prettyprint-override"><code>$m=max@F;$i=first{$F[$_]==$m}@t=0..$#F;$;=max@F[grep$i-$_,@t];say$_-$i?$m:$;for@t
</code></pre>
<p><a href="https://tio.run/##JY2xDsIgFEV/hcQ3FkI1LBAiUycdnZqGMLTmJUUIvEFj/HWx6nSHc3JunsuqWoNoY7i7wQDaBUulJwwj@MlaiC9HVgoBu42avzZey5wBOfjO0WRqeIDngEeIGsySiqPWerZnB6aYeqdMmG618bMSspfbnrCS1hfC9dvrfo@Nhw8" rel="nofollow noreferrer" title="Perl 5 – Try It Online">Try it online!</a></p>
</div>
<div id="pu6" class="pu"><h1><a href="https://docs.python.org/3.8/" rel="nofollow noreferrer">Python 3</a>, 71 bytes</h1>
<pre><code>def f(a):h=nlargest(2,a);return[h[x&gt;h[1]]for x in a]
from heapq import*
</code></pre>
<p><a href="https://tio.run/##RY/NDoIwDMfve4reBNMdAEkMZrzI0sNEcCSyzTETfHrcZqJNm/Tj1@Zf9w7amubs/L7fxgmmQpWdFuah/H1cQ1GjKi9@DC9vpJZbr2VFNFkPG8wGFLHJ2wX0qNwT5sVZH457iIurAMkgmpQVQovAG4QTQk0Iss1p@3Ui/IM1QpOICDcJ/s14HPL6e4ZXCcmdXxAxYiwJU3hN0rKILm8PIPJfuXB@NqFQeOC8P@AVh4gLAUO5fwA" rel="nofollow noreferrer" title="Python 3.8 (pre-release) – Try It Online">Try it online!</a></p>
<p>-4 bytes thanks to movatica</p>
<p>Compute the first and second maximum <code>h[0]</code> and <code>h[1]</code> of array <code>a</code>, then output <code>h[0]</code> or <code>h[1]</code> where appropriate.</p>
<p>Using <code>sorted</code> would take 20 fewer bytes than using <code>heapq.nlargest</code>, but would break the O(n) requirement.</p>
</div>
<div id="pu7" class="pu"><h1>Google Sheets, 49 bytes</h1>
<pre><code>=let(a,A1:E1,m,max(a),sort(if(a=m,large(a,2),m)))
</code></pre>
<p>Put the input in cells <code>A1:E1</code> and the formula in cell <code>G1</code>.</p>
<p><code>max()</code> and <code>large()</code> get evaluated once only. <code>sort()</code> is used as an array enabler and won't actually sort anything.</p>
</div>
<div id="pu8" class="pu"><h1><a href="https://github.com/DennisMitchell/jelly" rel="nofollow noreferrer">Jelly</a>, 13 <a href="https://github.com/DennisMitchell/jelly/wiki/Code-page" rel="nofollow noreferrer">bytes</a></h1>
<pre><code>œṡFṀṭʋṀiⱮCị⁸ʋ
</code></pre>
<p>A monadic Link that accepts the list and yields the maximised version.</p>
<p><strong><a href="https://tio.run/##y0rNyan8///o5Ic7F7o93NnwcOfaU91AOvPRxnXOD3d3P2rccar7////0YY6CqY6CrrGOgomOgpGsQA" rel="nofollow noreferrer" title="Jelly – Try It Online">Try it online!</a></strong></p>
<h3>How?</h3>
<pre><code>œṡFṀṭʋṀiⱮCị⁸ʋ - Link: list of integers, A
      Ṁ       - maximum of {A} -&gt; Max
     ʋ        - last four links as a dyad - f(A, Max):
œṡ            -   {A} split at first {Max}
  F           -   flatten {that}
   Ṁ          -   maximum of {that} -&gt; SecondMax (possibly equal to Max)
    ṭ         -   tack {SecondMax} to {Max} -&gt; TwoMaxes = [Max, SecondMax]
            ʋ - last four links as a dyad - f(TwoMaxes, A):
        Ɱ     -   map across {V in A} with:
       i      -     first 1-indexed index of {V} in {TwoMaxes} or 0 if not found
                     -&gt; 1 if V==Max;
                        2 if V==SecondMax and SecondMax!=Max;
                        0 otherwise
         C    -   complement {those} (1-x) takes 0:1, 1:0, 2:-1
           ⁸  -   chain's left argument -&gt; TwoMaxes
          ị   -   {complemented locations in TwoMaxes} index into {TwoMaxes}
                   (1-indexed and modular, so 1:Max, 0:SecondMax, -1:Max)
</code></pre>
<hr />
<h3>Non restricted solution, 3 <a href="https://github.com/DennisMitchell/jelly/wiki/Code-page" rel="nofollow noreferrer">bytes</a></h3>
<pre><code>Ṁ-Ƥ - map max over overlapping outfixes of length one less than the input
</code></pre>
<p><a href="https://tio.run/##y0rNyan8///hzgbdY0v@//8fbaijYKqjoGuso2Cio2AUCwA" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu9" class="pu"><h1><a href="http://jsoftware.com/" rel="nofollow noreferrer">J</a>, 21 bytes</h1>
<pre><code>(={],1&gt;./@}.i.|.[)&gt;./
</code></pre>
<p><a href="https://tio.run/##PUw9C8IwEN37Kx4usXA5TWKXQsQPcHJyLaGDtFgXFwdB/e3x2tjAPXifd48LVj18DQXCGrVAM46X8yku/TuQ2fJq9@WBP9yUwmNZdNfbAz0MoSK0jrAh2OzCws2iNWitVIQU3Wt4KlXs4dGkqf5PA@MwutUkq3QhNy3BzRVZuHGRQi2ptumRNnNncjNC/AE" rel="nofollow noreferrer" title="J – Try It Online">Try it online!</a></p>
<p><em>Thanks to Jonathan Allen for pointing out I had missed the linear time constraint.  This answer fixes that.</em></p>
<p><em>Inspired by <a href="https://codegolf.stackexchange.com/a/269943/15469">Arnauld's answer</a></em></p>
<ul>
<li><code>&gt;./</code> Max of all elements</li>
<li><code>1&gt;./@}.i.|.[</code> Max of all elements after the first instance of the ordinary max is removed.  Note because J does not have a &quot;delete at&quot; verb this is accomplished in a roundabout way: We rotate the elements left to put the normal max up front, then delete the first element, then take max.</li>
<li><code>],</code> Returns &quot;ordinary max&quot; catted with the &quot;modified max&quot; as just described.</li>
<li><code>=</code> Boolean mask indicating all positions equal to the ordinary max.</li>
<li><code>{</code> When the mask is <code>1</code>, return the modified max.  Otherwise return the ordinary max.</li>
</ul>
<h2><a href="http://jsoftware.com/" rel="nofollow noreferrer">J</a>, orig quadratic time, non-competing, 7 bytes</h2>
<pre><code>1&gt;./\.]
</code></pre>
<p><a href="https://tio.run/##PYyxCgIxEET7fMVgE4TNajamOThBBSsrWw0p5I7TxsbCv4@5iwnswO7Mm32lFesRfQcNwhZdlmGcrpdzsnve3DmktRoe0xsjLMEToiPsCNJcCFw9okWUjORFDd/nR2t1QI9bqZp/NTCOs@uX05cJjRSCq0huuLlRQpNTI@WRsZVZ3KaQfg" rel="nofollow noreferrer" title="J – Try It Online">Try it online!</a></p>
<p>J's outfix solves this directly.</p>
</div>
<div id="pu10" class="pu"><h1>APL(NARS), 119 chars</h1>
<pre><code>r←f w;a;b;n;i;t
n←≢w⋄i←2⋄a←b←w[1]
→4×⍳i&gt;n⋄→3×⍳∼b&lt;t←w[i]⋄a←b⋄b←t
i+←1⋄→2
i←1⋄r←⍬
t←w[i]⋄→6×⍳∼t=b⋄r,←a⋄→7
r,←b
→5×⍳n≥i+←1
</code></pre>
<p>15+17+29+7+7+23+4+10 +7=119</p>
<p>2 pass of the array, one for to find the maxs, and one for build the result array.
Test&amp;how to use. one not difficult solution but possible the more long and lazy.</p>
<pre><code>      f 1 2 3
3 3 2 
      f 1 1
1 1 
      f ,1
1 
</code></pre>
</div>
<div id="pu11" class="pu"><h1><a href="https://gcc.gnu.org" rel="nofollow noreferrer">C (GCC)</a> <code>-lm</code>, <sup><s>97</s> <s>93</s> <s>90</s> <s>104</s></sup> 101 bytes</h1>
<p>-2 bytes thanks to <a href="https://codegolf.stackexchange.com/users/58563/arnauld">@Arnauld</a><br />
-1 byte thanks to <a href="https://codegolf.stackexchange.com/users/81203/att">@att</a><br />
+14 bytes due to a bug fix (<code>m</code> was initialized with <code>a[0]</code> this causes problems when <code>a[0]</code> is the max)<br />
-3 bytes thanks to <a href="https://codegolf.stackexchange.com/users/52904/ceilingcat">@ceilingcat</a></p>
<pre class="lang-c prettyprint-override"><code>f(n,a,m,M,i)int*a;{for(m=fmin(M=*a,a[1]),i=2*n;--i;)i&gt;n?M&lt;*++a?m=M,M=*a:m&lt;*a?m=*a:0:(*a--=*a-M?M:m);}
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=ZVBLboMwEFWXcAqLqpIx4wpIK1UxJCfgBAhVFoHUUuxEYFaIk3STTdR9b9OepjafKG0X9ryZ9_xmxu-X8nVflh-5Rw_SKz7vhSoP3a5CSat34vj4trl0uqYvX1WNFXCQkIHwhdKEs74-NlimtRQKZynhwPOo8EGkMVGMUsF8sVHbLCFBwLcyzcCK1jIhNjMoXGPCKTWQZttsLX02TM2-7_amA5LcGPuod51WN12pLXIsodgMeNPkURgWJh-Qrlpd8rZq8wKlo7Z_BtRHgEygK0BPgOJhgIUwJ_pHrKYXMaDVXDFkT60wnsQ0mgl7D4DI0pe5rmN-BOGlYKa4zsSukG4UQ0GwpON-To1vaLjRmg19u-1obFcWxjVkJiS_HUUQ-OjUGEmNvYcd8v645KIYjU6dbrHnWTy483-fz1P8AQ" rel="nofollow noreferrer">Attempt This Online!</a></p>
<hr />
<h1><a href="https://gcc.gnu.org" rel="nofollow noreferrer">C (GCC)</a>, <sup><s>97</s> <s>93</s> <s>90</s></sup> 104 bytes</h1>
<pre class="lang-c prettyprint-override"><code>
f(n,a,m,M,i)int*a;{for(M=*a,m=M&lt;a[1]?M:a[1],i=2*n;--i;)i&gt;n?M&lt;*++a?m=M,M=*a:m&lt;*a?m=*a:0:(*a--=*a-M?M:m);}

</code></pre>
<p><a href="https://ato.pxeger.com/run?1=ZVBLboMwEFWXcIoRVSVj7ApIK1UxJCfgBAhVFgmJpeJEYFaIk3STTS7Q27Sn6ZhPlbYLe97Me_PG4_dr-Xooy8vHvdLlW7fbQ9KanTo9HjfXzlT85fNYEc0kq1nGlK-0oVL01akhWUqxmmaJzKNim61tYCqNqRacK-Grjd5mCQ0CuUUVs_J1nVCbIQrXhErOEfIMm2tfDNO8r7sDDoFaKk186F2nNU1XGoscS2gxA9k0eRSGBeYDmH1rStnu27yAdNT2zwz6iAEGvmLwxCAeBrYQeKJ_xGrqiBms5gqSPbfCeBLzaCbsPTCgy1zhug5-CpClgK_4eZP4gXyjBQTBko77ORW5odmNFjf07bajsV1ZoWsoMCS_HVUQ-HBuUFIR72EH3h-XXBWj0bkzLfE8iwd3_u_LZYrf" rel="nofollow noreferrer">Attempt This Online!</a></p>
</div>
<div id="pu12" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, 26 bytes</h1>
<pre><code>≔⌈θη≔⌕θηζ≔⌈Φθ⁻κζζＩＥθ⎇⁼ιηζη
</code></pre>
<p><a href="https://tio.run/##S85ILErOT8z5/9@xuDgzPU/DN7EiM7c0V6NQU0chQ9OaCyrslpmXolEIEtJRqEIIw1S7ZeaUpBaBFPhm5pUWa2SDVGlC1QYUZeaVaDgnFpcA1ReAFIWkFuUlFlVquBaWJuYUa2RCzQVRQGD9/390tKGOgpGOgnFs7H/dshwA" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Explanation:</p>
<pre><code>≔⌈θη
</code></pre>
<p>Get the maximum value of the input list.</p>
<pre><code>≔⌕θηζ
</code></pre>
<p>Get the index of its first occurrence.</p>
<pre><code>≔⌈Φθ⁻κζζ
</code></pre>
<p>Make a new list excluding that index, and take the maximum of that.</p>
<pre><code>ＩＥθ⎇⁼ιηζη
</code></pre>
<p>Output that value for the maximum values in the list, and the maximum for the other values.</p>
<p>By comparison a fully golfed version would be <s>19</s> 9 bytes:</p>
<pre><code>ＩＥθ⌈Φθ⁻μκ
</code></pre>
<p><a href="https://tio.run/##S85ILErOT8z5/z@gKDOvRMM5sbhEwzexQKNQR8E3sSIztzRXwy0zpyS1CCySmVdarJGro5CtCQbW//9HRxvqKBjpKBjHxv7XLcsBAA" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Runs in O(n²) time. Explanation: For each element, creates a new list without that element, and takes the maximum of that list.</p>
</div>
<div id="pu13" class="pu"><h1><a href="https://www.python.org" rel="nofollow noreferrer">Python</a> + NumPy, 44 bytes</h1>
<pre class="lang-python prettyprint-override"><code>lambda L:L[L.argpartition(-2)[(L&lt;max(L))-2]]
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=jY9LCsIwEIb3PcUsJ5AITS2I2kW7zg1qFxGpFpoHIQV7FjcF0Tu59iL2YbtVmGGYH76PmdvTtv5idHcvk8Oj8SXbvGgt1fEkQWxFLlbSna10vvKV0cg4yVHslbyiIITxovgy79IZBbpRtoVKWeM8SOdkG6SQQB5SiCmwiMKaAi92kA1pPK7xVEVgXaU9YokjiCkhSZKRlaxrJGTxcArRLOh90eD7B2U9y_h0BAtnw5gu_UM0vdp10_wA" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>Takes and returns NumPy arrays. <code>numpy.argpartition</code> uses the linear time introselect algorithm to find in this case the second largest element (or rather its index) and split at this value.</p>
</div>
<div id="pu14" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 71 bytes</h1>

<pre class="lang-javascript prettyprint-override"><code>x=&gt;x.map(v=&gt;v-n?m:M(...x.filter(u=&gt;u-n||0*++n)),m=n=M(...x))
M=Math.max
</code></pre>
<p><a href="https://tio.run/##ZY3LCoMwEEX3fsUsk5rEqnVTGAvd@wXiIlhtFU3EF1n476lVKNjCzGbuOXdqOcsh76tu5Eo/CluiNRgb0cqOzBjPXN3aa0KEEEaUVTMWPZkwnrhalvPJdRWlrEWFO0Gpk2Aix9eqG5trNeimEI1@kpKkPoOIAQ8ZXBgEGaXgeQLugJBG2y3aJ3P@xYBBeDDWlvDT8svyFebB/ob7B2WLvpvZNw" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<p>-1 byte from Arnauld</p>
<p>After first meet of n, n is increased so it's larger than max, aka no more value can equal to n</p>
</div>
<div id="pu15" class="pu"><h1>JavaScript (ES6), 54 bytes</h1>
<p><em>-2 thanks to @l4m2</em></p>

<pre class="lang-javascript prettyprint-override"><code>a=&gt;a.map(v=&gt;v-a?a:m,a.map(v=&gt;a&gt;v?m&gt;v?0:m=v:(m=a,a=v)))
</code></pre>
<p><a href="https://tio.run/##bYtBCsIwEEX3nmKWCcwUm@omMOlBxMVQW1E6TWllrh8Dghtd/M177z/FZB@2x/qiJd/GMnERTtKorM44GUkvUfELJFmvdceobNEpCwqb974MednzPDZzvrvJXVqEMwJ1CCeEcPX@8BsEhO6PoaoofM7U1qC8AQ" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<h3>Method</h3>
<p>During the first pass, we compute <span class="math-container">\$m_0=\max A_i\$</span> and <span class="math-container">\$m_1=\max_{i\neq j}A_i\$</span> where <span class="math-container">\$j\$</span> is the index of the first occurrence of <span class="math-container">\$m_0\$</span>. So we have <span class="math-container">\$m_1=m_0\$</span> if <span class="math-container">\$m_0\$</span> appears more than once and <span class="math-container">\$m_1&lt;m_0\$</span> otherwise.</p>
<p>During the second pass, we replace each value <span class="math-container">\$v\$</span> in the input array with <span class="math-container">\$m_1\$</span> if <span class="math-container">\$v=m_0\$</span> or <span class="math-container">\$m_0\$</span> otherwise.</p>
<p>In the JS implementation, we use <code>a</code> for <span class="math-container">\$m_0\$</span> and <code>m</code> for <span class="math-container">\$m_1\$</span>.</p>
<h3>Commented</h3>
<pre class="lang-javascript prettyprint-override"><code>a =&gt;           // a[] = input array,
               //       re-used as m0 (initially NaN'ish)
a.map(v =&gt;     // (2nd pass) for each value v in a[]:
  v - a ?      //   if v is not equal to a:
    a          //     output a
  :            //   else:
    m,         //     output m
  a.map(v =&gt;   //   (1st pass) for each value v in a[]:
    a &gt; v ?    //     if a is a number greater than v:
      m &gt; v ?  //       if m is a number greater than v:
        0      //         do nothing
      :        //       else:
        m = v  //         save v in m
    :          //     else:
      (        //
        m = a, //       save the previous maximum a in m
        a = v  //       save the new maximum v in a
      )        //
  )            //   end of map()
)              // end of map()
</code></pre>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/269940/">269940</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




