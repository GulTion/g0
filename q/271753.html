<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::271753</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>nan</td><td>n < 160</td><td>240314T091655Z</td><td><a href="https://codegolf.stackexchange.com/questions/271753/convert-maximum-values-to-bit-widths/271800#271800">Neil</a></td></tr>
<tr d-ix="1"><td>2040</td><td>Score  13613</td><td>240312T212852Z</td><td><a href="https://codegolf.stackexchange.com/questions/271753/convert-maximum-values-to-bit-widths/271756#271756">Tavian B</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>n &lt; 160, score <s>11925</s> 11793</h1>

<pre class="lang-c prettyprint-override"><code>#define MAX_TO_WIDTH(x) (~0ull / 31 * ((x) &gt;&gt; 4 &amp; ~0ull / 31 / (~0ull / 31 &amp; 31)) / (~0ull / 32) * 5 + (4 - 12 / (3 + (x) % 31)))
</code></pre>
<p><a href="https://tio.run/##hZN9a9swEMb/96e4JaxIWZvUjhdK3RTKVtigY9CkdFCKEbIyi3lysOQ0W8m@enay0xfZSSpiBT9397tHwsePeMbUz/W6m4iZVAK@XfyIp9/j26@fp1/IkgL5d1xmGQxg6EMPiJXOzyGEA3gVGDhpB7hR6ogBxeKP8AFICEfgBzY4tK@Ie1@l0/WgB59SwX/BgmUykeYPSAXzQsyLnAut8wJ4rlCXudLQG3hdOYMAsY5jH6HVQ@HdGEKvK4oCKzuXy7ngRiRu9pDCeAxBB9OQPPM864FlvMyYEYCwszNQ1Do@hAdp0rw0kC9EMcvyh8rC5tIqmsUinWABweXfXF3ZekJqAq13K@FuHdbtqiOblBnXGsXTYyejXTh93fZiMrm8nm4KsEs8McxIHjOtsZI4vIbF6uD4fwidTm0Eb4ipRIPJXa5PI1cIUOj3@w11FKK8w1scWHcNiv2aNjcTbQ3R7aywxUL8btpLcAfvpM0L9/HCN3j@yBY2WuzhnbzBGwYtHrbYA3yJ7iCOQtI8MTZpcVALqNeqjDxPKgO/mVRkkcuEwqMHuKxYCHN3D2N4xHnB3/EqqkIaZ4engLhNrl3tcWcamJ1xbRiyxBJnX2ucdvtZPVVxpkVzhk@fow53zgqhTCq0/MtMA2MXmi0L1YTdoXwfPSfi/bEyM6fbKv06beWt1v8B" rel="nofollow noreferrer" title="C (clang) – Try It Online">Try it online!</a> <a href="https://tio.run/##hZRtb9owEMff51PcQGtj1kATMlSVB6namDapU6XBtEpVhTzHLFZTB8UOD@vYV2fnhJUmAWoRo/zv7ndnx@efVIUbRjUMQMcPXKomg17vdHjz6XRTD/hUSA5fr24n45vJjy8fx5/tJQH773kaRdCCtgsNsI00GIAPJ/DC0Cq4neBESEH0CAa/h3dg@@CA6xlj27wi7m3mTjatBnwIOXuAOY1EIPQKhIRZwmdJzLhScQIslqiLWCpotKy6mIKH2ELFLkKzh8CbPvhWnScJRtaGyxlnmgdF7zaBfh@8GroheWpZpgYasTSimgPCej2QxFR8BguhwzjVEM95Mo3iRVbCdtMymsEi3cYAG4f7/fraxNt2TiD5bCScTYV5umzJOsSvUiiN4Ooxk1ZFOHmZ9mo0Gn4bbwMwy2SkqRZsQpXCSLvAK5WYLRz/z6BWywvBHaIyUHgyilyXdIuCh0Kz2SypHR/lA7VNPFNdiWJO03ZnuntNZD/Lr7AQf5i2Mx7gXVR5/jGe/wrP7ZjAUoojvItXeG2vwsMUR4A76wFix7fLK8YkFQ5qHrEqkV3LElLDIxXSnsciIPBkAQ4jJlzf3UMfnrBf8He@7mYmhb3DQkDc1teMartTBdT0uNIUWXyJva8Udrs5Vv@jGFW83MOXz9YCd0YTLnXIlfhNdQljBhabJrIMu0P5vvvsiPtH00hf7ot0c7e1tbbwCrVYROUvcKZqJTVdOrGMVuDcbtUgfZw5@aW7u3u9wYkLf2DBwIk2/wA" rel="nofollow noreferrer" title="Bash – Try It Online">Verify the score!</a></p>
<p>Explanation: The first part masks out the bits corresponding to <code>2⁴</code>, <code>2⁹</code>, <code>2¹⁴</code> etc., then counts just those bits by multiplying by a shifted mask and shifting. This value is multiplied by <code>5</code>. Any remaining bits are extracted via <code>% 31</code> and these are counted in a similar way to @TavianBarnes' answer by adding <code>3</code> and dividing into <code>12</code>. In fact this can be done for any number of bits up to <code>8</code> using the Fibonacci numbers:</p>
<pre class="lang-c prettyprint-override"><code>(2 - 2 / (1 + (x) % 7))
(3 - 6 / (2 + (x) % 15))
(4 - 12 / (3 + (x) % 31))
(5 - 25 / (5 + (x) % 63))
(6 - 48 / (8 + (x) % 127))
(7 - 91 / (13 + (x) % 255))
</code></pre>
<p>For specific values of <code>n</code> the score can be reduced by folding the constants.</p>
<h1>n = 128, score <s>10622</s> 10494</h1>
<pre class="lang-c prettyprint-override"><code>#define MAX_TO_WIDTH(x) (0x8421084210842108421084210842108ull * ((x) &gt;&gt; 4 &amp; 0x1084210842108421084210842108421ull) / 0x8000000000000000000000000000000ull * 5 + (4 - 12 / (3 + (x) % 31)))
</code></pre>
<p>Can't try it online but <a href="https://tio.run/##hZRtb9owEMff51PcQGttVh4SsgqVB6namDapU6XBtEpVhTzHLFFTB8UOhHV8dnZOWFkSoBYxyt39f3d2fP7JlL/lTMMIdPQopGpxGAzOx7efzrd1T8wDKeDr9d1sejv78eXj9DNJKZBO2nMdu3N8SsIQGkBM8GgELpxBJz0VjxNKKLQxrtc5OXL0e3gHxIUm2A6KSNe8YrK30LUppdt2Az74gj/CkoWBF@g1BBIWsVjEERdKRTHwSKI9iKSCRtuqB3NwEFtYqY3Q7KHwZgiuVRdxjMraOF0IroVXjO5SGA7BqWEYkueWZWpgIU9CpgUgbDAASU3FF7AKtB8lGqKliOdhtMpK2G12RjNYpBMUEBz295sboyckJ9B8NiacTYV5umzJ2sevWSiN4uoxk1ZFOP0/7fVkMv423Qkwy2yimQ74jCmFSlLglUrMFo7/F1Cr5YXgDjHpKTxRRa5N@0WDg4ZWq1WyXrpoPlLbzDHVlSjmrO12pn/QRQ@z3AoL8cdpe@cRXq/Kc0/x3Fd49qURllKc4PVe4XWdCg9TnADuvUeIly4prxiTVDhoc6hVUfYtK5AanlggyTIKPArPFuAwxljo@wcYwjP2C/46m37mUtg73AfE7WLNqLY7U8BMjyvNkCVS7H2lsNvNsfqn4kyJcg9fvXgL3AWLhdS@UMFvpksYM7DYJJZl2D2aH/ovgbh/LAn11SGlnYdtrI2FV6/FQyZ/QXOu1lKztBnJcA3Nu53VS54Wzfyy3t/ZzujMhj@w4tAMt38B" rel="nofollow noreferrer" title="Bash – Try It Online">Verify the score!</a></p>
<h1>n = 64, score <s>10473</s> 10341</h1>
<pre class="lang-c prettyprint-override"><code>#define MAX_TO_WIDTH(x) (0x1084210842108421ull * ((x) &amp; 0x842108421084210ull) / 0x800000000000000 * 5 + (4 - 12 / (3 + (x) % 31)))
</code></pre>
<p><a href="https://tio.run/##hZNha9swEIa/@1fcEjakrE1sxwuhbj6UrbBBx2DJ2KAUI2RlFvPkYCmpt5Lfnp3srK3sJBWxgu/ufe6V8PFznjP1c7frp2IplYDPVz@SxZfk@6cPi4@kokD8KvCnUfhsW@c5DIDY7BvwKzfpY5bCyMZ9Z6HkHbwFEsE5BCFWkLF9RchrGAeU0t1oAO8zwX/BhuUyleYPSAWrUqzKggutixJ4oTAuC6VhMPL6cgkhYh3LAULrh8KrGUReX5QlKnvX1UpwI1K3ekxhNoOwh2VIXnqe9cByvs6ZEYCwy0tQ1Do@g3tpsmJtoNiIcpkX97WF/a3VNItFOkEBwRV8u7mxekIaAm12G8LdOmza1Uc2GTOuNYqnx05Gu3D6vO3VfH79dbEXYJdkbpiRPGFao5I4vJbF@uD4fwa9XmMEb4ipVIMpXG5AYzcQYmA4HLaikwjDR7wloXXXothvaH8z8cEUPcyKOizEH6c9JY/wpl1edIoXvcALJlbYanGCN32BNw47PGxxAviUPUKcRKR9YmzS4WAspF5HGXueVAZ@M6nIppAphQcPcNlgKcztHczgAecFf/42rlMaZ4dngLh9rV3dcWcamJ1xbRiyRIWzrzVOu/2s/qs406I9wxePWYe7YqVQJhNa/mWmhbELza5L1YbdYvgufizE@2Pr3FwcUgZN2dbb7v4B" rel="nofollow noreferrer" title="C (clang) – Try It Online">Try it online!</a> <a href="https://tio.run/##hZR/b9owEIb/z6e4gdbGrIEkZAgVqFStTJvUqdLotEpVhbzELFZTB8UOhHV8dnZOWGkSoBYxyv147rXj8y8qw41PFVyAih@ZkG0fhsPT8c3n000zYDMuGHy7vJve3kx/fr26/WJmBEw7c@y@576a0iiCFpjaewJ2Vnba6CXQ0Xa7NDDlI3wA0wMLHBcjzK5@Rch76DqEkE2nBZ9C5j/CgkY84GoFXMA8YfMk9pmUcQJ@LNDOYyGh1TGafAYuYkuSHYTmD4F3I/CMJksSzGyMsznzFQvK0V0CoxG4DQxD8swwtAYa@WlEFQOEDYcgiFZ8BkuuwjhVEC9YMoviZS5hu2s5TWORbmKCicP5cX2t802zIJBi1iactcKiXL5kFeJnKUkjuHqspGQZTl6XvZxMxt9vtwlYZTpRVHF/SqXETLPEq0jMF47/Z9BoFEJwh6gIJB6NMtchg7LBRUO73a5Yex6aD2ibulpdhaLP0HZnBntdZD/Lq7EQf5i2cx7g9es87xjPe4Pn9HRipcQRXv8NXtet8bDEEeDOe4DY88zqirFIjYM2lxi1zIFhcKHgiXJhLmIeEHg2AIc2JkzdP8AInrFf8GevB7lLYu/4ISBuG6tHvd2pBKp7XCqKLJZh70uJ3a6P1f8sn0pW7eHzF2@JO6cJEypkkv@hqoLRA8WmiajC7tH8MHgJxP2jaaTO92U6RdjaWBt4hxp@RMVvsGZyJRTNrFhEK7DuttYgfZpbxa27u3zdixMH/sLSByva/AM" rel="nofollow noreferrer" title="Bash – Try It Online">Verify the score!</a></p>
<p>Edit: Saved a bunch from all the scores by removing a set of unnecessary parentheses (in some cases I had to switch a right shift to a divide by a power of <code>2</code>).</p>
</div>
<div id="pu1" class="pu"><h1>Score: <s>13877</s> 13613, <span class="math-container">\$n = 2040\$</span>.</h1>
<p><em>-264 thanks to l4m2</em></p>
<pre class="lang-c prettyprint-override"><code>#define CHUNK(m, mask) (m) / ((m) % mask + 1) / mask % mask
#define INTERP(m) 7 - 86 / ((m) % 255 + 12)
#define MAX_TO_WIDTH(m) (CHUNK(m, 255) * 8 + INTERP(m))
</code></pre>
<hr />
<p>This idea is due to Hallvard B. Furuseth on a <a href="https://groups.google.com/g/comp.lang.c/c/NfedEFBFJ0k/m/9HAqis6IDqcJ" rel="nofollow noreferrer">comp.lang.c post</a> in 2003.  It uses this helper function</p>
<pre class="lang-c prettyprint-override"><code>#define CHUNK(m, mask) (m) / ((m) % mask + 1) / mask % mask
</code></pre>
<p>Which is used to make a repeating sequence like this:</p>
<p><span class="math-container">$$
\begin{aligned}
a_{i,j} &amp; = \texttt{CHUNK}(2^i - 1, 2^j - 1) \\
a_{0,j}, a_{1,j}, a_{2,j}, \ldots &amp; = \underbrace{0, \ldots, 0}_{\text{$j$ times}}, \underbrace{1, \ldots, 1}_{\text{$j$ times}}, \cdots, \underbrace{2^j-2, \ldots, 2^j - 2}_{\text{$j$ times}}, 0, \ldots
\end{aligned}
$$</span></p>
<p>You can play around with it in Python to see:</p>
<pre class="lang-python prettyprint-override"><code>&gt;&gt;&gt; def CHUNK(m, mask):
...     return (m) // ((m) % mask + 1) // mask % mask
... 
&gt;&gt;&gt; def a(i, j):
...     return CHUNK(2**i - 1, 2**j - 1)
... 
&gt;&gt;&gt; [a(i, 2) for n in range(10)]
[0, 0, 1, 1, 2, 2, 0, 0, 1, 1]
&gt;&gt;&gt; [a(i, 3) for n in range(10)]
[0, 0, 0, 1, 1, 1, 2, 2, 2, 3]
&gt;&gt;&gt; [a(i, 4) for n in range(10)]
[0, 0, 0, 0, 1, 1, 1, 1, 2, 2]
&gt;&gt;&gt; [a(n, 5) for n in range(5 * (2**5 - 1))] == \
... [i for i in range(2**5 - 1) for j in range(5)]
True
</code></pre>
<p>This sequence has <span class="math-container">\$j \, (2^j - 1)\$</span> values before it wraps, meaning</p>
<p><span class="math-container">$$
\texttt{CHUNK}(2^i - 1, 2^j - 1) = \lfloor i/j \rfloor \quad \text{for all $i &lt; j \, (2^j - 1)$.}
$$</span></p>
<p>This is almost enough—what we want is <span class="math-container">\$j \, \lfloor i/j \rfloor + (i \bmod j) = i\$</span>.  We can get <span class="math-container">\$(i \bmod j)\$</span> in various ways.  For now, let's fix <span class="math-container">\$j = 8\$</span>.  We know that <span class="math-container">\$2^i \pmod {2^8 - 1}\$</span> will have period 8:</p>
<pre class="lang-python prettyprint-override"><code>&gt;&gt;&gt; [(2**i - 1) % 255 for i in range(16)]
[0, 1, 3, 7, 15, 31, 63, 127, 0, 1, 3, 7, 15, 31, 63, 127]
</code></pre>
<p>And we can brute force a linear interpolation of these that maps them to <code>[0, 1, 2, ...]</code>:</p>
<pre class="lang-python prettyprint-override"><code>&gt;&gt;&gt; [(7 - 86 // ((2**i - 1) % 255 + 12)) for i in range(16)]
[0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7]
</code></pre>
<hr />
<p>The <a href="https://groups.google.com/g/comp.lang.c/c/NfedEFBFJ0k/m/9HAqis6IDqcJ" rel="nofollow noreferrer">original post</a> is more like this:</p>
<pre class="lang-c prettyprint-override"><code>#define CHUNK(m, mask) (m) / ((m) % mask + 1) / mask % mask
#define INTERP(m) 4 - 12 / ((m) % 31 + 3)
#define MAX_TO_WIDTH(m) \
    (CHUNK(m, 0x3fffffffL) * 30 + CHUNK((m) % 0x3fffffff, 31) * 5 + INTERP(m))
</code></pre>
<p>Which would have score: 21477, <span class="math-container">\$n = 30 \cdot (2^{30} - 1) = 32212254690\$</span>.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/271753/">271753</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




