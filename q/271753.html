<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::271753</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>nan</td><td>n < 160</td><td>240314T091655Z</td><td><a href="https://codegolf.stackexchange.com/questions/271753/convert-maximum-values-to-bit-widths/271800#271800">Neil</a></td></tr>
<tr d-ix="1"><td>2040</td><td>Score  13613</td><td>240312T212852Z</td><td><a href="https://codegolf.stackexchange.com/questions/271753/convert-maximum-values-to-bit-widths/271756#271756">Tavian B</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>n &lt; 160, score <s>11925</s> 11661</h1>

<pre class="lang-c prettyprint-override"><code>#define MAX_TO_WIDTH(x) (~0ull / 31 * ((x) &gt;&gt; 4 &amp; ~0ull / 31 / (~0ull / 31 &amp; 31)) / (~0ull / 32) * 5 + 4 - 12 / (3 + (x) % 31))
</code></pre>
<p><a href="https://tio.run/##hZN9a9swEMb/96e4JaxIWZvUjhdK3RTKVtigY9CkdFCKEbIyi3lysOQ0W8m@enay0xfZSSpiBT93z@9OwsePeMbUz/W6m4iZVAK@XfyIp9/j26@fp1/IkgL5d1xmGQxg6EMPiJXOzyGEA3gVGDhpB7hR6ogBRfNH@IDGI/ADGxvim6W9r7LXgx58SgX/BQuWyUSaPyAVzAsxL3IutM4L4LlCXeZKQ2/gdeUMAoQ6/frIrB4K78YQel1RFOjsXC7nghuRuNlDCuMxBB1MQ/LM82wPLONlxowAhJ2dgaK24UN4kCbNSwP5QhSzLH@oWthcWUWzWKQTNBBc/s3VlfUTUhNovVsJd9thXa46skmZcVujeHqsZLQLp6/LXkwml9fTjQGrxBPDjOQx0xqdxOE1WqwOjv@H0OnUjeANMZVoMLnL9WnkCgEK/X6/oY5ClHf0Fge2uwbFfkubm4m2huh2VthiIX437SW4g3fS5oX7eOEbPH9kjY0Se3gnb/CGQYuHJfYAX6I7iKOQNE@MRVoc1ALqtZyR50ll4DeTiixymVB49ACXFQth7u5hDI84L/g7XkVVSOPs8BQQt8m1qz3uTAOzM64NQ5ZY4uxrjdNuP6snF2daNGf49DnqcOesEMqkQsu/zDQwdmGzZaGasDuU76PnRLw/VmbmdJvTr9NW3mr9Hw" rel="nofollow noreferrer" title="C (clang) – Try It Online">Try it online!</a> <a href="https://tio.run/##hZRtb9owEMff51PcQGtj1kATMlSVB6namDapU6XBtEpVhTzHLFZTB8UOD@vYV2fnhJUmAWoRo/zv7ndnx@efVIUbRjUMQMcPXKomg17vdHjz6XRTD/hUSA5fr24n45vJjy8fx5/tJQH773kaRdCCtgsNsI00GIAPJ/DC0Cq4neBESEH0CAa/h3cY6IDrGVsb3wztbea9aTXgQ8jZA8xpJAKhVyAkzBI@S2LGlYoTYLFEXcRSQaNl1cUUPIQW6nWRmT0E3vTBt@o8STCyNlzOONM8KHq3CfT74NXQDclTyzI10IilEdUcENbrgSSm4DNYCB3GqYZ4zpNpFC@yErZbltEMFuk2Btg43O/X1ybetnMCyWcj4WwqzNNlS9YhfpNCaQRXj5m0KsLJy7RXo9Hw23gbgFkmI021YBOqFEbaBV6pxGzh@H8GtVpeCO4QlYHCc1HkuqRbFDwUms1mSe34KB@obeKZ6koUc5a2O9PdayL7WX6FhfjDtJ3xAO@iyvOP8fxXeG7HBJZSHOFdvMJrexUepjgC3FkPEDu@XV4xJqlwUPOIVYnsWpaQGh6pkPY8FgGBJwtwGDHh@u4e@vCE/YK/83U3MynsHRYC4ra@ZlTbnSqgpseVpsjiS@x9pbDbzbH6H8Wo4uUevny2FrgzmnCpQ67Eb6pLGDOw2DSRZdgdyvfdZ0fcP5pG@nJfpJu7ra21hReoxSIqf4EzVSup6dKJZbQC53arBunjzMmv3N3N6w1OXPgDCwZOtPkH" rel="nofollow noreferrer" title="Bash – Try It Online">Verify the score!</a></p>
<p>Explanation: The first part masks out the bits corresponding to <code>2⁴</code>, <code>2⁹</code>, <code>2¹⁴</code> etc., then counts just those bits by multiplying by a shifted mask and shifting. This value is multiplied by <code>5</code>. Any remaining bits are extracted via <code>% 31</code> and these are counted in a similar way to @TavianBarnes' answer by adding <code>3</code> and dividing into <code>12</code>. In fact this can be done for any number of bits up to <code>8</code> using the Fibonacci numbers:</p>
<pre class="lang-c prettyprint-override"><code>2 - 2 / (1 + (x) % 7)
3 - 6 / (2 + (x) % 15)
4 - 12 / (3 + (x) % 31)
5 - 25 / (5 + (x) % 63)
6 - 48 / (8 + (x) % 127)
7 - 91 / (13 + (x) % 255)
</code></pre>
<p>For specific values of <code>n</code> the score can be reduced by folding the constants.</p>
<h1>n = 128, score <s>10622</s> 10362</h1>
<pre class="lang-c prettyprint-override"><code>#define MAX_TO_WIDTH(x) (0x8421084210842108421084210842108ull * ((x) &gt;&gt; 4 &amp; 0x1084210842108421084210842108421ull) / 0x8000000000000000000000000000000ull * 5 + 4 - 12 / (3 + (x) % 31))
</code></pre>
<p>Can't try it online but <a href="https://tio.run/##hZRtb9owEMff51PcQGtjVh4SsgqVB6namDapU6XBtEpVhTzHLFZTB8UOhHV8dnZOWFkSoBYxyt39f3d2fP5JVbBlVMMIdPTIpWoxGAzOx7efzrd1n8@F5PD1@m42vZ39@PJx@tlOCdidtOe5Tuf4lIQhNMA2waMReHAGnfRUPE4oIdDGuF7n5MjR7@EdYpvguKixu/hmcr2FrkPItt2ADwFnj7CkofCFXoOQsIj5Io4YVyqKgUUS7SKSChptqy7m4CK0sE4HmdlD4M0QPKvO4xiVtXG64ExzvxjdJTAcglvDMCTPLcvUQEOWhFRzQNhgAJKYgi9gJXQQJRqiJY/nYbTKSthtdUYzWKTbKLBxON9vbozetnMCyWdjwtlUmKfLlqwD/JaF0giuHjNpVYST/9NeTybjb9OdALPMJppqwWZUKVTaBV6pxGzh@H8BtVpeCO4Qlb7C81TkOqRfNLhoaLVaJeulh@Yjtc1cU12JYk7abmf6B13kMMursBB/nLZ3HuH1qjzvFM97hedcGmEpxQle7xVe163wMMUJ4N57hHjp2eUVY5IKB20usSrKvmUJqeGJCmkvI@ETeLYAhzHGXN8/wBCesV/w19n0M5fC3mEBIG4Xa0a13akCanpcaYosnmLvK4Xdbo7VPxWjipd7@OrFW@AuaMylDrgSv6kuYczAYpNYlmH3aH7ovwTi/tEk1FeHlE4etrE2Fl68Fgup/AXNuVpLTdNmJMM1NO92Vj95WjTzq3p/Y7ujMwf@wIpBM9z@BQ" rel="nofollow noreferrer" title="Bash – Try It Online">Verify the score!</a></p>
<h1>n = 64, score <s>10473</s> 10209</h1>
<pre class="lang-c prettyprint-override"><code>#define MAX_TO_WIDTH(x) (0x1084210842108421ull * ((x) &amp; 0x842108421084210ull) / 0x800000000000000 * 5 + 4 - 12 / (3 + (x) % 31))
</code></pre>
<p><a href="https://tio.run/##hZNha9swEIa/@1fcEjakrE1sxwuhbj6UrbBBx2DJ2KAUI2RlFvPkYCmpt5Lfnp3srK3sJBWxgu/ufe6V8PFznjP1c7frp2IplYDPVz@SxZfk@6cPi4@kokD8KvCnUfhsW@c5DIDY7BvwKzfpY5bCyMZ9Z6HkHbyFCM4hCLGAjPHNMl7DOKB0NxrA@0zwX7BhuUyl@QNSwaoUq7LgQuuiBF4ojMtCaRiMvL5cQohQx3CAzPqh8GoGkdcXZYnK3nW1EtyI1K0eU5jNIOxhGZKXnmc9sJyvc2YEIOzyEhS1hs/gXpqsWBsoNqJc5sV9bWF/ZzXNYpFOUEBwBd9ubqyekIZAm92GcLcOm3b1kU3GjGuN4umxk9EunD5vezWfX39d7AXYJZkbZiRPmNaoJA6vZbE@OP6fQa/XGMEbYirVYAqXG9DYDYQYGA6HregkwvARb0lo3bUo9gva30x8MEUPs6IOC/HHaU/JI7xplxed4kUv8IKJFbZanOBNX@CNww4PW5wAPmWPECcRaZ8Ym3Q4GAup11HGnieVgd9MKrIpZErhwQNcNlgKc3sHM3jAecGfv43rlMbZ4Rkgbl9rV3fcmQZmZ1wbhixR4exrjdNuP6v/Ks60aM/wxWPW4a5YKZTJhJZ/mWlh7EKz61K1YbcYvosfC/H@2Do3F4eUQVO29ba7fw" rel="nofollow noreferrer" title="C (clang) – Try It Online">Try it online!</a> <a href="https://tio.run/##hZR/b9owEIb/z6e4gdbGrIEkZAgVqFStTJvUqdLotEpVhbzELFZTB8UOhHV8dnZOWGkSoBYxyv147rXj8y8qw41PFVyAih@ZkG0fhsPT8c3n000zYDMuGHy7vJve3kx/fr26/WJmBEw7c@y@576a0iiCFpjaewJ2Vnba6CXQ0Xa7NDDlI3wADyxwXAwwu/imGe@h6xCy6bTgU8j8R1jQiAdcrYALmCdsnsQ@kzJOwI8F2nksJLQ6RpPPwEVoSbCDzPwh8G4EntFkSYKZjXE2Z75iQTm6S2A0AreBYUieGYbWQCM/jahigLDhEATRgs9gyVUYpwriBUtmUbzMJWz3LKdpLNJNTDBxOD@ur3W@aRYEUszahLNWWJTLl6xC/CglaQRXj5WULMPJ67KXk8n4@@02AatMJ4oq7k@plJhplngVifnC8f8MGo1CCO4QFYHEg1HmOmRQNrhoaLfbFWvPQ/MBbVNXq6tQ9Ana7sxgr4vsZ3k1FuIP03bOA7x@necd43lv8JyeTqyUOMLrv8HrujUeljgC3HkPEHueWV0xFqlx0OYSo5Y5MAwuFDxRLsxFzAMCzwbg0MaEqfsHGMEz9gv@7PUgd0nsHT8ExG1j9ai3O5VAdY9LRZHFMux9KbHb9bH6n@VTyao9fP7iLXHnNGFChUzyP1RVMHqg2DQRVdg9mh8GL4G4fzSN1Pm@TKcIWxtrA29Qw4@o@A3WTK6EopkVi2gF1t3WGqRPc6u4c3dXr3tx4sBfWPpgRZt/" rel="nofollow noreferrer" title="Bash – Try It Online">Verify the score!</a></p>
<p>Edit: Saved a bunch from all the scores by removing <s>a</s> two sets of unnecessary parentheses (in some cases I had to switch a right shift to a divide by a power of <code>2</code>).</p>
</div>
<div id="pu1" class="pu"><h1>Score: <s>13877</s> 13613, <span class="math-container">\$n = 2040\$</span>.</h1>
<p><em>-264 thanks to l4m2</em></p>
<pre class="lang-c prettyprint-override"><code>#define CHUNK(m, mask) (m) / ((m) % mask + 1) / mask % mask
#define INTERP(m) 7 - 86 / ((m) % 255 + 12)
#define MAX_TO_WIDTH(m) (CHUNK(m, 255) * 8 + INTERP(m))
</code></pre>
<hr />
<p>This idea is due to Hallvard B. Furuseth on a <a href="https://groups.google.com/g/comp.lang.c/c/NfedEFBFJ0k/m/9HAqis6IDqcJ" rel="nofollow noreferrer">comp.lang.c post</a> in 2003.  It uses this helper function</p>
<pre class="lang-c prettyprint-override"><code>#define CHUNK(m, mask) (m) / ((m) % mask + 1) / mask % mask
</code></pre>
<p>Which is used to make a repeating sequence like this:</p>
<p><span class="math-container">$$
\begin{aligned}
a_{i,j} &amp; = \texttt{CHUNK}(2^i - 1, 2^j - 1) \\
a_{0,j}, a_{1,j}, a_{2,j}, \ldots &amp; = \underbrace{0, \ldots, 0}_{\text{$j$ times}}, \underbrace{1, \ldots, 1}_{\text{$j$ times}}, \cdots, \underbrace{2^j-2, \ldots, 2^j - 2}_{\text{$j$ times}}, 0, \ldots
\end{aligned}
$$</span></p>
<p>You can play around with it in Python to see:</p>
<pre class="lang-python prettyprint-override"><code>&gt;&gt;&gt; def CHUNK(m, mask):
...     return (m) // ((m) % mask + 1) // mask % mask
... 
&gt;&gt;&gt; def a(i, j):
...     return CHUNK(2**i - 1, 2**j - 1)
... 
&gt;&gt;&gt; [a(i, 2) for n in range(10)]
[0, 0, 1, 1, 2, 2, 0, 0, 1, 1]
&gt;&gt;&gt; [a(i, 3) for n in range(10)]
[0, 0, 0, 1, 1, 1, 2, 2, 2, 3]
&gt;&gt;&gt; [a(i, 4) for n in range(10)]
[0, 0, 0, 0, 1, 1, 1, 1, 2, 2]
&gt;&gt;&gt; [a(n, 5) for n in range(5 * (2**5 - 1))] == \
... [i for i in range(2**5 - 1) for j in range(5)]
True
</code></pre>
<p>This sequence has <span class="math-container">\$j \, (2^j - 1)\$</span> values before it wraps, meaning</p>
<p><span class="math-container">$$
\texttt{CHUNK}(2^i - 1, 2^j - 1) = \lfloor i/j \rfloor \quad \text{for all $i &lt; j \, (2^j - 1)$.}
$$</span></p>
<p>This is almost enough—what we want is <span class="math-container">\$j \, \lfloor i/j \rfloor + (i \bmod j) = i\$</span>.  We can get <span class="math-container">\$(i \bmod j)\$</span> in various ways.  For now, let's fix <span class="math-container">\$j = 8\$</span>.  We know that <span class="math-container">\$2^i \pmod {2^8 - 1}\$</span> will have period 8:</p>
<pre class="lang-python prettyprint-override"><code>&gt;&gt;&gt; [(2**i - 1) % 255 for i in range(16)]
[0, 1, 3, 7, 15, 31, 63, 127, 0, 1, 3, 7, 15, 31, 63, 127]
</code></pre>
<p>And we can brute force a linear interpolation of these that maps them to <code>[0, 1, 2, ...]</code>:</p>
<pre class="lang-python prettyprint-override"><code>&gt;&gt;&gt; [(7 - 86 // ((2**i - 1) % 255 + 12)) for i in range(16)]
[0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7]
</code></pre>
<hr />
<p>The <a href="https://groups.google.com/g/comp.lang.c/c/NfedEFBFJ0k/m/9HAqis6IDqcJ" rel="nofollow noreferrer">original post</a> is more like this:</p>
<pre class="lang-c prettyprint-override"><code>#define CHUNK(m, mask) (m) / ((m) % mask + 1) / mask % mask
#define INTERP(m) 4 - 12 / ((m) % 31 + 3)
#define MAX_TO_WIDTH(m) \
    (CHUNK(m, 0x3fffffffL) * 30 + CHUNK((m) % 0x3fffffff, 31) * 5 + INTERP(m))
</code></pre>
<p>Which would have score: 21477, <span class="math-container">\$n = 30 \cdot (2^{30} - 1) = 32212254690\$</span>.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/271753/">271753</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




