<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::255464</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>129</td><td>Pip</td><td>221214T080919Z</td><td><a href="https://codegolf.stackexchange.com/questions/255464/cgac2022-day-14-chimney-cleaning/255479#255479">jezza_99</a></td></tr>
<tr d-ix="1"><td>149</td><td>Python 3</td><td>221215T021729Z</td><td><a href="https://codegolf.stackexchange.com/questions/255464/cgac2022-day-14-chimney-cleaning/255502#255502">tsh</a></td></tr>
<tr d-ix="2"><td>173</td><td>Python3 + scipy</td><td>221214T220002Z</td><td><a href="https://codegolf.stackexchange.com/questions/255464/cgac2022-day-14-chimney-cleaning/255494#255494">GandhiGa</a></td></tr>
<tr d-ix="3"><td>301</td><td>Python3</td><td>221214T005848Z</td><td><a href="https://codegolf.stackexchange.com/questions/255464/cgac2022-day-14-chimney-cleaning/255468#255468">Ajax1234</a></td></tr>
<tr d-ix="4"><td>nan</td><td>J</td><td>221214T045628Z</td><td><a href="https://codegolf.stackexchange.com/questions/255464/cgac2022-day-14-chimney-cleaning/255475#255475">Jonah</a></td></tr>
<tr d-ix="5"><td>042</td><td>Charcoal</td><td>221214T013549Z</td><td><a href="https://codegolf.stackexchange.com/questions/255464/cgac2022-day-14-chimney-cleaning/255470#255470">Neil</a></td></tr>
<tr d-ix="6"><td>108</td><td>JavaScript Node.js</td><td>221214T061257Z</td><td><a href="https://codegolf.stackexchange.com/questions/255464/cgac2022-day-14-chimney-cleaning/255476#255476">tsh</a></td></tr>
<tr d-ix="7"><td>129</td><td>JavaScript ES2020</td><td>221214T022406Z</td><td><a href="https://codegolf.stackexchange.com/questions/255464/cgac2022-day-14-chimney-cleaning/255471#255471">Arnauld</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://github.com/dloscutoff/pip" rel="nofollow noreferrer">Pip</a>, <s>125</s> 129 bytes</h1>
<pre><code>@&lt;($+(({(FL1ZGc*l)RA_bMS[a-1;a+1;a+c&lt;c*l&amp;a+c|a;a-c&gt;=0&amp;a-c|a]}MU{[a;b//5;h:#\a+1]}ME(k:WV(@&gt;aAL2ZG(l:#@a))))AE(_-4*(_//5)Mk))UWh)

</code></pre>
<p>Try It Online!</p>
<p>I feel like there should be a much neater and golfier way of doing this in pip, but I couldn't figure it out</p>
<p>Edit: forgot to delete the temporary last row</p>
</div>
<div id="pu1" class="pu"><h1><a href="https://docs.python.org/3.8/" rel="nofollow noreferrer">Python 3</a>, 149 bytes</h1>

<pre class="lang-python prettyprint-override"><code>lambda m:[o:=[[0]*len(m.pop(0))],[[n[1]%5+sum(i//5for i in n)for n in zip(x,y,y[1:]+[y[-1]],[y[0]]+y[:-1],z)]for x,y,z in zip(o+m,m+o,m[1:]+o+o)]][1]
</code></pre>
<p><a href="https://tio.run/##RY7NasMwEITvfQpdCtpqE9tJHGKBn2S7B4XGRGD94Lg08su7kiEE9vANO7M7Mc334I@XOK1D/72Oxl1/jHCagu6Jav4ab166fQxR1gCMRJ4a/mzV49dJW1XtECZhhfXCQ0FfcLFRPjFhokazokS7hnM05XusEukscQEu/mJbXpmgHDoV0G25oAIw52@rKVVQdB2KmlEUznM4FT6eN9Ec3ouXp92YP/7udrwJ45MspQ0SA@g4WT9Lo/tBGoD1Hw" rel="nofollow noreferrer" title="Python 3.8 (pre-release) – Try It Online">Try it online!</a></p>
</div>
<div id="pu2" class="pu"><h1>Python3 + scipy, 173 bytes (broken)</h1>
<p>To be clearest, this solution doesn't <em>exactly</em> work, but its so close to working and uses a different method than the other answers now for potentially a big byte savings, so I decided to post it to see if someone can get inspired to get it over the line.</p>
<pre class="lang-python prettyprint-override"><code>from scipy.signal import convolve2d as c
import numpy as n
g=lambda i:c(n.vstack([[0,0,0],i[1:],[0,0,0]]),[[0,1/5,0],[1/5,1/5,1/5],[0,1/5,0]],'same','symm')[1:].astype(int)
</code></pre>
<p><a href="https://onecompiler.com/python/3yrvzz7f7" rel="nofollow noreferrer">Run online at onecompiler.com</a></p>
<h3>Output</h3>
<p>Given the first test case:</p>
<pre><code>[[ 0 99  0]
 [ 0  0 24]
 [36  0 12]
 [ 0  0  0]
 [ 0 50  0]]
</code></pre>
<p>This outputs:</p>
<pre><code>[[ 7  4 12]
 [14  9  9]
 [ 7 10  2]
 [10 10 10]
[ 0 10  0]]
</code></pre>
<p>Instead of the expected:</p>
<pre><code>[[ 7  4 14]
 [15  9 10]
 [ 7 10  2]
 [10 10 10]
 [ 0 10  0]]
</code></pre>
<h3>Explained</h3>
<pre class="lang-python prettyprint-override"><code>import scipy
import scipy.signal
import numpy as np
# We can solve this with matrix convolutions and row shifts in fewer operations (and hopefully less bytes)
# than iteration.
def g_ungolfed(i):
    # 1. pad arrays with 0-rows on both y-sides
    ## Slicing the first row off lets smoke 'escape' out of the top during the initial shift
    ## Padding the first row with a temp row lets smoke 'escape' out the top during dispersion.
    ## Padding the last row lets us shift the smoke up 1 row later on
    i_padded = np.vstack([[0,0,0],i[1:], [0,0,0]])
    print(&quot;padded&quot;, i_padded)
    # 2. Run the convolution to do the smoke pattern
    ## define a convolution kernel to follow the 20% smoke dispersal pattern --
    k = [
        [0,1/5,0],
        [1/5,1/5,1/5],
        [0,1/5,0],
    ]
    ## mode=&quot;same&quot; keeps the output matrix in the same dimensions as the i_padded input
    ## boundary=&quot;symm&quot; handles the correct behavior for the smoke-fill pattern on the left-right boundaries of the chimney
    # The floor(n/5) integer division isn't respected here which is why the results are wrong.
    dispersed = scipy.signal.convolve2d(i_padded, k, mode=&quot;same&quot;, boundary=&quot;symm&quot;)
    # 3. Slice off the temp top row
    print(&quot;intermediate&quot;, dispersed)
    dispersed_shifted = dispersed[1:]
    # 4. cast the results to int
    return dispersed_shifted.astype(int)
</code></pre>
</div>
<div id="pu3" class="pu"><h1>Python3, 301 bytes:</h1>
<pre class="lang-py prettyprint-override"><code>E=enumerate
def f(b):
 while any(map(any,b)):
  T=[]
  for x,r in E(b):
   for y,c in E(r):
    b[x][y]=0;p=x-1
    if x:
     b[p][y]=c
     for X,Y in(0,1),(-1,0),(1,0),(0,-1):
      K=0&lt;=y+Y&lt;len(b[0]);b[p][y]-=c//5*K
      if-1&lt;p+X&lt;len(b):T+=K*[(p+X,y+Y,c//5)]
  for x,y,v in T:b[x][y]+=v
  yield b
</code></pre>
<p><a href="https://tio.run/##RU/BjoIwED2vXzHHVoZYdN2sSI@euHLQNBwES2yCtWlYl34921I2Jk3nzXtvXmaMG@5Pvfs2dppOXOqfh7TXQa5usoOONDRfwe9d9RKu2pHH1RBfsaGBh4qL2pfuaWFEC0rDKU5EzmEbORs5aMRYC1dzdjR8TLOZUx2MUfWymeU2tiHijBcfQRhmFEmaIfMl/gzTbIkFKDkruEsuRS81aQSr6XEJS3m72ezX5WJUXZoVJjlHI82rhJdrQTyDfhyDl75PcvgKB1T5snjCX15zSvY3aKbgUUHviBAM4XBAYDVCwP5tPwPefc1Ntn0L/579jGt/xIexSg9E0ekP" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu4" class="pu"><h1><a href="http://jsoftware.com/" rel="nofollow noreferrer">J</a>, <sup>71 61</sup> 58 bytes</h1>
<pre><code>0(1}.$$,+[:(+/-1&amp;#.)5&lt;.@%~,*1=[:|@-/~$j./@#:i.@#@,)@,0,~}.
</code></pre>
<p><a href="https://tio.run/##jZBNa8MwDIbv@RXqki124ih2EqfELMN0sNPooVfj02hZe9llh8HW/PVMcRrKGIxhW9bHq0eg09itjPLtynRpGt1geoDeQAoCJBh6BcLj7vlplEydMUlE7gzLy0Ldxcj1PdrbQWSqd@bLFuWQnLC0sTmija3gVkgxnHHk0XaDsACY@43I@N@IAGDZJ3LmczZ3Xlopa/jPCXlpmbsKs94Gmv/vsP3L6xscQEMNCW2g68hMp2qgbulX1SUhQZOJov3H8Z2W55wUpKbNeQGTT7dqJr9uQ6Cqa2HR6OD7qHgA59YCGpKFHqUJRkEQrieHaKEg50AtCDUjxm8" rel="nofollow noreferrer" title="J – Try It Online">Try it online!</a></p>
</div>
<div id="pu5" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, <s>46</s> 42 bytes</h1>
<pre><code>ＩΦＥ⊞ＯθＥ⌊θ⁰Ｅι⁺λΣＥθΣＥν∧⁼¹⁺↔⁻κξ↔⁻μρ⁻÷∧ξπ⁵÷λ⁵κ
</code></pre>
<p><a href="https://tio.run/##XU9LawIxEL73V8xxAiP4BvG02BY8CFKPyx5SN2BoknXzWPz3aWbVCg0J870yk5wv0p87aXI@yOuus1a6Fqu4d626YU8wFXy2b8cULsy/1KB8UHjQTttksReCXa9dxJ0MET@1icpj6cZxLprgaFJAQ3AqNx7OEzqCqoz86JM0AWePbPUdOpPiOKfQG8GPKC/5J1sCL1i/072L73rQrcIrwarIL8Gw8LfGbmKbc13XU4LNpvyxIWBc9nzJeLEeyWz@Mp6Z1YibJk8G8ws" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Explanation:</p>
<pre><code>        θ                                   Input array
       ⌊                                    Minimum (any) row
      Ｅ                                     Map over cells
         ⁰                                  Zero
   ⊞Ｏ                                       Push to
     θ                                      Input array
  Ｅ                                         Map over rows
           ι                                Current row
          Ｅ                                 Map over cells
             λ                              Current value
            ⁺                               Plus
                θ                           Input array
               Ｅ                            Map over rows
                   ν                        Inner row
                  Ｅ                         Map over cells
                      ¹                     Literal integer `1`
                     ⁼                      Equals
                          κ                 Outer row index
                         ⁻                  Minus
                           ξ                Inner row index
                        ↔                   Absolute value
                       ⁺                    Plus
                              μ             Outer cell index
                             ⁻              Minus
                               ρ            Inner cell index
                            ↔               Absolute value
                    ∧                       Logical And
                                   ξ        Inner row index
                                  ∧         Logical And
                                    π       Inner cell value
                                 ÷          Integer divided by
                                     ⁵      Literal integer `5`
                                ⁻           Minus
                                       λ    Outer cell value
                                      ÷     Integer divided by
                                        ⁵   Literal integer `5`
                 Σ                          Take the sum
              Σ                             Take the sum
 Φ                                          Filtered where
                                         κ  Row index is not zero
Ｉ                                           Cast to string
                                            Implicitly print
</code></pre>
<p>For instance, in the example of <code>[[[0, 99, 0], [0, 0, 24], [36, 0, 12], [0, 0, 0], [0, 50, 0]]]</code>, when the outer loop is processing the <code>24</code> and the inner loop is processing the <code>12</code>, the cells are found to be adjacent, so <code>12/5=2</code> is diffused into the outer cell but <code>24/5=4</code> is diffused out, while when the inner loop is processing the two zero cells also adjacent to the <code>24</code> there is nothing to diffuse in while <code>4</code> still diffuses out each time. This results in a net total of <code>24+2-4+0-4+0-4=14</code> in that cell.</p>
</div>
<div id="pu6" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 108 bytes</h1>
<pre><code>a=&gt;a.map((r,y)=&gt;r.map((c,x)=&gt;(g=c=&gt;p+2&amp;&amp;c/5*(p-y&lt;3)+c%5*!p--+g((R=a[y-~(p&gt;1)])?R[x+p%2]??R[x]:0)|0)(c,p=3)))
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=RY7BSsNAEIZfJR5aZprdNU2MWOts7x4U2mPYw7JmQyHNLkmEBIov4iWIPpRvY9IowsD__cww___-WbmXfPiw9PXaWn73XWqSWpy0B6hZjyTr2RjWjQYKMiR9GC-X5jpdgef9Q4KhWaSrK895WADsSWc9fwMv16hwt8-60C9itZtI3Ud4jnB85ilBxN_Ms3U1aMqyiAWbDQsixYKJx4lvJk5uL2Yd_y_-btILq60WttQtoGjcKYeOZIdb46rGlbkoXQGPh-cn0bT1sSqOtgc9pmuyo84dhmHWHw" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>For cell (x, y), the value after function is:</p>
<pre><code>sum(
  floor(a[x,y]/5) only if (y is not 0),
  floor(a[x,y+1]/5),
  floor(a[x-1,y+1]/5),
  floor(a[x+1,y+1]/5),
  floor(a[x,y+2]/5),
  a[x,y+1] mod 5,
  floor(a[x,y+1]/5) only if (x is one of edge),
)
</code></pre>
</div>
<div id="pu7" class="pu"><h1>JavaScript (ES2020), 129 bytes</h1>
<pre><code>m=&gt;[...m,m[0].fill(0)].map((r,y,m)=&gt;r.map((v,x)=&gt;[-1,s=0,1,2].map(d=&gt;s-=1/(V=m[y+d%2]?.[x+~-d%2])?~(V/5)-~(v/5):0)|v+s)).slice(1)
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=RY7NSsNAFIX3fYq7Ee4lk-kk2tJaJt270IXQzZBFaTIlkMnITA0NasA3cO8miD6Ub2N-FOHC-Q7nwD3vn5XN8u5Dy6_Hkw5X369GJopzbphRIuW6KEsUlHKzf0B0rGGGZOImW7Nzb1QYMS8Fi1g81TKZ-FBGc9xJo5ogu4jTLVfnoA0HpG2Lu_mCwhbrXq4FPdeBJ-K-LA45RvQ75E1bhwYkKCUYrNcMRMpg4P7iq4Evl6OJ4v_gr7MYOd2A4d6aHB3IBNzE9cA10YbgaQZwsJW3Zc5Le8Sb-7tb7k-uqI6Fbsb3Gg313dnLtKvrJv0B" rel="nofollow noreferrer">Attempt This Online!</a></p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/255464/">255464</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




