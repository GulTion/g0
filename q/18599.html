<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::18599</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>nan</td><td></td><td>230901T140531Z</td><td><a href="https://codegolf.stackexchange.com/questions/18599/one-line-aquarium/264813#264813">user1194</a></td></tr>
<tr d-ix="1"><td>281</td><td>Perl</td><td>140116T211509Z</td><td><a href="https://codegolf.stackexchange.com/questions/18599/one-line-aquarium/18650#18650">KevinCol</a></td></tr>
<tr d-ix="2"><td>nan</td><td>Ruby</td><td>140116T101635Z</td><td><a href="https://codegolf.stackexchange.com/questions/18599/one-line-aquarium/18609#18609">John Dvo</a></td></tr>
<tr d-ix="3"><td>278</td><td>Python 3</td><td>140116T215700Z</td><td><a href="https://codegolf.stackexchange.com/questions/18599/one-line-aquarium/18661#18661">poke</a></td></tr>
<tr d-ix="4"><td>373</td><td>C</td><td>140116T183901Z</td><td><a href="https://codegolf.stackexchange.com/questions/18599/one-line-aquarium/18636#18636">Josh</a></td></tr>
<tr d-ix="5"><td>451</td><td>R</td><td>140116T082241Z</td><td><a href="https://codegolf.stackexchange.com/questions/18599/one-line-aquarium/18604#18604">plannapu</a></td></tr>
</table>
<div id="pu0" class="pu"><pre><code>from random import random as r
from time import sleep as s
F = { 1: &quot;}}&lt; }} ',')%s&quot;, 0: &quot;}}('_'){{%s&quot;, -1: &quot;%s(',' {{ &gt;{{&quot; }

# p: position (from left)
# d: direction (-1: left, +1: right)
# c: changing direction (0: not changing, +1: to right, -1: to left)
# b: bubble (0)
p, d, c, b = 9, 1, 0, 0

while 1:
    if c:
        p -= c*[1,4][2*d+c==1]
        if d:
            d = 0
        else:
            d, c = c, 0
    elif b % 5:
        b += 1
    else:
        # change direction
        if r() &lt; .3 or p * d in (-5,53):
            c = -d
        # start bubbling
        elif r() &lt; .1:
            b = 1
        # move forward
        else:
            p += d

    # print fish and sleep
    print('|{:&lt;70}|'.format(' '*p+(F[d]%' .oO*'[b%5])))
    s(2)
</code></pre>
</div>
<div id="pu1" class="pu"><h2>Perl, 281</h2>

<pre><code>@f=("s O(',' {{ &gt;{{","s}}('_'){{s","}}&lt; }} ',')O s");$d=1;@o=split//," *Oo. ";{$_="|".$"x$x.$f[$d+1].$"x(44-$x).'|
';s/O/$o[$b]/;s/s/    /g;print;if($b||$t){$b--if$b;if($t){$d+=$t;$t=0if$d}}else{$x+=$d;$t=($x&lt;1)-($x&gt;43);if(!$t){$b=5if.9&lt;rand;if(.7&lt;rand){$t=-$d;$b=0}}}sleep 2;redo}
</code></pre>

<p>or more clearly</p>

<pre><code>@f = ( "s O(',' {{ &gt;{{", "s}}('_'){{s", "}}&lt; }} ',')O s" );
$d = 1;
@o = split //, " *Oo. ";
{
    $_ = "|" . $" x $x . $f[ $d + 1 ] . $" x ( 44 - $x ) . '|
';
    s/O/$o[$b]/;
    s/s/    /g;
    print;
    if ( $b || $t ) {
        $b-- if $b;
        if ($t) { $d += $t; $t = 0 if $d }
    }
    else {
        $x += $d;
        $t = ( $x &lt; 1 ) - ( $x &gt; 43 );
        if ( !$t ) {
            $b = 5 if .9 &lt; rand;
            if ( .7 &lt; rand ) { $t = -$d; $b = 0 }
        }
    }
    sleep 2;
    redo
}
</code></pre>

<p>Fish turning correctly. Bubbles blowing.</p>

<p><strong>285</strong> - if you like the real aquarium feel and not the scrolling version:</p>

<pre><code>$|=@f=("s O(',' {{ &gt;{{","s}}('_'){{s","}}&lt; }} ',')O s");$d=1;@o=split//," *Oo. ";{$_="\r|".$"x$x.$f[$d+1].$"x(44-$x).'|';s/O/$o[$b]/;s/s/    /g;print;if($b||$t){$b--if$b;if($t){$d+=$t;$t=0if$d}}else{$x+=$d;$t=($x&lt;1)-($x&gt;43);if(!$t){$b=5if.9&lt;rand;if(.7&lt;rand){$t=-$d;$b=0}}}sleep 2;redo}
</code></pre>
</div>
<div id="pu2" class="pu"><h1>Ruby, <del>291</del> 289</h1>

<pre><code>l="(',' {{ &gt;{{";m="    }}('_'){{    ";r="}}&lt; }} ',')";w=?\s;s=w*6;q="|#{r+s*9}|"
f=-&gt;*s{(puts q;sleep 2)if q.sub! *s}
loop{rand&gt;0.1||(f[") ",")."]||f[" (",".("];f[?.,?o];f[?o,?O];f[?O,?*];f[?*,w])
q[7]==?(||q[-8]==?)||rand&lt;0.3?f[s+l,m]&amp;&amp;f[m,r+s]||f[r+s,m]&amp;&amp;f[m,s+l]:f[w+l,l+w]||f[r+w,w+r]}
</code></pre>

<p>The fish is eleven characters long, making the aquarium 6*9+11+2 = 67 characters wide, which fits neatly in the required tolerance.</p>

<p>The <code>f</code> lambda function does all the heavy lifting: it accepts a substitution as a pair of arguments, then attempts to apply the substitution on the aquarium. If it succeeds, it paints one frame of the animation. It then reports the success value as <code>2</code> (the delay taken) or <code>nil</code> (delay not executed).</p>

<p>Fish will not blow bubbles twice in succession. (Fix: <code>...while rand&gt;0.1</code> - 4 characers)</p>

<p>Fish may blow bubbles even before a forced turn. (Fix: rearrange the branching structure)</p>

<p>There is a frame where the bubble is completely gone (including the <code>*</code>) but the fish has not moved into the resulting void. This follows the letter, but not the example. (Fix: replace <code>f[?*,w]</code> with <code>q[?*]=w</code> - free)</p>

<p>Does not clear the console. Fix: add <code>`clear`</code> (Unix) or <code>system 'cls'</code> (Windows console) before <code>puts q</code> to fix <sup>(<a href="https://stackoverflow.com/questions/116593/how-do-you-clear-the-irb-console">Ref.</a>)</sup> or use <code>print</code> instead of <code>puts</code> and prepend <code>\r</code> to the aquarium (<a href="https://codegolf.stackexchange.com/questions/18599/one-line-aquarium/18609?noredirect=1#comment36204_18609">suggested by @manatwork</a>).</p>

<p><strong>Readable version:</strong></p>

<pre><code># l - left fish; m - middle fish + space; r - right fish
# w - single space character; s - six spaces; q - the aquarium
l="(',' {{ &gt;{{"; m="    }}('_'){{    "; r="}}&lt; }} ',')";
w=" "; s=w*6; q="|#{r+s*9}|"
f = -&gt;k,v do
  if q.sub! k,v
    puts q
    sleep 2
    return 2
  else
    return nil
  end
end

loop do
  if rand &lt; 0.1
    f[") ",")."] || f[" (",".("]
    f[?.,?o]; f[?o,?O]; f[?O,?*]; f[?*,' ']
  end
  if q[7] == "(" || q[-8] == ")" || rand &lt; 0.3
    (f[s+l,m] &amp;&amp; f[m,r+s]) || (f[r+s,m] &amp;&amp; f[m,s+l])
  else
    f[w+l,l+w] || f[r+w,w+r]
  end
end
</code></pre>
</div>
<div id="pu3" class="pu"><h1>Python 3 (278)</h1>

<p>Previously: 334, 332, 325, 302, 300, 299, 291, 286, 284, 281</p>

<pre><code>import random,time
r=random.random
F="}}('_'){{%s","}}&lt; }} ',')%s","%s(',' {{ &gt;{{"
p,d=9,1
c=b=0
while 1:
 if c:p-=c+c*3*(2*d+c==1);d=c-c*d*d;c-=d
 elif b%5:b+=1
 elif.3&gt;r()or{p*d}&lt;{-5,53}:c=-d
 elif.1&gt;r():b=1
 else:p+=d
 print('|%-70s|'%(' '*p+F[d])%' .oO*'[b%5]);time.sleep(2)
</code></pre>

<p>Golfing in Python is always difficult due to the indentation requirements of statements, but despite that, this went incredibly well!</p>

<p>Big thanks to Volatility and DSM for helping me golf this so much further.</p>

<h3>Clean version</h3>

<pre><code>from random import random as r
from time import sleep as s
F = { 1: "}}&lt; }} ',')%s", 0: "}}('_'){{%s", -1: "%s(',' {{ &gt;{{" }

# p: position (from left)
# d: direction (-1: left, +1: right)
# c: changing direction (0: not changing, +1: to right, -1: to left)
# b: bubble (0)
p, d, c, b = 9, 1, 0, 0

while 1:
    if c:
        p -= c*[1,4][2*d+c==1]
        if d:
            d = 0
        else:
            d, c = c, 0
    elif b % 5:
        b += 1
    else:
        # change direction
        if r() &lt; .3 or p * d in (-5,53):
            c = -d
        # start bubbling
        elif r() &lt; .1:
            b = 1
        # move forward
        else:
            p += d

    # print fish and sleep
    print('|{:&lt;70}|'.format(' '*p+(F[d]%' .oO*'[b%5])))
    s(2)
</code></pre>
</div>
<div id="pu4" class="pu"><h2>C, <strike>400</strike> <strike>394</strike> 373 characters</h2>

<pre><code>#define p printf
#define a(x) l[5]=r[11]=x;d();
char *l="      (',' {{ &gt;{{",*f="    }}('_'){{    ",*r="}}&lt; }} ',')      ",*c,s=7,i,*T;d(){p("|");for(i=0;i&lt;s;i++)p(" ");p(c);for(i=0;i&lt;70-s;i++)p(" ");puts("|");sleep(2);}b(){a(46)a(111)a(79)a(42)a(32)}t(){T=c;c=f;d();c=T==r?l:r;d();}m(){c==l?s--:s++;d();s&gt;69||s&lt;1?t():0;}main(){c=r;for(d();;)i=rand()%10,i?i&gt;6?t():m():b();} 
</code></pre>

<p>With whitespace:</p>

<pre><code>#define p printf
#define a(x) l[5]=r[11]=x;d();
char *l="      (',' {{ &gt;{{",
     *f="    }}('_'){{    ",
     *r="}}&lt; }} ',')      ",
     *c, 
     s=7,
     i,  
    *T; 
d(){
  p("|");
  for(i=0;i&lt;s;i++)
    p(" ");
  p(c);
  for(i=0;i&lt;70-s;i++)
    p(" ");
  puts("|");
  sleep(2);
}
b(){
  a(46)
  a(111)
  a(79)
  a(42)
  a(32)
}
t(){
  T=c;
  c=f;
  d();
  c=T==r?l:r;
  d();
}
m(){
  c==l?s--:s++;
  d();
  s&gt;69||s&lt;1?t():0;
}
main(){
  c=r;
  for(d();;)
    i=rand()%10,
    i?i&gt;6?t():m():b();
}
</code></pre>
</div>
<div id="pu5" class="pu"><h3>R, 451 characters</h3>

<p>A first attempt:</p>

<pre><code>f=function(j,p){cat("\r|",rep("-",j),p,rep("-",50-j),"|",sep="");Sys.sleep(2)};d=F;j=5;P=c("--}}(\'_\'){{--","-}}&lt; }} \',\')-","-(\',\' {{ &gt;{{-");B=c("-",".","o","O","*","-");g=Vectorize(gsub,v="replacement");b=list(g("-$",B,P[2]),g("^-",B,P[3]));repeat{if(j&lt;5 &amp; d){d=!d;j=j+1;f(j,P[1])};if(j&gt;44 &amp; !d){d=!d;f(j,P[1]);j=j-1};if(runif(1)&lt;.1){for(i in b[[d+1]])f(j,i)}else{f(j,P[d+2])};if(runif(1)&lt;.3){d=!d;f(j,P[1]);f(j,P[d+2])};if(d){j=j-1}else{j=j+1}}
</code></pre>

<p>Indented:</p>

<pre class="lang-r prettyprint-override"><code>f=function(j,p){ #Printing function (depends of buffer and kind of fish)
    cat("\r|",rep("-",j),p,rep("-",50-j),"|",sep="")
    Sys.sleep(2)
}
d=F   #Direction: if FALSE left to right, if TRUE right to left.
j=5   #Buffer from left side of tank
P=c("--}}(\'_\'){{--","-}}&lt; }} \',\')-","-(\',\' {{ &gt;{{-") #The fish
B=c("-",".","o","O","*","-") #The bubble sequence
g=Vectorize(gsub,v="replacement")
b=list(g("-$",B,P[2]),g("^-",B,P[3])) #Fish+bubble
repeat{
    if(j&lt;5 &amp; d){ #What happens if too close from left side
        d=!d
        j=j+1
        f(j,P[1])
        }
    if(j&gt;44 &amp; !d){ #What happens if too close from right side
        d=!d
        f(j,P[1])
        j=j-1}
    if(runif(1)&lt;.1){ #If bubble sequence initiated
        for(i in b[[d+1]])f(j,i)
        }else{f(j,P[d+2])} #Otherwise
    if(runif(1)&lt;.3){ #If fish decide to turn
        d=!d
        f(j,P[1])
        f(j,P[d+2])
    }
    if(d){j=j-1}else{j=j+1} #Increment or decrement j depending on direction
}
</code></pre>

<p>It prints the aquarium as stdout on a single line (then 2s break and carriage return before the aquarium at t+1 is printed).  </p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/18599/">18599</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




