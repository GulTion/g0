<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::189111</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>557</td><td>Python3</td><td>240218T171439Z</td><td><a href="https://codegolf.stackexchange.com/questions/189111/formula-one-strategist/270138#270138">Ajax1234</a></td></tr>
<tr d-ix="1"><td>102</td><td>Jelly</td><td>190802T192612Z</td><td><a href="https://codegolf.stackexchange.com/questions/189111/formula-one-strategist/189183#189183">Nick Ken</a></td></tr>
<tr d-ix="2"><td>234</td><td>JavaScript ES6</td><td>190802T095511Z</td><td><a href="https://codegolf.stackexchange.com/questions/189111/formula-one-strategist/189143#189143">Arnauld</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>Python3, 557 bytes</h1>
<pre class="lang-py prettyprint-override"><code>E=enumerate
I=lambda t,c:(c+1)%len(t)
F=lambda t,C:t[C]not in{'P','#'}and t[I(t,C)]not in{'P','#'}and t[C]!=t[I(t,C)]
def f(t,l):
 H=100000
 T=[[15,263,0],[10,161,30],[8,128,45]]
 q=[(H,l,[i],0,0)for i,_ in E(T)]
 U=[]
 for h,l,u,r,c in q:
  if l==0:U+=[(u,r)];continue
  if c==0 and h&lt;H:l-=1
  m=T[u[-1]]
  if'P'==t[c]:
   C,K,W=I(t,c),0,0
   while'P'!=t[C]:W+=1;K+=F(t,C);C=I(t,C)
   if h&lt;m[0]*W+m[1]*K:
    for i,_ in E(T):q+=[(H,l,u+[i],r+W*1750,I(t,c))]
    continue
  q+=[(h-m[0]-F(t,c)*m[1],l,u,r+F(t,c)*m[2],I(t,c))]
 return min(U,key=lambda x:x[1])
</code></pre>
<p><a href="https://tio.run/##jVFdj5pAFH3nV0zdNIKMgfFj16DTF7LGjS8@aHwYRmIRAymMSiDdTe1vt/fC4rLWNL2JONxz7jn3DMe3PDqo/uiYXS7PPFRFGmbbPNReeLJNv@@2JKeBowcmM74modJzQ5t@IK6TC1eqQ05i9au9aNP2Q/v3Vu1ILl50gI37mCu/8CtD24V7sodzYjgamXFmY2lkyYVgQ9p77FNbUsFsyh4Z7eN5RFlvRAdDKTVy4kKf0YSKWFKb2sb@kJGY@mBKnvUlyJMVF/DEfgS8gmY0QPQEbiTek4Rz21mZIAOQIcfBQeWxKsIKDQAluHU0mTlJlzNop3wpCtFlaA8cyMYhTiBRkLh0TtccswUGLoS9n1GchEDD1K501iZn47nJp@UFjF1e3QQywTGapMKWnbWZCiY781KU3KRyTuZ77MLE4Jm57rCnoU0rX0wN1UhS8qMuKnenJaeD8tV9mNdOTzYUsjAvMkXSWOkr@iN8qz/7q/MKo8blmMUq1/d6q9V68LEm/sK/1maz8f@nPPidocq/umlZ2KnfEfY879PYubLSwJwOBoahfd6mQq3KwauGvYZG3fO9f2xmWfXxIxf6Dft/@VVeC5woh87NeDf17b7d4vwu/2TfkW8Smxnqspp1Q0VRxkD18gc" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu1" class="pu"><h1><a href="https://github.com/DennisMitchell/jelly" rel="nofollow noreferrer">Jelly</a>, <s>105</s> 102 bytes</h1>

<pre><code>³;`ẹ”PḊIḢ’×⁽£ż×’
ḟ⁾#PnƝS,L{ḋ“Ðẏ½Ƥ®x‘s2¤ÄUż“¡œ-‘¤ȷ5W¤÷Ḟµ⁴÷ḢḢĊ3ṗⱮẎịµZżÄŻ⁴_Ʋ{Ṃ€żʋ/&gt;0Ḣ$ƇẈṪ,P€LÑ+SƲNƊƲ)MḢḃ3
</code></pre>

<p><a href="https://tio.run/##y0rNyan8///QZuuEh7t2PmqYG/BwR5fnwx2LHjXMPDz9UePeQ4uP7gEyGmZyPdwx/1HjPuWAvGNzg3V8qh/u6H7UMOfwhIe7@g/tPbbk0LqKRw0zio0OLTncEnp0D1Dq0MKjk3WBYoeWnNhuGg4U3/5wx7xDWx81bgGxFgHRkS7jhzunP9q47uGuvoe7uw9tjQLa1XJ0N1BJ/LFN1Q93Nj1qWnN0z6lufTsDoHKVY@0Pd3U83LlKJwAo7nN4onbwsU1@x7qObdL0BRvYbPz//38l5XgQsIkPiIeDuLi4eGJADBDXAAGYggnq64NEYHyQdExMDIq2GohVSv9NTAA" rel="nofollow noreferrer" title="Jelly – Try It Online">Try it online!</a></p>

<p>A full program that takes the track as a string as its first argument and the number of laps as its second argument. Returns a list of integers representing 1 for soft, 2 for medium and 3 for hard.</p>

<h2>Explanation</h2>

<h3>Helper link: calculate pit time from number of tyres needed</h3>

<pre><code>³                 | First argument for program (track as Jelly string)
 ;`               | Concatenate to itself
   ẹ”P            | Indices of "P"
      Ḋ           | Dequeue (remove first element)
       I          | Differences between consecutive numbers
        Ḣ         | Head (i.e. difference between indices of the 2nd and 3rd Ps in the concatenated track)
         ’        | Decrease by 1
          ×⁽£ż    | Multiply by 1750
              ×   | Multiply by:
               ’  | - Argument to this link subtracted by 1
</code></pre>

<h3>Main link: stage 1</h3>

<pre><code>ḟ⁾#P                                   | Remove all "#" and "P" from track
    nƝ                                 | Neighbours not equal (will return 1 for every change in symbol)
      S                                | Sum (i.e. number of corners)
       ,L{                             | Pair with length of original track
          ḋ                   ¤        | Dot product with following as a nilad: (Will calculate degradation per lap for each tyre type and also extra time for the corners; works because of the way Jelly vectorises)
                     ¤                 | - Following as a nilad
           “Ðẏ½Ƥ®x‘                    |   - 15, 248, 10, 151, 8, 120
                   s2                  |   - Split into twos [15,248],[10,151],[8,120]
                      Ä                | - Vectorised cumulative sum [15,263],[10,161],[8,128]
                       U               | - Vectorised reverse [263,15],[161,10],[128,8]
                        ż“¡œ-‘         | - Zipped with 0,30,45
                               ȷ5W¤÷   | Divide 100,000 by the first element of each (the degradation), leaving the additonal time per corner alone
                                    Ḟ  | Floor
                                     µ | Start a new monadic link with this as its argument
</code></pre>

<h3>Main link: stage 2</h3>

<pre><code>⁴÷          | Second argument (number of laps) divided by output of stage 1
  Ḣ         | Head (values for soft tyres)
   Ḣ        | Head (laps per tyre for aoft tyres)
    Ċ       | Ceiling (i.e. max number of tyres that might be needed)
     3ṗⱮ    | 3 to the Cartesian power of each number from 1 to the max number of tyres needed
        Ẏ   | Tighten (remove one level of lists)
         ị  | Index into output from stage 1
          µ | Start a new monadic link with this as its argument
</code></pre>

<h3>Main link: stage 3</h3>

<pre><code>                                 )     | For each of the possible tyre combinations:
Z                                      | - Transpose, so we have a list of laps per tyre set and another list of the extra time for corners per lap
           ʋ/                          | - Reduce using following as a dyad:
 ż    Ʋ{                               |   - Zip with following as a monad (applied to the list of laps per tyre set)
  Ä                                    |     - Cumulative sum
   Ż                                   |     - Prepended with zero
    ⁴_                                 |     - Subtracted from the number of laps
        Ṃ€                             |   - Minimum of each
          ż                            |   - Zip with additional time for corners
             &gt;0Ḣ$Ƈ                     | - Filter those where the first number (the number of laps used for those tyres) is greater than zero
                              Ʋ        | - Following as a monad:
                  ẈṪ                   |   - Tail of the lengths (will be 2 if all laps accounted for, 1 if not)
                    ,        Ɗ         |   - Paired with following as a monad:
                     P€                |     - Product of each (additional time for each tyre set from corners for all laps driven)
                           Ʋ           |     - Following as a monad:
                       LÑ              |       - Helper link applied to length (number of tyre sets)
                         +             |       - Plus:
                          S            |         - Sum (of additional times for each tyre set)
                            N          |     - Negated
                                  M    | Indices of maximum
                                   Ḣ   | Head
                                    ḃ3 | Bijective base 3
</code></pre>
</div>
<div id="pu2" class="pu"><h1>JavaScript (ES6), 234 bytes</h1>
<p>Takes input as <code>(track)(laps)</code>, where <code>track</code> is an array of characters. Returns a string with <span class="math-container">\$0\$</span> = soft, <span class="math-container">\$1\$</span> = medium, <span class="math-container">\$2\$</span> = hard.</p>

<pre class="lang-javascript prettyprint-override"><code>a=&gt;k=&gt;(a.map(c=&gt;(C++,d+=P,c=='P'|c=='#'?P^=350:t+=p!=(p=c)),p=a[1],P=d=C=t=0),m=g=(n,L=k,x=0,o='')=&gt;L?g(n&gt;&gt;2,L-=j=(j=1e5/(C*[15,10,8][n&amp;=3]+t*[263,161,128][n]))&gt;L?L:j|0,x-j*t*!!n*~n*3+d,o+n):(m=m&lt;x|m==x&amp;o&gt;P?m:(P=o,x),n?P:g(++N)))(N=0)
</code></pre>
<p><a href="https://tio.run/##jZLfb9owEMff@StMKxU7MflBoJuiXtCEtO2BIquV9gIBWUlgSRM7CqFjVbR/nSaQDJptWr8PPvusu/vc2RF/5lsvC9O8L6QfHNZw4OA8gYO5lvAUe@VuoqrUV4FRD6DHekVlrntjtgRrZNi5CmkXcAoeITQFPjddysCHCeRgEJrABrCgU3iiezCohF6PgDMdb7BwnAGd9iECHIEZjHQ8UebmiJoG/ejOxQ1Yrpor88GtRc1bk5qDyusSUgZP7agw6L4fKbnS7Qrll1As1adSFcTGCSR3@yIB2N9Ih40TGzOQdE@oGDN7g1V1RgjBsxLuoOvI1NAkzLxdmCM/QI8p73/OuPBk5n3nSbq10X3gh7uE1rbjSbGVcaDFcoPXeK5p2tX1qtLdiq1@a7lcrt6jxaJcilJH03h1vfI05@p6cdSb0OJU7soleDgkpNMpmxlo6NMul34mE4lm/CWUgscBupfihdvoUa7z//RxyqnXbI0uDmfwS08LrdWirjf784Qq7JFVY1vnN/gSxnGwRd8qI4Ldc9BgvwP@BM6qcseKxZspt@T8nZYVNdwHo4YbaojJsqBED9wLfvCfNvrKM//fH@Ei2R/Daku/VCuuojDNEuPwCg" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/189111/">189111</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




