<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::265114</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>042</td><td>K ngn/k</td><td>230928T223031Z</td><td><a href="https://codegolf.stackexchange.com/questions/265114/sums-of-sum-of-divisors-in-sublinear-time/265578#265578">bstrat</a></td></tr>
<tr d-ix="1"><td>nan</td><td></td><td>230914T145900Z</td><td><a href="https://codegolf.stackexchange.com/questions/265114/sums-of-sum-of-divisors-in-sublinear-time/265218#265218">Peter Co</a></td></tr>
<tr d-ix="2"><td>058</td><td>Python 2</td><td>230912T001923Z</td><td><a href="https://codegolf.stackexchange.com/questions/265114/sums-of-sum-of-divisors-in-sublinear-time/265137#265137">dingledo</a></td></tr>
<tr d-ix="3"><td>074</td><td>Python</td><td>230911T154334Z</td><td><a href="https://codegolf.stackexchange.com/questions/265114/sums-of-sum-of-divisors-in-sublinear-time/265125#265125">loopy wa</a></td></tr>
<tr d-ix="4"><td>082</td><td>C#</td><td>230912T180810Z</td><td><a href="https://codegolf.stackexchange.com/questions/265114/sums-of-sum-of-divisors-in-sublinear-time/265172#265172">Acer</a></td></tr>
<tr d-ix="5"><td>052</td><td>Ruby</td><td>230911T133757Z</td><td><a href="https://codegolf.stackexchange.com/questions/265114/sums-of-sum-of-divisors-in-sublinear-time/265116#265116">ovs</a></td></tr>
<tr d-ix="6"><td>038</td><td>Charcoal</td><td>230911T194707Z</td><td><a href="https://codegolf.stackexchange.com/questions/265114/sums-of-sum-of-divisors-in-sublinear-time/265132#265132">Neil</a></td></tr>
<tr d-ix="7"><td>054</td><td>JavaScript ES6</td><td>230911T222516Z</td><td><a href="https://codegolf.stackexchange.com/questions/265114/sums-of-sum-of-divisors-in-sublinear-time/265134#265134">Arnauld</a></td></tr>
<tr d-ix="8"><td>049</td><td>R</td><td>230911T160849Z</td><td><a href="https://codegolf.stackexchange.com/questions/265114/sums-of-sum-of-divisors-in-sublinear-time/265126#265126">Dominic </a></td></tr>
<tr d-ix="9"><td>1734</td><td>Nibbles</td><td>230911T223016Z</td><td><a href="https://codegolf.stackexchange.com/questions/265114/sums-of-sum-of-divisors-in-sublinear-time/265135#265135">Dominic </a></td></tr>
<tr d-ix="10"><td>075</td><td>Scala 3</td><td>230912T022518Z</td><td><a href="https://codegolf.stackexchange.com/questions/265114/sums-of-sum-of-divisors-in-sublinear-time/265139#265139">138 Aspe</a></td></tr>
<tr d-ix="11"><td>052</td><td>R</td><td>230912T003507Z</td><td><a href="https://codegolf.stackexchange.com/questions/265114/sums-of-sum-of-divisors-in-sublinear-time/265138#265138">Giuseppe</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://codeberg.org/ngn/k" rel="nofollow noreferrer">K (ngn/k)</a>, <s>44</s> 42 bytes</h1>
<pre><code>{+/-[q*k;x@s]+x@q:_y%k:1+!s:_%y}{-2!x*1+x}
</code></pre>
<p>-2 thanks to @coltim</p>
<p>Same formula as <a href="https://codegolf.stackexchange.com/a/265116">@ovs' answer</a>.</p>
<p><a href="https://ngn.codeberg.page/k#eJxLs6rW1teNLtTKtq5wKI7VrnAotIqvVM22MtRWLLaKV62srdY1UqzQMtSuqOXiSlM3NFAwNABiI2MFMyNTEBssYIBEAwEXAB0MFQw=" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu1" class="pu"><h1><s>x86-32 machine code, 27 bytes</s></h1>
<p>Withdrawn, not competing: this is only a <code>σ(n)</code> implementation, sum of factors of one number, which is very easy to do in sqrt(n) time.  Apparently I forgot about the 1..n part of the challenge after getting started on what was going to be the inner loop, and that would have given O(n * sqrt(n)) complexity anyway.</p>
<p>It's also broken for <code>n=2</code>, where it returns 6 instead of 3 (counting 2 and 2/2=1 again).  Also for <code>n=6</code>.  For odd numbers, there isn't a divisor on the first iteration where <code>n/i &lt; i</code> is false.  But for some even numbers there is, like <code>i=2</code> for <code>n=2</code> or <code>i=3</code> for <code>n=6</code>, so it's a problem that we increment, then check for a divisor, then check the loop-exit condition.  We probably have to just start with <code>i=1</code> which costs an extra byte, so we can increment after dividing.</p>
<hr />
<p>Factors come in pairs, <code>n / i</code> and <code>i</code>.  We loop only for the low <code>i &lt; sqrt(n)</code> part of the range, but avoid actually computing a square root: the loop ends when <code>n/i &lt;= i</code>, which is the same as <code>n &lt;= i*i</code> = <code>sqrt(n) &lt;= i</code>.  For perfect squares, we need to avoid double-counting when <code>n/i == i</code>.</p>
<p>Runs about <code>floor(sqrt(n))</code> iterations, approximately fixed time per iteration on normal CPUs (<code>idiv r32</code> throughput is constant on most recent CPUs; <a href="https://uops.info/" rel="nofollow noreferrer">https://uops.info/</a>. Branch mispredictions will be variable cost and probably balance out, probably being less frequent for huge numbers with fewer factors). So it should be <code>Ө(sqrt(n))</code> complexity class, unless you want to be more precise about factoring in the number of factors and whether there's much of a pattern that IT-TAGE predictors can learn.</p>
<p>NASM listing (with address and line number trimmed): machine code | source</p>
<pre><code>               ; int32_t input in EDI, return in ESI
               addfactors:
 31C9              xor    ecx, ecx        ; divisor (i) = 0
 31F6              xor    esi, esi        ; retval
               .divloop:                  ; do {
 41                inc    ecx             ; ++divisor
 89F8              mov    eax, edi
 99                cdq                    ; shorter than xor  edx, edx
 F7F9              idiv    ecx            ; EAX = n/i;   EDX = n%i
               
 85D2              test   edx, edx       ; check the remainder
 7508              jnz   .notdivisible
 01CE               add    esi, ecx       ; divisor and quotient might or might not be unique factors
 39C8               cmp   eax, ecx           ; it seems redundant to do this compare twice, but it's already inside the if(edx==0) branch so we can't rely on its FLAGS for the loop branch
 7402               je  .square
 01CE                add   esi, eax        ; quotient                    .square:
                .notdivisible:
               
 39C8              cmp    eax, ecx
 77EA              ja    .divloop         ; while( n/i &gt; i );
                   ;; loop while(n &gt; i*i), i.e. while(i &lt; sqrt(n)), because divisors come in pairs

 C3                ret
</code></pre>
<p>x86-64 would need a 2-byte <code>inc</code>.  Other than that, the same machine code works in both modes.  The loop-condition ended up being simpler than where I first had the idea to compare quotient and divisor instead of using <code>sqrt</code>, in <a href="https://codereview.stackexchange.com/questions/204902/checking-if-a-number-is-prime-in-nasm-win64-assembly/204965#204965">code review: Checking if a number is prime in NASM x86-64</a>, where checking against an already-incremented-by-2 <code>ecx</code> still works.</p>
<p><a href="https://tio.run/##bVTBbtswDL37K3jo0GR13WyHoUiWAQXaDQV262W3gpaYmq0tJZbcON3HZ5TkuM1aHyRL4iMfHymhc9SU9e7coGv2e9R6hcrb1s0hfQtgs@68jHBzfZtDS75rTVze3WbBordtmEj1eRhgBGp@ZieHE57CEmZHxo7zMLwai99nrLNCQLW160P4N584tPA3emGjhpD/WZydDUGjWWOfoxkGZprjntIbgI@cu8q2nlrwFZpEk3TE9SmkOP4w5M3VH8nOXPBCljfXcfGJswjy5Dy8OhoxqiL1JJFI0m6QjaZE@NG8yFgY62MaXNYU90HqMqqm@ncKo9HQ4K4k2HTWMxkPRVEkqGrWowZH5KWyHhxR44SF7oxGgXkbVPYVO1C2WWNL4LesKIcyNIE/dYB1S6h3UgTHmmIWvJpIesvlbApli0ZV4CxsCRSaUy/e6x1Y6Rnv4Ofvq193sLJtxIVKD4hE9pEkfbfpJG7aOMoc@wNzyQ4Ct9L6CjrDm45gaNyEG5zMs2M156kuSZNRlKQ9RtzQf29U2lZc0yRUGH4Aw3QRzReLxD6dmnD0mac5cEHFsMnwHdym9RMzlYOSFHaODjWL@lK4R2tkYZ0tUgNEAZ54fa9tJ4SV7YyPNIL@1oiSvEraoQsFoRY9i7hblMocnOehEaUcearDqQZDpKVNgHrfYuzLi0elwIrTikRIQW@prsM8WrmuTKzCH3zUf0GT5VJEkX9pIBuqxeZBeBLYSLMpgot3Gc2jhnLn945faA66hJPzk5Msw5ofDHz5lj3UtsQa7p3H1mdpCqhwp@Uu5/D1UlYKA@fx0Tqcl/3R6yLsLs9L6XbqQ8t79J2Tazo8OQMm9MKXLLwtHmb95Wz/Dw" rel="nofollow noreferrer" title="Assembly (nasm, x64, Linux) – Try It Online">Try it online!</a> with a test <code>_start</code> that passes 28 and checks the return value.</p>
<p>Tested with <code>28</code> (result 56) and a couple perfect squares, <code>64</code> (result 127 - sum of every power of 2 up to and including 64), and <code>25</code> (result 31 = 25 + 5 + 1).</p>
<hr />
<p>It seems like a lot of CMP/JCC.  I'd hoped to reuse FLAGS from the loop branch to handle the perfect-square case outside the loop, with <code>jne  .skip_doublecount</code> over a <code>sub  esi, ecx</code>.  But that needs to happen only if the last iteration had EDX==0.  Otherwise, for example with <code>n=28</code>, <code>n/5</code> truncates to <code>5</code>, so the condition was true after loop exit, but we hadn't added <code>5</code> in the first place because it's not a divisor.  And <code>test edx,edx</code> / <code>jz</code> in that block would cost another 4 bytes.  Putting the extra <code>cmp/jcc</code> (beyond what's needed for detecting divisors and the loop branch) inside the if(divisor) block means we avoid replicating any <code>add</code> or <code>sub</code> instruction.  It would be more efficient to sink the extra branching outside the loop, but not smaller.</p>
<p>(And <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/advanced-performance-extensions-apx.html" rel="nofollow noreferrer">APX</a> <code>ctestz edx,edx, something</code> would be even larger with a 4-byte EVEX prefix.  APX adds new predicated <code>cmp</code> and <code>test</code> instructions that let you chain conditions a bit like an AVX-512 masked compare-int-mask.  They set FLAGS to either the compare/text result or the specified new value according to the predicate, both of which are embedded in the EVEX prefix.)</p>
<p>AArch64 with <code>cbz</code> to branch on a register being zero without first setting condition codes would be useful.  Or ARM Thumb <code>cbz</code> could work, too; we only need to branch forward. AArch64's powerful <code>csinc</code> cmove instruction might not help much, we need to add not just increment.  Combined with ARM Thumb predication via <code>it</code>, we could probably <code>cmp</code> the quotient and divisor before the <code>if(remainder)</code> block, and keep those flags unchanged.</p>
</div>
<div id="pu2" class="pu"><h1><a href="https://docs.python.org/2/" rel="nofollow noreferrer">Python 2</a>, 58 bytes</h1>
<p>Runs in <span class="math-container">\$ \mathcal{O}(\sqrt{n}) \$</span> time.</p>

<pre class="lang-python prettyprint-override"><code>f=lambda n,i=1:~i*i*(n/-~i-n/i)/2+(i&lt;n and f(n,n/(n/-~i)))
</code></pre>
<p><a href="https://tio.run/##TY3NboMwEITvfoq9xaYQvDZ/@aGvUtGGKCvBYoFRlEtenZjSVr2sZvabnXUPfxvYLNS7YfQwPabTOvZT68f2ax4nGrijnrxEHUW5Wq511/SflwY4phqPT4ookpwmT0o4JZWaN0lnhoYvcJUcc7pBpdRyv1HXAh4FELsYhtk7qKFvnCT2MYzN/SOA2Uu1n1wXXu4geYedUgLcGCKhMHC1XS6oV1qVAvWmzOEg0NhVo8kKLQqTr8YazIMLsZ@c1RV@279NiFeIVWbL3/1/VGqbYWgudGGqFw" rel="nofollow noreferrer" title="Python 2 – Try It Online">Try it online!</a></p>
<h2>Explanation</h2>
<p>Note: <a href="https://codegolf.stackexchange.com/a/265132/88546">@Neil's answer</a> seems to use a similar approach to mine.</p>
<p>We first take the <span class="math-container">\$ O(n) \$</span>-time formula <span class="math-container">\$ \sum_{i=1}^n{i \cdot \lfloor\frac{n}{i}\rfloor} \$</span>, noticing that there can only be <span class="math-container">\$ O(\sqrt{n}) \$</span> unique values of <span class="math-container">\$ \lfloor\frac{n}{i}\rfloor \$</span>. For example, if <span class="math-container">\$ n = 50 \$</span>, the possible values of <span class="math-container">\$ i \$</span> for each <span class="math-container">\$ \lfloor\frac{n}{i}\rfloor \$</span> are:</p>
<pre class="lang-python prettyprint-override"><code> n//i |   i
------+-------
   1  | 26-50
   2  | 17-25
   3  | 13-16
   4  | 11-12
   5  | 9-10
   6  | 8-8
   7  | 7-7
   8  | 6-6
  10  | 5-5
  12  | 4-4
  16  | 3-3
  25  | 2-2
  50  | 1-1
</code></pre>
<p>Let <span class="math-container">\$ a \$</span> be a sorted list of all unique values of <span class="math-container">\$ \lfloor\frac{n}{i}\rfloor \$</span>. For this example, <span class="math-container">\$ a = [ 1, 2, 3, 4, 5, 6, 7, 8, 10, 12, 16, 25, 50 ] \$</span>. We can then construct a new summation that solves the problem in <span class="math-container">\$ O(\sqrt{n}) \$</span>:</p>
<p><span class="math-container">$$ \sum_{i=1}^{|a|}{\left\lfloor \frac{n}{a_{i}} \right\rfloor \times (T(a_{i}) - T(a_{i-1}))} $$</span></p>
<p>where <span class="math-container">\$ T(n) \$</span> is the sum of the first <span class="math-container">\$ n \$</span> positive integers, and assuming that <span class="math-container">\$ a_0 = 0 \$</span>. Next, a bit of insight allows us to rearrange the summation like so:</p>
<p><span class="math-container">$$ \sum_{i=1}^{|a|}{T(a_i) \times \left(\left\lfloor\frac{n}{a_i}\right\rfloor - \left\lfloor\frac{n}{a_i+1}\right\rfloor\right)} $$</span></p>
<p>To compute <span class="math-container">\$ a \$</span>, we can apply the following recurrence:</p>
<p><span class="math-container">$$ a_i = \left\lfloor\frac{n}{\lfloor n / (1+a_{i-1}) \rfloor}\right\rfloor $$</span></p>
<p>The proof is left as an exercise to the reader. Finally, we can compute <span class="math-container">\$ T(n) \$</span> using the formula <span class="math-container">\$ \frac{n(n+1)}{2} \$</span>.</p>
</div>
<div id="pu3" class="pu"><h1><a href="https://www.python.org" rel="nofollow noreferrer">Python</a>, 74 bytes</h1>
<pre class="lang-python prettyprint-override"><code>lambda n,i=0,k=1:(k&gt;=i)*i*k+(i&lt;k and f(n,j:=i+1,l:=n//j)+i*(l*~l-k*~k)//2)
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=RU5LboMwEN37FLO0wQTbEH6qc4AqR6ha0QbUCWAQn0U2WfYS3USq2jvlNrVLo4w00rw3b-a9z5_hNL_35vJV66fvZa6D7PrYlt3roQTDUQveaFnQZqeReeg1PsWHBkpzgJoafiw0-pK3hTZheGQ-erT1zm3QeOeGhaFi_x8X7IZ-nGE6TcT2ZqrmsXpbxgl702KHM5XCFSN1P8Ie0EA_VIYKVhBA7r3wHjTsN9PQWi1znCO6cqBoZk4tZJYdRosorSkyR6zml-uHFBDsIEuJdfmbVJ4TqSI3SxUngiRq60Ck5NYiF2bVRSKTZM0mwIZ8Tti6sFeZlFkcpbf1TZHfFamIYml9EpGojKxxfgE" rel="nofollow noreferrer">Attempt This Online!</a></p>
<h3>Old <a href="https://www.python.org" rel="nofollow noreferrer">Python</a>, 88 bytes</h3>
<pre class="lang-python prettyprint-override"><code>lambda n,k=0:sum(i*k*(k&gt;i)+i*(k-~(j:=n//-~i))*(k-(k:=j))//2for i in range(int(n**.5)+1))
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=RY5NboMwEEb3nMLLGQLBY_4MEjkBB-iiakXV0DoEgwhZdJNlL9FNpKq9U25TT0mUled78_zZX7_jx_w-2PN3Wz3-HOc21JeHfdO_vDbCBl0ly8OxB-N3PnQbgyvjzvAEu7KyURSeDCID6MpqhxhFqh0mYYSxYmrs2xaMncH6_jrFFSFe-2uWapaGcWtBYukJE_jPwSAqUa8P497MgMwY9M3INQG4iI6OE5dCCwYZLJ3nyydJEW6Ezj2Sy6SKwiMV80wqyaSXqZRDrCh1yWlXL5aa_iMTIPmU4bJwtzSRTuL8tr4Zxd3IZZyQeyeTmdLe8p0_" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>Probably similar to @ovs's although found independently.</p>
<p>The basic idea is to regroup the given double sum by divisors and then count how many numbers in the range are a multiple of the divisor.</p>
<p>To achieve O(n^0.5) divisors with the same multiplicity are lumped together.</p>
</div>
<div id="pu4" class="pu"><h1><a href="http://www.mono-project.com/docs/about-mono/releases/5.0.0/#csc" rel="nofollow noreferrer">C#</a>, 82 bytes</h1>

<p>With 2 dummy parameters (<code>y</code> and <code>z</code>).</p>
<pre class="lang-cs prettyprint-override"><code>(x,y,z)=&gt;Enumerable.Range(1,y=(int)Math.Sqrt(x)).Sum(i=&gt;2*i*(z=x/i)+z*-~z-y*-~y)/2
</code></pre>
<p><a href="https://tio.run/##hY2xDoIwFEV3vqLje1hAanTBshiddJHBGbFoEykRaEI7@Ou1TkxKcnOXe3JP1UdVL91Bq2or1UDJVLdWX58iJzXhDkZqqEWe75VuRFf6IT6X6i4gpYaD5/FUDo@4eHUDjIhxoRuQPGehDMHyMZG4sGH0tpHxbTBhLguCXav61j9dOjmIo1QCakiXlHyDmP3Y5wC2@g9s2HpWMTncBw" rel="nofollow noreferrer" title="C# (Visual C# Interactive Compiler) – Try It Online">Try it online!</a></p>
<h1><a href="http://www.mono-project.com/docs/about-mono/releases/5.0.0/#csc" rel="nofollow noreferrer">C#</a>, 89 bytes</h1>

<p>Single parameter.</p>
<pre class="lang-cs prettyprint-override"><code>x=&gt;{int i=0,s=0,y=(int)Math.Sqrt(x),z;for(;i++&lt;y;)s+=i*(z=x/i)+(z*-~z-y*-~y)/2;return s;}
</code></pre>
<p><a href="https://tio.run/##fYy9DsIgFIV3n4IRSv@s0eWWLiZOOjk4a6XxJg1EoEnB6KsjPkAdzknO@ZKvt0VvMR4m1beoXE7uerqNsiMDEXEW3SudBEWd2xQvaJrsdHWP8vw0js4sDzBoQwE5bz0wywVmNIi5QsZpyIpPKHxqz6oGjHSTUcTCO8JqtdfK6lGWF4NOHlFJOtB1zRgskGXUbJbQrtn@Ef6M8Qs" rel="nofollow noreferrer" title="C# (Visual C# Interactive Compiler) – Try It Online">Try it online!</a></p>
<p>Both use the same formula:</p>
<p><span class="math-container">$$
\begin{eqnarray*}
D(x) &amp;=&amp; \Big(\sum_{i=1}^{\lfloor\sqrt x\rfloor}i \cdot \Big\lfloor\frac x i\Big\rfloor + T(\Big\lfloor\frac x i\Big\rfloor) \ \Big) - \lfloor \sqrt x\rfloor \cdot T\big(\lfloor \sqrt x\rfloor \big)\\
&amp;=&amp; \Big(\sum_{i=1}^{y}i \cdot z + T(z) \ \Big) - y \cdot T(y)\\
&amp;=&amp; \sum_{i=1}^{y}i \cdot z + T(z) - T(y)\ \\
&amp;=&amp; \sum_{i=1}^{y}i \cdot z + \frac{z \cdot (z-1) - y \cdot (y-1) }{2} \\
\end{eqnarray*}
$$</span>
where
<span class="math-container">$$
T(x) = \frac{x(x+1)}{2} \\
y = \lfloor\sqrt x\rfloor \\
z = \Big\lfloor\frac x i\Big\rfloor
$$</span></p>
</div>
<div id="pu5" class="pu"><h1><a href="https://www.ruby-lang.org/" rel="nofollow noreferrer">Ruby</a>, <s>55</s> 52 bytes</h1>
<p>Formula is adapted from <a href="https://math.stackexchange.com/q/3287652">this math.SE question</a>. Runs in <span class="math-container">\$\mathcal{O}(\sqrt{n})\$</span>.</p>
<p>-3 bytes thanks to @dingledooper.</p>
<pre class="lang-ruby prettyprint-override"><code>-&gt;x{(1..$.=x**0.5).sum{(v=x/_1)*_1-(v*~v-$.*~$.)/2}}
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m72kqDSpcsHiNNuYpaUlaboWN0107SqqNQz19FT0bCu0tAz0TDX1iktzqzXKbCv04w01teINdTXKtOrKdFX0tOpU9DT1jWproXqdCxTSog0NYrkgNIxhZAxhmBmZwqS0tIwRTDME0zIWYtSCBRAaAA" rel="nofollow noreferrer">Attempt This Online!</a></p>
</div>
<div id="pu6" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, <s>41</s> 38 bytes</h1>
<pre><code> Ｎθ≔θη≔⁰ζＷη«≔÷θιε≔÷θ⊕εη≧⁺×⁻ιη÷×ε⊕ε²ζ»Ｉζ
</code></pre>
<p><a href="https://tio.run/##bY7NCoMwEITP9Sly3IAF26un0l48WKT0BVJdzEJMNT8WLH321KClF/ewMHwzs1tLYeqnUCEUuvfu6rsHGhh4npyspVbDkDL5V1nKplm9JClkIDl7J7sVFdpdaKQGY4R4ynA2bsJC1wY71A4bQM6XA7tS9Iv5Rq10UClvU3anDi2UpL0FisaY/lUtEDcKj3HFRz9JZUg7OAvrYOI8D@GQrRP2o/oC" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Explanation: Uses the formula <span class="math-container">\$ A024916(n) = \sum_{i=1}^n i \lfloor n/i \rfloor \$</span> with the linked observation that it can be calculated more efficiently by grouping terms with the same value of <span class="math-container">\$ \lfloor n/i \rfloor \$</span>, and then applying @dingledooper's rearrangement that <span class="math-container">\$ \sum_{j=1} \lfloor n/a_j \rfloor (T(a_j) - T(a_{j-1})) = \sum_{j=1} T(a_j) ( \lfloor n/a_j \rfloor - \lfloor n/a_{j+1} \rfloor ) \$</span> where <span class="math-container">\$ T(n) \$</span> are the triangular numbers to save 3 bytes.</p>
<pre><code> Ｎθ
</code></pre>
<p>Input <span class="math-container">\$ n \$</span>.</p>
<pre><code>≔θη
</code></pre>
<p>Start counting <span class="math-container">\$ \lfloor n / a_j \rfloor \$</span> down from <span class="math-container">\$ n \$</span>.</p>
<pre><code>≔⁰ζ
</code></pre>
<p>Start with no total.</p>
<pre><code>Ｗη«
</code></pre>
<p>Repeat until <span class="math-container">\$ \lfloor n / a_j \rfloor \$</span> is zero. This also conveniently makes a copy of the value, so I can update the original variable in the loop while still being able to access its former value.</p>
<pre><code>≔÷θιε
</code></pre>
<p>Calculate <span class="math-container">\$ a_j \$</span>.</p>
<pre><code>≔÷θ⊕εη
</code></pre>
<p>Calculate <span class="math-container">\$ \lfloor n / a_{j+1} \rfloor = \lfloor n / ( 1 + a_j ) \rfloor \$</span>.</p>
<pre><code>≧⁺×⁻ιη÷×ε⊕ε²ζ
</code></pre>
<p>Calculate <span class="math-container">\$ T(a_j) ( \lfloor n/a_j \rfloor - \lfloor n/a_{j+1} \rfloor ) \$</span>, and accumulate it to the total.</p>
<pre><code>»Ｉζ
</code></pre>
<p>Output the final total.</p>
<p>On TIO, <span class="math-container">\$ 10^{11} \$</span> takes about <span class="math-container">\$ 10 \$</span> times as long as <span class="math-container">\$ 10^9 \$</span>, so the time complexity appears to be <span class="math-container">\$ O(\sqrt n) \$</span>.</p>
</div>
<div id="pu7" class="pu"><h1>JavaScript (ES6), 54 bytes</h1>
<p>Based on the formula <a href="https://codegolf.stackexchange.com/a/265116/58563">found by ovs</a>.</p>

<pre class="lang-javascript prettyprint-override"><code>x=&gt;(g=k=&gt;++k*k&gt;x?--k*k*~k/2:k*(q=x/k|0)-q*~q/2+g(k))``
</code></pre>
<p><a href="https://tio.run/##bY1NDoIwGAX3noJlW1LbfuWnmBSvAkEgWkKtGMPCcPUKIRqjvM1bzCRzKR/lUN3O1zvt7an2jfajzlGrjc7D0BCTj0dK5yeTYXAwBDk9MvPkmDoyOQZhiwzGReEr2w@2q/edbVGDgmWCYxwwFqh0908Ff1PIsi0OcuUCooRvCAnEqyBBxFvGXPgkJFfix1jwlzFXlBAqkql/AQ" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<hr />
<h1>JavaScript (ES11), 45 bytes</h1>
<p><em>-3 bytes thanks to <a href="https://codegolf.stackexchange.com/users/44718/tsh">@tsh</a></em></p>
<p>A port of <a href="https://codegolf.stackexchange.com/a/265137/58563">dingledooper's answer</a>.</p>
<p>Expects a BigInt.</p>

<pre class="lang-javascript prettyprint-override"><code>f=(n,q=n)=&gt;q&amp;&amp;(i=n/q)*(q-n/++i)*i/2n+f(n,n/i)
</code></pre>
<p><a href="https://tio.run/##bY7LDsIgEEX3fgWrBlorDPRBF/gvTW0NphmKNf4@oqmPGGZ7Tu6ZS3/v1@Fql1uJ7jSGMBmKe2@QmaPPMmoNcs9y6kvkRWFZbrnEYooOcsvC4HB183iY3ZlOlLwOkDHCOYFdgoLYqG4TGMQHy65LCVK912XViITRyHozlIQ6pcTIt6KE/v/zyX@VGNIAulJteAA" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
</div>
<div id="pu8" class="pu"><h1><a href="https://www.r-project.org" rel="nofollow noreferrer">R</a>, <s>61</s> <s>51</s> 49 bytes</h1>
<p><em>Edit: saved <s>10</s> 12 bytes by re-arrangement, goaded (and inspired) by Giuseppe golfing-down my original version in <a href="https://codegolf.stackexchange.com/a/265138/95126">his answer</a></em></p>
<pre class="lang-r prettyprint-override"><code>\(x,y=1:x^.5,z=x%/%y)min((2*y+z+1)%*%z-y^3-y^2)/2
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m72waMEiF9ulpSVpuhY3DWM0KnQqbQ2tKuL0THWqbCtU9VUrNXMz8zQ0jLQqtau0DTVVtVSrdCvjjIHYSFPfCKpRoTixoCCnUiNZw9BAx9AAjCEEEGjquGhC1C1YAKEB" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>Golfed calculation based on the same <a href="https://math.stackexchange.com/q/3287652">Math.SE question</a> used in <a href="https://codegolf.stackexchange.com/a/265116">ovs' Ruby answer</a>.</p>
<p><strong>Ungolfed</strong></p>
<pre><code>triangle=function(x)x*(x+1)/2
D=
function(x){
    y=sqrt(x)%/%1
    k=1:y
    sum(k*x%/%k+triangle(x%/%k))-triangle(y)*y
}
</code></pre>
</div>
<div id="pu9" class="pu"><h1><a href="http://golfscript.com/nibbles/index.html" rel="nofollow noreferrer">Nibbles</a>, 17 bytes (34 nibbles)</h1>
<pre><code>+:.;.,;^$-2/_$-;~$/*+$~$~$;$!$,_*
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m708LzMpKSe1eMGCpaUlaboWNxW1rfSs9XSs41R0jfTjVXSt61T0tbRV6oDQWkVRRSdeC6IQqn7BTQVDAy5DAzCGEFASRhlAFAIA" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>Direct port of my R answer.</p>
<p>This feels very clunky, with half the tokens used for control-flow (<code>,;,;;~</code>) or explicit variable names (<code>$_$$$$$;$$_</code>); I suspect that one of the stack-based languages will be able to better this...</p>
<p><strong>Bit-by-bit</strong> (in conjunction with the Nibbles <a href="http://golfscript.com/nibbles/quickref.html" rel="nofollow noreferrer">quick reference</a> and <a href="http://golfscript.com/nibbles/tutorial_basics.html" rel="nofollow noreferrer">tutorial</a>):<br />
y (=floor(sqrt(x)): <code>^$-2</code><br />
z (=floor(x/(1..y))), saving y: <code>.,;^$-2/_$</code> (y saved as <code>$</code>)<br />
triangle(z), saving z, y &amp; triangle function:  <code>.;.,;^$-2/_$;~$/*+$~$~</code><br />
triangle(z)-triangle(y): <code>.;.,;^$-2/_$-;~$/*+$~$~$;$</code><br />
(leaves z saved as <code>$</code>, y saved as <code>@</code>, x is <code>_</code>)</p>
<p>So now we can easily use the saved variables to calculate D:
D = (1..y)*z + triangle(z)-triangle(y): <code>+: .;.,;^$-2/_$-;~$/*+$~$~$;$ !$,_*</code></p>
</div>
<div id="pu10" class="pu"><h1><a href="https://www.scala-lang.org/" rel="nofollow noreferrer">Scala 3</a>, 75 bytes</h1>
<p>Port of <a href="https://codegolf.stackexchange.com/a/265116/110802">@ovs's Ruby answer</a> in Scala.</p>
<hr />
<pre class="lang-scala prettyprint-override"><code>x=&gt;{val d=sqrt(x);(BigInt(1) to d).map(k=&gt;x-x%k-(x/k* ~(x/k)-d* ~d)/2).sum}
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=jZCxTsMwEIbVNU9xSyW7NG3TCoSCYgk2hJgQE2Jwm6SYpG5JXDCqwouwdIF3ok_DOU5SgWjE4vPd_9_n871_5jOe8sl21-kup4_RTME1FxI2DkAYxbDAhPBsnvtwnmX89e5GZULO76kPt1IoCEonwAqrKpUkJhdifikV8UaU0kNSizaeHNROxsdtzNYHR__QG0vh4PHMU4h96wiYjfjdj7WK3dOvKx2wjbGEQf6UKaLpWUOjoJYQ0sGCr0gSMO3qbuISPUx68GYCdUO8hXQ4poN8vSgsctdxnWrpluiDBdL60izbeGSkFZG11Afxl51IOAIBQ5AUGAPPKdvN2EsZod5MXAsZSCyjuM89LNjH-qAr48uDSCMgBEUX2QM-zYGZNlpNCCVHenXyC2JqxQ8UOnrGxlDeMxC_n6ZqKKGFU21tu7XxGw" rel="nofollow noreferrer">Attempt This Online!</a></p>
</div>
<div id="pu11" class="pu"><h1><a href="https://www.r-project.org" rel="nofollow noreferrer">R</a>, 52 bytes</h1>
<pre class="lang-r prettyprint-override"><code>\(x,y=1:x^.5,z=x%/%y)y%*%z+(z+1)%*%z/2-max(y)*sum(y)
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m72waMEiF9ulpSVpuhY3TWI0KnQqbQ2tKuL0THWqbCtU9VUrNStVtVSrtDWqtA01QSx9I93cxAqNSk2t4tJcIAXRu684saAgp1IjWcPQQMfQAIwhhIGmjgtU0YIFEBoA" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>Golfed down version of <a href="https://codegolf.stackexchange.com/a/265126/67312">Dominic's answer</a> which in turn uses the same observation as ovs. Nothing crazy here; should run in <span class="math-container">\$\mathcal{O}\left(\sqrt n\right)\$</span> time, but saves bytes by using <code>1:sqrt(x)</code> to truncate, and <code>%*%</code> to calculate the sumproduct.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/265114/">265114</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




