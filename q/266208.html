<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::266208</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>276</td><td>JavaScript ES7</td><td>231025T121905Z</td><td><a href="https://codegolf.stackexchange.com/questions/266208/help-i-cant-bloody-well-memorize-this-number/266215#266215">Arnauld</a></td></tr>
<tr d-ix="1"><td>315</td><td>JavaScript Node.js</td><td>231025T114432Z</td><td><a href="https://codegolf.stackexchange.com/questions/266208/help-i-cant-bloody-well-memorize-this-number/266214#266214">l4m2</a></td></tr>
<tr d-ix="2"><td>380</td><td>Ruby nl</td><td>231026T003431Z</td><td><a href="https://codegolf.stackexchange.com/questions/266208/help-i-cant-bloody-well-memorize-this-number/266231#266231">Value In</a></td></tr>
<tr d-ix="3"><td>111</td><td>Jelly</td><td>231025T231420Z</td><td><a href="https://codegolf.stackexchange.com/questions/266208/help-i-cant-bloody-well-memorize-this-number/266229#266229">Nick Ken</a></td></tr>
<tr d-ix="4"><td>560</td><td>Haskell</td><td>231025T184339Z</td><td><a href="https://codegolf.stackexchange.com/questions/266208/help-i-cant-bloody-well-memorize-this-number/266225#266225">Silvio M</a></td></tr>
<tr d-ix="5"><td>156</td><td>Charcoal</td><td>231025T161910Z</td><td><a href="https://codegolf.stackexchange.com/questions/266208/help-i-cant-bloody-well-memorize-this-number/266220#266220">Neil</a></td></tr>
<tr d-ix="6"><td>114</td><td>05AB1E</td><td>231025T145922Z</td><td><a href="https://codegolf.stackexchange.com/questions/266208/help-i-cant-bloody-well-memorize-this-number/266217#266217">Kevin Cr</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>JavaScript (ES7), 276 bytes</h1>
<p>Expects a string and returns the partition as an array of integers.</p>

<pre class="lang-javascript prettyprint-override"><code>f=([v,...a],p=[],s=q=0,c=&quot;&quot;,[w,x,y,z]=c)=&gt;(v&amp;&amp;!z&amp;&amp;f(a,p,s,c+v),c?f(a,[...p,c++],s+=x?+w?/1(bn|c0|cx|el|ev|f2|gu|h3|ht|i9|it|k7)|2(hc|pg|ra|uy)|49[01u]|5(he|hh|y[fwz])/.test(c.toString(36))?w&gt;2?3:1&lt;&lt;16/x:[w-+-x]==(y+=[z])?3-!z:[w*x]==y?z?5:3:1/0:1/0:2,v):v||q&amp;&amp;s&gt;q?o:(q=s,o=p))
</code></pre>
<p><a href="https://tio.run/##dVLbsqIwEHzfr@DwQMESNRcgxDqRj9hHigeXRXHXEhXES@Xf3QnKOWrQIgHT0@mZ6fk7b@d1vl9tm9Gm@lNcrwvppi0aj8fzDG1lmqFa7iRGubRtlB7RCZ3RJZO5J2du6zgfF8dZuHO0RTXK/dZDeaL/psDfwoEPdF@eEv@YTIj7e6NyrPKTKtaqaNWCquVBlUyVjVoJtWrUP@4p6pa52i7Vfq4OZ08FIsXkkKnQLQtVluqcLo6XzJuMm6Ju3HzcVL@a/WqzdFnkeclxRhM2JZ@fJJqcpulx5I9OmZTu2ZcpsBI2@rjA8U99eE4uSTiF6AnuFkWtN22V2jlOPdsl1dTdyRpVcut517za1NW6GK@rpbtw7ZDg0Laefp5nTSZWGiKLIAsjK8x@vJCI4HSYpJHBcGG/C0eWGGRg@qTRMyAcWRxZGjd4gpKYcUpsg6cRZGnMFKPspZgvMcqM6CCICR0sJkCWxkxGbCj0DEAgKTOjWFcXRATbZvnxrXYQA9wUYyDGcRhijrn9JMY6McDA0s5YiDD4YdBJM0q@xqKfB0BAmkKZGjWT5iQgApMH4/qkAYFhAuyNbTogxERHwN5d8ES9pUv6O@7f72ZAxEQIEt@aaD/OACAwPkJPwncjB@YBfIkYjQJCY/ul@4B15Eh3AbbglgjcNjRXYb/sVxfh7Mb8fhsXwFmIY84JLBY/VqKNhLYACi5y0u3MzICDUYwJeDpzeIT7vmoE7mDivt0tgojs@h8" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<p>This gives alternate solutions for a few test cases.</p>
<h2>Scoring method</h2>
<p>We make sure that each part <span class="math-container">\$c\$</span> is made of at most 4 characters and split them into <span class="math-container">\$[w,x,y,z]\$</span>.</p>
<ul>
<li><p>If <span class="math-container">\$x\$</span> is not defined: this is a single digit ➝ the score is <span class="math-container">\$2\$</span>.</p>
</li>
<li><p>If <span class="math-container">\$w=0\$</span>, this is an illegal pattern ➝ the score is <span class="math-container">\$\infty\$</span>.</p>
</li>
<li><p>We test all special patterns at once with the following regular expression applied to the base-36 representation of <span class="math-container">\$c+1\$</span>:</p>
<pre class="lang-javascript prettyprint-override"><code>/1(bn|c0|cx|el|ev|f2|gu|h3|ht|i9|it|k7) // 1715 to 2023
|2(hc|pg|ra|uy)                         // 3508 to 3706
|49[01u]                                // 5508 to 5538
|5(he|hh|y[fwz])/                       // 7106 to 7739
</code></pre>
<p>If a match is found:</p>
<ul>
<li>if <span class="math-container">\$w&gt;2\$</span>, this is a 'symbol' ➝ the score is <span class="math-container">\$3\$</span>.</li>
<li>otherwise the score is given by the expression <code>1&lt;&lt;16/x</code> (<span class="math-container">\$1\$</span> for <code>2<b>0</b>23</code>, <span class="math-container">\$2\$</span> for <code>1<b>9</b>xx</code>, <span class="math-container">\$4\$</span> for <code>1<b>7</b>xx</code> or <code>1<b>8</b>xx</code>)</li>
</ul>
</li>
<li><p>If <code>[w-+-x]==y+[z]</code>, the score is either <span class="math-container">\$2\$</span> or <span class="math-container">\$3\$</span>.</p>
</li>
<li><p>If <code>[w*x]==y+[z]</code>, the score is either <span class="math-container">\$3\$</span> or <span class="math-container">\$5\$</span>.</p>
</li>
<li><p>If none of the above worked out, the score is <span class="math-container">\$\infty\$</span>.</p>
</li>
</ul>
</div>
<div id="pu1" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 315 bytes</h1>

<pre class="lang-javascript prettyprint-override"><code>g=([a,b,c,d,...x],v=W=0,L='')=&gt;a?g(x,v+((0x148b65742d80bb478d07e4dd77f38b367e2a48dcc61f5efd8a935817bd574741de37e99f5b1b08aan+a).match(/..../g).includes(P=a+b+c+d)?a&lt;2?b&lt;9?2:4:a&lt;3||3:[a- -b]==c+d?3:[a*b]==c+d?5:9),L+P+' ')+g([d,...x],v+(c-a-b?c-a*b?9:3:2,L+a+b+c+' '))&amp;&amp;g([b,c,d,...x],v+2,L+a+' '):v&lt;W|!W?(W=v,R=L):R
</code></pre>
<p><a href="https://tio.run/##dZDLboMwEEX3/Yp0E@zYELAhfgjXP5BFlA0LlIVf0FQpVE2Kssi/U1DUSpXSzUj3zpm5mnkzgzm7z@PHJe56H8ZGja0CtcEWO@xxkiTXAx5UpVK8VVEE1YvRLbjiAQGQXrOc203BcuJ5am3OuE9ZyL1nrKHc0g0LxOTcO7fJmiI0nhtBC54x66chlmc@UBaEaAqb2ZQb0yEDk3dzca9gPUUn6xYmx86dvnw4g50yyCKHPNSmJNqWQhOZS1PS243K2sSL2B6UmgA9y9WPKKSAeIt2KFpEELWg/j0LAReb2OqprqwWkkoygfeUGYbL5YT/@QS6E3NXDmV1e640qNSA92oL5X50fXfuTyE59S1oQJQJRqY1Tw9s8Y@fkocThM7u@A0" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<hr />
<h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 268 bytes</h1>
<p>Old answer, doesn't output solution and faultfully</p>

<pre class="lang-javascript prettyprint-override"><code>f=([c,...x],s='')=&gt;c?Math.min(f(x,s+=c),f(x)+('171417271760182018301837190119101936195219722022321535073573370555075508553771057108771877357738'.match(/..../g).includes([A,B,C,D,E]=s)?s&lt;1900?4:s&lt;3e3?3-A:3:B?!+A|E?1/0:A- -B==C+[D]?D?3:2:A*B==C+[D]?D?5:3:1/0:2)):s?1/0:0
</code></pre>
<p><a href="https://tio.run/##dY/NTsMwEITvPAWcEhPH8XrrOrFqrPTnyBNUPURu@oPaBOGAeuDdw4YTh3L4pNHsrHbnrflqYvg4vw951@/bcTy4dBu4EOK249ElCXMvwb82w0lcz116SG88Zi4wToplaQIGZmCUATOXUCoCJwxUEqACCRXOodIKKqOUVAoVaNTSoDaIRmpNmii1RmNAaqIkQVDCYJmIazOEU1rQR6I4MnHuwuVz38Z0W/MlX/E13@xcZD4u6KT0MxsX2KLHvLZol/4pq783Hgpp6/wxXzq3yrbrnV97tMrWz38MTfkppxiz8XdDjqHvYn9pxaU/UvVkKpEw9nDHrv7xqfK9icLJHX8A" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<p>f(string left, to encode)</p>
</div>
<div id="pu2" class="pu"><h1><a href="https://www.ruby-lang.org/" rel="nofollow noreferrer">Ruby</a> <code>-nl</code>, 380 bytes</h1>
<p>Probably the wrong approach to use. Creates a recursive function that checks the input against a gigantic regex sequence, cutting off valid pieces and comparing the scores to find the smallest one. Then, feed input from STDIN into that function and print the result.</p>
<pre class="lang-ruby prettyprint-override"><code>r=(r=*1..9).product([0]+r)
f=-&gt;i,*k{i=~/(2022)|19(01|10|36|52|72)|18(20|30|37)|(3215|3507|3573|3705|550[78]|5537|710[58]|7718|773[58])|17(14|27|60)|(#{r.map{|a,b|[a,b,a+b]*''}*?|})|(#{r.map{|a,b|[a,b,a*b]*''}*?|})|(.)/
k=*$&amp;;l=$&amp;.size/4
s=$6?2+l:$7?3+2*l:[p,$1,$2||$8,$4,$3||$5].index{_1}
(n,v=f[$'];k+=n;s+=v)if$'[0]
i[1]&amp;&amp;(n,v=f[i[1..]];s&gt;v+2&amp;&amp;[[i[0]]+n,v+2])||[k,s]}
p f[$_][0]
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=bVJLbtswEEW71CmEVLD1oWV-RJGKoWTVUwhEYDcxYNh1DTsO2pruRbrpIkVXvVBO0zeiHaNFAWnIeTNvyHnD78_b_ezLr-5qtF5dud-7_Swdx2U-ZsNh9nP_OB_Zlzd-26bbNhdl2WTlZvvpfv_hMe24K7ZZNG9HNwuWLw-L9ts4lVzKzIsm5cIL7lXttfSGIIuYV_hM5lMlhfZKcwNjFDCuvda8M9ZhVcYbwTsNxxhhYRQ5KGJSUXlpfM1R5N1hW36cbg5-yma-g2HTYuby4fCY3_rj_xPyvxLKbBwt2zwZTFZtMih3i68P4yratUl9K4vVdWJuVSHz1XW3YYlgifQ-sSypWKKw065crO8fPh_uxDFK1-ypnXfJ0E2WRbue7Ir2KVvMkyFUihadcIPBKQVOWTo32d08FXIw6ABw5woEC4kWfbdkO3eMNjGq3TnEwhB-nJaXt-9FY2Q8uok72rg4oqV5BVjcnDCMIqCAWGxYTAhijRRWGSn6IDksJpdYUgWGVPCqyopQoWIx7Qmz5xzagUgsS4WrWvDzcTacBRZAYimwMGMMnJvAVj0bGIvxcdyPG2Tqqq9F76PPIx_FJG5AGJ1mRCUaLi7tAWAxQa8dEqS5IAz2n8xwnDhTTvuLOo0VTSNs6CpoBAgaNqTUpbteL6hQK1lXQtpz88D6tJquDFOF6uAFhfX5fyUoHVIuKzJhNbf0_vH8Q3FSDPcHDLmM6K2iqgbaKNXg69UxdZgEwaCo5mROSiHs4vCc_gA" rel="nofollow noreferrer">Attempt This Online!</a></p>
</div>
<div id="pu3" class="pu"><h1><a href="https://github.com/DennisMitchell/jelly" rel="nofollow noreferrer">Jelly</a>, 111 bytes</h1>
<pre><code>“ñJƈƑƁ€µlċ~vọẓɓ÷“©3“¿ẹ’,“¡¥Ƈæ½XṚỌ¢“?“¦ḍ’ḃ;@ƭ/€ÄFfḌ:ȷ2«21ị⁽⁵ȥD¤
3œṖS,PƊD⁼€ɗ/×2,3×LH_.ƲĊ;ÇoȷṂµLḤ$aL$Ḣ&gt;2Ʋ?€S
ŒṖÇÞḢ
</code></pre>
<p><a href="https://tio.run/##RVFda9RAFH3PrxiWPo42M5PsTFxofSgisg9CQZRSxAd9kAXfBF9ktwqRbfugCy6KCvYLRH2wuGzStQqZNmx/xuSPxHOTbgOZj3vuOffeM3n6uNd7UZZF/5P9dSd/k7/NB8XWj2zSO9t@@dzNdt3J6GJkp8hn3xTt/9xJWvQ/cLp/zQ7z2B5lp/dd@tHNdrI9oKuUOXLJLlguedW5mf9cRkn7@tYTl@zcmE9l9l0KN9suBqfFYDI/XMsOPHU@cun7dX43H64Vgz/gX4yX7VhyZcfd2w@v58dnw46Nn82nLt3KJl2XHCw96i65ZG9F5ser4K975@9Qwsb2C9CygynYtRVW9D937tnYpX/zoUdN9psEeDb23Oy3jVHgQVm2Wi0RaUnpDbpsMo@O6ArgLLrEfHlJA8SZ5owQ5CIpjNJSVEkKOKOQVFLVCqkQBYERdYWAM7oTZhYcukFIKkOFg7bwF@1M3QsqgKRSUGk/DH3t61qtKjUwzvD5mM/XYIZBVUtJEVY8ilFMYgLCqJsWgYh80dgDwBlBjcPIiCgSpp6s9gkI7xCR22bCyjOctJVsB0KahQFgFa1NbbEFVYSJTf1K4WJdCVRYU5oTTOyhb7QWWKouTq5hGTAsa1Htymzit/4H" rel="nofollow noreferrer" title="Jelly – Try It Online">Try it online!</a></p>
<p>A monadic link that takes either an integer or a list of decimal digits and returns a list of lists of digits with the optimal score. If the output needs to be a list of integers, this can be done at the cost of one byte (<code>Ḍ</code>) at the end of the main link.</p>
<h2>Explanation</h2>
<pre><code>“ñJƈƑƁ€µlċ~vọẓɓ÷“©3“¿ẹ’,“¡¥Ƈæ½XṚỌ¢“?“¦ḍ’ḃ;@ƭ/€ÄFfḌ:ȷ2«21ị⁽⁵ȥD¤  # ‎⁡Helper link 1: takes a list of digits and returns a score based on the two types of fixed four-digit integers, or zero if no match
“ñJƈƑƁ€µlċ~vọẓɓ÷“©3“¿ẹ’,“¡¥Ƈæ½XṚỌ¢“?“¦ḍ’                        # ‎⁢Compressed integer list of lists: [[105435108560611884151247538639414029, 1802, 3215], [15599387739683358002, 64, 1714]]
                                             €                  # ‎⁣For each list:
                                           ƭ/                   # ‎⁤- Reduce by doing the following alternately
                                        ḃ                       # ‎⁢⁡  - Convert to bijective base
                                         ;@                     # ‎⁢⁢  - Concatenate, in reverse order
                                              Ä                 # ‎⁢⁣Cumulative sum
                                               F                # ‎⁢⁤Flatten
                                                fḌ              # ‎⁣⁡Keep only those that match the helper link’s argument (after it’s been converted to an integer from decimal digits)
                                                  :ȷ2           # ‎⁣⁢Integer divide by 100
                                                     «21        # ‎⁣⁣Min of this and 21
                                                        ị⁽⁵ȥD¤  # ‎⁣⁤Index into 3,4,4,2,1 (⁽⁵ȥ encoded 34421 which is then split into decimal digits)

3œṖS,PƊD⁼€ɗ/×2,3×LH_.ƲĊ;ÇoȷṂµLḤ$aL$Ḣ&gt;2Ʋ?€S                      # ‎⁤⁡Helper link 2: takes a list of lists of digits and works out the score for each sublist before summing them
                                        €                       # ‎⁤⁢For each list:
                                      Ʋ?                        # ‎⁤⁣- If the following is true:
                                aL$                             # ‎⁤⁤  - And list with its length (handles voiding lists that start with zero)
                                   Ḣ                            # ‎⁢⁡⁡  - Head
                                    &gt;2                          # ‎⁢⁡⁢  - Is greater than 2
                            µ                                   # ‎⁢⁡⁣- Then:
3œṖ                                                             # ‎⁢⁡⁤  - Split before third list member
          ɗ/                                                    # ‎⁢⁢⁡  - Reduce this list using the following:
   S,PƊ                                                         # ‎⁢⁢⁢    - Sum paired with product
       D                                                        # ‎⁢⁢⁣    - Convert to decimal digits
        ⁼€                                                      # ‎⁢⁢⁤    - Check whether each equal to second half of list
            ×2,3                                                # ‎⁢⁣⁡  - Multiply by 2 (for addition) and 3 (for multiplication)
                ×    Ʋ                                          # ‎⁢⁣⁢  - Multiply by the following
                 LH                                             # ‎⁢⁣⁣    - Half the length of the list
                   _.                                           # ‎⁢⁣⁤    - Minus 0.5
                      Ċ                                         # ‎⁢⁤⁡  - Ceiling
                       ;Ç                                       # ‎⁢⁤⁢  - Concatenate to result of running helper link 1 on the original list
                         oȷ                                     # ‎⁢⁤⁣  - Or with 1000 (replaced zeros with 1000)
                           Ṃ                                    # ‎⁢⁤⁤  - Minimum
                             LḤ$                                # ‎⁣⁡⁡- Else: double the length of the list
                                         S                      # ‎⁣⁡⁢Sum

ŒṖÇÞḢ                                                           # ‎⁣⁡⁣Main link: takes an integer or a list of decimal digits and returns a list of lists of digits with the lowest score
ŒṖ                                                              # ‎⁣⁡⁤Partitions of list
  ÇÞ                                                            # ‎⁣⁢⁡Sort by results of helper list 2 on each partition
    Ḣ                                                           # ‎⁣⁢⁢Head
💎
</code></pre>
<p>Created with the help of <a href="https://vyxal.github.io/Luminespire" rel="nofollow noreferrer">Luminespire</a>.</p>
</div>
<div id="pu4" class="pu"><h1>Haskell, 560 bytes</h1>
<pre><code>i x=read[x]
r x c=(\(a,b)-&gt;(a+c,x:b)).f
m(a:b:c:l)|i a+i b==i c&amp;&amp;a/='0'=r[a,b,c]2l
 |i a*i b==i c&amp;&amp;a/='0'=r[a,b,c]3l
m(a:b:c:d:l)|i a+i b==read[c,d]&amp;&amp;a/='0'&amp;&amp;c/='0'=r[a,b,c,d]3l
 |i a*i b==read[c,d]&amp;&amp;a/='0'&amp;&amp;c/='0'=r[a,b,c,d]5l
m _=(maxBound::Int,[])
y(a:b:c:d:l)|elem[a,b,c,d]$words&quot;1714 1727 1760 1820 1830 1837&quot;=r[a,b,c,d]4l
 |elem[a,b,c,d]$words&quot;1901 1910 1936 1952 1972&quot;=r[a,b,c,d]2l
 |[a,b,c,d]==&quot;2022&quot;=r[a,b,c,d]1l
 |elem[a,b,c,d]$words&quot;3215 3507 3573 3705 5507 5508 5537 7105 7108 7718 7735 7738&quot;=r[a,b,c,d]3l
y(x:l)=r[x]2l
f[]=(0,[])
f l=min(m l)$y l
</code></pre>
<p>Ungolfed version:</p>
<pre><code>
import Data.Char
import Control.Arrow

type Partition = [String]

badResult :: (Int, Partition)
badResult = (maxBound, [])


optimalMemorization :: String -&gt; (Int, Partition)
optimalMemorization [] = (0, [])
optimalMemorization xs = minimum $ map ($ xs) [math, relation]

recurse :: String -&gt; String -&gt; Int -&gt; (Int, Partition)
recurse prefix rest cost = ((+ cost) *** (prefix :)) (optimalMemorization rest)

math :: String -&gt; (Int, Partition)
math (a:b:c:xs)
    | digitToInt a + digitToInt b == digitToInt c &amp;&amp; a /= '0' = recurse [a, b, c] xs 2
    | digitToInt a * digitToInt b == digitToInt c &amp;&amp; a /= '0' = recurse [a, b, c] xs 3
math (a:b:c:d:xs)
    | digitToInt a + digitToInt b == read ([c, d]) &amp;&amp; a /= '0' &amp;&amp; c /= '0' = recurse [a, b, c, d] xs 3
    | digitToInt a * digitToInt b == read ([c, d]) &amp;&amp; a /= '0' &amp;&amp; c /= '0' = recurse [a, b, c, d] xs 5
math _ = badResult

relation :: String -&gt; (Int, Partition)
relation (a:b:c:d:xs)
    | [a, b, c, d] `elem` [&quot;1714&quot;, &quot;1727&quot;, &quot;1760&quot;, &quot;1820&quot;, &quot;1830&quot;, &quot;1837&quot;] = recurse [a, b, c, d] xs 4
    | [a, b, c, d] `elem` [&quot;1901&quot;, &quot;1910&quot;, &quot;1936&quot;, &quot;1952&quot;, &quot;1972&quot;] = recurse [a, b, c, d] xs 2
    | [a, b, c, d] == &quot;2022&quot; = recurse [a, b, c, d] xs 1
    | [a, b, c, d] `elem` [&quot;3215&quot;, &quot;3507&quot;, &quot;3573&quot;, &quot;3705&quot;, &quot;5507&quot;, &quot;5508&quot;, &quot;5537&quot;, &quot;7105&quot;, &quot;7108&quot;, &quot;7718&quot;, &quot;7735&quot;, &quot;7738&quot;] = recurse [a, b, c, d] xs 3
relation (x:xs) = recurse [x] xs 2 -- Residual option
</code></pre>
<p>We pass around <code>(Int, Partition)</code>s where the <code>Int</code> is the cost and <code>Partition</code> is the answer. As we go, we take a <code>min</code> of these. <code>min</code> on tuples compares the first element first, so we always take a minimum cost element using the default Haskell comparison.</p>
<p>In terms of branching, we only have to check <code>math</code> (<code>m</code> in the golfed version) and <code>relation</code> (resp. <code>y</code>). <code>relation</code> checks the year condition and the symbol condition, which are mutually exclusive and hence safe to check together. <code>math</code> checks the four mathematical conditions in order: 3-digit sum, 3-digit product, 4-digit sum, 4-digit product. This order will always produce an optimal mathematical result.</p>
<p>Proof: If 3-digit sum succeeds, then 3-digit product just costs more and is not optimal. 4-digit sum cannot succeed since two numbers cannot add up to two different results simultaneously, and 4-digit product is not optimal because it's worse than just taking the 3-digit sum and treating the fourth digit as residual (<code>2 + 2</code> vs. <code>5</code>). If 3-digit product succeeds, then 4-digit sum must fail (sums are not larger than products), and 4-digit product must fail since the product can't be two different numbers. Finally, if 4-digit sum succeeds, it's better than 4-digit product by cost alone. ∎</p>
<p>So implement our main function <code>optimalMemorization</code> (resp. <code>f</code>) recursively. If the string is empty, cost is zero. Else, try <code>math</code> and <code>relation</code> and take the minimum cost between the two (if the cost is the same, we choose the string that would appear first in the dictionary, which is a harmless tiebreaker).</p>
<p><code>recurse</code> (resp. <code>r</code>) is a helper function, since we always combine our results in the same way, so it's better to give this helper a name. <code>i</code> in the golfed version is just <code>Data.Char.digitToInt</code>, but it's shorter to write it ourselves rather than importing.</p>
<p>Our <code>badResult</code> is just the &quot;failure&quot; case (since the math rules might not even apply at all) and produces a memorization string with the worst possible cost. Unfortunately, in the golfed version, we need a <code>::Int</code> here. It didn't have to be here, but we had to put a type annotation somewhere, because without specifying that our math is being done with integers, all Haskell can tell is that our math is being done with some <code>(Num a, Bounded a, Ord a) =&gt; a</code> type, and it's ambiguous which one.</p>
</div>
<div id="pu5" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, 156 bytes</h1>
<pre><code>≔⟦⟦⁰Ｓ⟧⟧θＦθ«≔⊟ιη¿ηＦ⊞Ｏ⁺Ｅ⪪”)¶≕⁰∨℅U:.ï4◧Π-⊙⁵z›“Dνq⬤◧≦rＳ=≦:nＷ→NＥE⊕ζTΣ✂aＨ⟲“↶¿!⧴p↘Y”⁵⪪κ⁴Ｅ∧›η1⟦Σ…η²Π…η²⟧⟦⁺…η²κ×⊕λＬκ⟧⟦…η¹2⟧Ｆ¬⌕η§κ⁰⊞θ⁺Ｅι⎇νμ⁺Σ⊟κμ⟦…ηＬ§κ⁰✂ηＬ§κ⁰⟧⊞υι»✂⌊υ¹
</code></pre>
<p><a href="https://tio.run/##dVJNi9swED1vfoXwaQQu6CNeZdlTWGgJdFtDegs5GEcbi9iyI8ulS@lvd5@S7KG71KCHNW8@3oymbqpQ91U7z@txdEdPu53I2cYPU9zG4PyR@H6fszN/XLz0gdGZs9@Lu5tv2Q/keM4asHfuhVHD2cWrnMbm@2BDFftAZTuN9FwNtB1aFymTRi6X0igDuBdLuVIJ9AVgexBSyQcpAPoeUCiAUUoJ/GglC60LYQA42ohCF@kKWAG00UbCBkAykzKCS7DSWc4KiL2qOOVsyXFLutb@QF@CraIN1OQskxmI3Xbq6Om1bu1TgzZhV8m/DP1hquMHZp9CLp2@Y3J2wvnhOjvSxtfBdtZHe6AW1q/WH2NDpxSe4v8JlbBkKgNznem3PtJnB6ng1nHjD/ZX6kJwfCwNnM6Q9zZrh5o2@Cq8ks9Zd2NST@nRTqlcxz8WvSl6lx9Da11t/@8AkdgA2472qmTKmYPlz6LECkW6Rj877zoImHhqjj/Oc9qEQsj05MD0wPOnn@1f" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Gives alternative results for two of the inputs. Explanation:</p>
<pre><code>≔⟦⟦⁰Ｓ⟧⟧θＦθ«
</code></pre>
<p>Perform a breadth first search over partitions starting with no partitions yet and a score of zero.</p>
<pre><code>≔⊟ιη
</code></pre>
<p>Get the next unpartitioned suffix.</p>
<pre><code>¿η
</code></pre>
<p>If it wasn't empty:</p>
<pre><code>Ｆ⊞Ｏ⁺Ｅ⪪”...”⁵⪪κ⁴Ｅ∧›η1⟦Σ…η²Π…η²⟧⟦⁺…η²κ×⊕λＬκ⟧⟦…η¹2⟧
</code></pre>
<p>Loop over three lists: a) A list of years and symbols, with their scores b) If the suffix does not begin with <code>0</code>, then a list of additions and products, with their scores c) A list of the first digit with a score of <code>2</code>.</p>
<pre><code>Ｆ¬⌕η§κ⁰
</code></pre>
<p>If the suffix starts with this potential partition, then...</p>
<pre><code>⊞θ⁺Ｅι⎇νμ⁺Σ⊟κμ⟦…ηＬ§κ⁰✂ηＬ§κ⁰⟧
</code></pre>
<p>Push the updated partition and score to the search list.</p>
<pre><code>⊞υι
</code></pre>
<p>But if it was empty, then collect the completed partition in the predefined empty list.</p>
<pre><code>»✂⌊υ¹
</code></pre>
<p>Output the partition with the lowest score, tied by shortest length of the first different substring.</p>
</div>
<div id="pu6" class="pu"><h1><a href="https://github.com/Adriandmen/05AB1E/wiki/Commands" rel="nofollow noreferrer">05AB1E</a>, 114 <a href="https://github.com/Adriandmen/05AB1E/wiki/Codepage" rel="nofollow noreferrer">bytes</a></h1>
<pre><code>.œDεεgÐVi·ë5;÷i•иΩÅjnÃñ8ä{5pqŒΩ&amp;™ l
&amp;5ƒZtøà₆é~λãÝαB‡~hq•žEвyk©(iy¬_iëR3äí©`+QY&lt;*D_i\®`*QYD4Q+*D_I*+}ë®Žζ›₂в@O]OWkè
</code></pre>
<p><a href="https://tio.run/##AbsARP9vc2FiaWX//y7Fk0TOtc61Z8OQVmnCt8OrNTvDt2nigKLQuM6pw4VqbsODw7E4w6R7NXBxxZLOqSbihKIgbAomNcaSWnTDuMOg4oKGw6l@zrvDo8OdzrFC4oChfmhx4oCixb5F0LJ5a8KpKGl5wqxfacOrUjPDpMOtwqlgK1FZPCpEX2lcwq5gKlFZRDRRKypEX0kqK33Dq8Kuxb3OtuKAuuKCgtCyQE9dT1drw6j//zU0MjAyMjQzMjE1" rel="nofollow noreferrer">Try it online</a> or <a href="https://tio.run/##NYzBSgJRFIb3PYW4kNCLzLlzr/cOBUZMazHItBItiJqMSopgiESsXIetgzIXDVOCgilFLeYwLQefYV5kmlFa/B@c8/N/p@e7e8Z@cGlm4zG/3YnFs6a@EQ/S7oPujbzRAd4XDGeMNl/CseE3u9OJZ@Hd0Qne4EBi74qf1d2OZyX8227seCHBfztbFzjBJ7/VRqvhfeELPnqDVb/53Dish3v3Z206NGuOtWiYzlvFKKK9rmIP3x2rmsqXlpN6xdhx@tVkvqSzfCo8i8nUNdpO3/32Pvzmp99qTYcrObSL5dxmDV@DeLpAgm3QBCURtBkVSolGQaqCAgGqEsYkUBJBJSCjnmVAIUwNH0LhXBGKIJzNCpUCJyCAgabAXKVJ0DSQ82UoDEUZlWYYUBnp@X9IGK5IISCMKst/" rel="nofollow noreferrer">verify almost all test cases</a> (the largest two are omitted because they'll timeout on TIO).</p>
<p><strong>Explanation:</strong></p>

<pre class="lang-python prettyprint-override"><code>.œ                         # Get all partitions of the (implicit) input
  D                        # Duplicate it
   ε                       # Map over each partition:
    ε                      #  Inner map over each part:
     g                     #   Pop and push the length of the part
      Ð                    #   Triplicate this length
       V                   #   Pop one copy, and store it in variable `Y`
      i                    #   Pop another copy, and if it's 1:
       ·                   #    Double the length to 2
      ë                    #   Else (the length is &gt;=2):
       5;                  #    Push 2.5 (halve 5)
         ÷                 #    Integer-divide the length by this 2.5
       i                   #    If this is 1 (aka the length was 3 or 4):
        •иΩÅjnÃñ8ä{5pqŒΩ&amp;™ l\n&amp;5ƒZtøà₆é~λãÝαB‡~hq•
                           #     Push compressed integer 2059679753934118777767891051414020721847227706932308941504785260793787677550089063849770927917
         žEв               #     Convert it to base-8192 as list: [2022,1901,1910,1936,1952,1972,3215,3507,3573,3705,5507,5508,5537,7105,7108,7718,7735,7738,1714,1727,1760,1820,1830,1837]
             yk            #     Get the index of the current part in this list
                           #     (or -1 if it's not in this list)
               ©           #     Store this index in variable `®` (without popping)
        (i                 #     If the index is -1:
          y                #      Push the current part again
           ¬               #      Push its leading digit (without popping)
          _i               #      If this leading digit is a 0:
                           #       (use the current part implicitly)
           ë               #      Else:
            R              #       Reverse the part
             3ä            #       Split it into three parts
               í           #       Reverse each part
                           #       (converts the part to a triplet: ABC→[C,B,A] and ABCD→[CD,B,A])
                ©          #       Store this triplet in variable `®` (without popping)
                 `         #       Pop and push the parts to the stack
                  +        #       Add the top two (B+A)
                   Q       #       Check if its equal to the other integer (C or CD)
                    Y&lt;     #       Push the part's length - 1
                      *    #       Multiply it to the check
            D              #       Duplicate it
             _i            #       Pop and if it's 0:
               \           #        Discard the duplicated part
                ®          #        Push triplet `®` again
                 `*Q       #        B*A this time
                    YD4Q+  #        Push the part's length + (length==4)
                         * #        Multiply it to the check
               D           #        Duplicate it
                _          #        Pop and check whether its 0
                 I*        #        Multiply it to the input
                   +       #        Add it to the earlier value
              }            #       Close this if-statement
                           #       (implicit else: use the duplicated value)
         ë                 #     Else (the index was not -1):
          ®                #      Push the index again from variable `®`
           Žζ›             #      Push compressed integer 17749
              ₂в           #      Convert it to base-26 as list: [1,0,6,17]
                @          #      Check for each whether it's &gt;= the index
                 O         #      Sum those checks together
                           #    (implicit else: the length is 2 or &gt;=5)
                           #     (implicitly use the implicit input-integer)
   ]                       # Close all if-else statements and the nested maps
    O                      # Sum each inner list together
     W                     # Push the minimum of the sums (without popping the list)
      k                    # Get the (first) index of this minimum in the list of sums
       è                   # Use that to index into the list of partitions
                           # (after which this partition is output implicitly as result)
</code></pre>
<p><a href="https://codegolf.stackexchange.com/a/166851/52210">See this 05AB1E tip of mine (sections <em>How to compress large integers?</em> and <em>How to compress integer lists?</em>)</a> to understand how the compressed integers and lists work.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/266208/">266208</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




