<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::229295</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>020</td><td>Jelly</td><td>240910T003542Z</td><td><a href="https://codegolf.stackexchange.com/questions/229295/simplify-k-combinatory-logic-expression/275442#275442">Unrelate</a></td></tr>
<tr d-ix="1"><td>027</td><td>Perl 5 p</td><td>210609T001143Z</td><td><a href="https://codegolf.stackexchange.com/questions/229295/simplify-k-combinatory-logic-expression/229296#229296">Anders K</a></td></tr>
<tr d-ix="2"><td>064</td><td>Haskell</td><td>210610T043959Z</td><td><a href="https://codegolf.stackexchange.com/questions/229295/simplify-k-combinatory-logic-expression/229369#229369">Unrelate</a></td></tr>
<tr d-ix="3"><td>082</td><td>Python 3</td><td>210609T025931Z</td><td><a href="https://codegolf.stackexchange.com/questions/229295/simplify-k-combinatory-logic-expression/229305#229305">Unrelate</a></td></tr>
<tr d-ix="4"><td>021</td><td>Jelly</td><td>210609T122450Z</td><td><a href="https://codegolf.stackexchange.com/questions/229295/simplify-k-combinatory-logic-expression/229328#229328">Nick Ken</a></td></tr>
<tr d-ix="5"><td>070</td><td>JavaScript ES2019</td><td>210609T030033Z</td><td><a href="https://codegolf.stackexchange.com/questions/229295/simplify-k-combinatory-logic-expression/229306#229306">tsh</a></td></tr>
<tr d-ix="6"><td>043</td><td>Retina 0.8.2</td><td>210609T092904Z</td><td><a href="https://codegolf.stackexchange.com/questions/229295/simplify-k-combinatory-logic-expression/229318#229318">Neil</a></td></tr>
<tr d-ix="7"><td>137</td><td>Haskell</td><td>210609T090923Z</td><td><a href="https://codegolf.stackexchange.com/questions/229295/simplify-k-combinatory-logic-expression/229317#229317">Wheat Wi</a></td></tr>
<tr d-ix="8"><td>190</td><td>Python 3</td><td>210609T001731Z</td><td><a href="https://codegolf.stackexchange.com/questions/229295/simplify-k-combinatory-logic-expression/229297#229297">hyper-ne</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://github.com/DennisMitchell/jelly" rel="nofollow noreferrer">Jelly</a>, 20 bytes</h1>
<pre><code>OḂU;Ṫ’o+ɗṪṭƲṛ?/ṬCṫ@Q
</code></pre>
<p><a href="https://tio.run/##y0rNyan8/9//4Y6mUOuHO1c9apiZr31yOpD1cOfaY5se7pxtr/9w5xrnhztXOwT@P9yuGfn/fzSXkreSDpeSgzeUgjGANJwJ5cCVgPjeSErBXCjpjdAE1wemIWwHJHUOYCOgmh3gKqDKoFZAOQ4oPIRpEOtiAQ" rel="nofollow noreferrer" title="Jelly – Try It Online">Try it online!</a></p>
<p>Stumbled back on this challenge yesterday (due to having a few too many tabs open), and decided I'd try a solution that treats the output as numeric before reconstituting to an expression at the end. After quite a few sporadic insights--many of which turned out to be wishful thinking, but the most crucial of which was simply <em>not</em> inverting the bits of the processed input--it just barely beats Nick Kennedy's excellent existing Jelly solution.</p>
<pre><code>OḂ                      Parity bit of each codepoint: @ -&gt; 0, K -&gt; 1
  U                     Reverse
              /         and reduce left to right:
            ṛ?          if the right argument / current new element is 1,
   ;                    append it to the stack,
          ṭ             else append
    Ṫ                   the popped top of the stack
     ’                  decremented
      o                 unless that's 0, in which case use
       +ɗ               its sum with
         Ṫ Ʋ            the popped new top of the stack.
               Ṭ        Untruth the single remaining element (n-1 0s and a 1),
                C       subtract from 1,
                 ṫ@     and for each give that many elements from the end of
                   Q    the uniquified input (&quot;@K&quot; unless we don't need it).
</code></pre>
<p>This essentially treats <code>@K</code> as an &quot;increment&quot; instruction, <code>K</code> as the number 1, and <code>@</code> on anything other than <code>K</code>/1 as &quot;decrement top and pop second from top&quot;.</p>
</div>
<div id="pu1" class="pu"><h1 id="perl-5-p-28-27-bytes-dj1f"><a href="https://www.perl.org/" rel="nofollow noreferrer">Perl 5</a> <code>-p</code>, <s>28</s> 27 bytes</h1>

<pre class="lang-perl prettyprint-override"><code>s/@(.K)(\1*K)\1*K/$2/&amp;&amp;redo
</code></pre>
<p><a href="https://tio.run/##K0gtyjH9/79Y30FDz1tTI8ZQy1sTROirGOmrqRWlpuT//@/N5eANwmASSEBoKAsiA@J4w1SA2VDSG6oWrhxMQ9gOSIocwJqhOh3gKqDKoIZDOQ4oPIRpQFX/8gtKMvPziv/rFgAA" rel="nofollow noreferrer" title="Perl 5 – Try It Online">Try it online!</a></p>
<h3 id="how-it-works-bsc9">How it works</h3>
<p>Each term in the <span class="math-container">\$K\$</span> calculus normalizes to <span class="math-container">\$a_i = (\texttt{@K})^i\texttt K\$</span> for some <span class="math-container">\$i \ge 0\$</span>, because <span class="math-container">\$\texttt K = a_0\$</span>, <span class="math-container">\$\texttt @a_0a_j = a_{j + 1}\$</span>, and <span class="math-container">\$\texttt @a_{i + 1}a_j \to a_i\$</span>.  So the innermost redex always looks like <span class="math-container">\$\texttt @(\texttt{@K})^{i + 1}\texttt K(\texttt{@K})^j\texttt K\$</span> for some <span class="math-container">\$i, j \ge 0\$</span>, and reduces to <span class="math-container">\$(\texttt{@K})^i\texttt K\$</span>.</p>
<p>To avoid the need to escape <code>@K</code> (which would otherwise refer to an array) as <code>\@K</code>, we relax it to <code>.K</code>, using backreferences for further copies.  This doesn’t introduce bugs because any invalid redex <span class="math-container">\$\texttt @(\texttt{KK})^{i + 1}\texttt K(\texttt{KK})^j\texttt K\$</span> must be preceded by a valid redex <span class="math-container">\$\texttt @(\texttt{@K})^{i + 1}\texttt K(\texttt{@K})^j\texttt K\$</span>.</p>
</div>
<div id="pu2" class="pu"><h1><a href="https://www.haskell.org/" rel="nofollow noreferrer">Haskell</a>, <s>68</s> 64 bytes</h1>

<pre class="lang-hs prettyprint-override"><code>head.foldr(#)[]
'K'#s=&quot;K&quot;:s
a#(t:n:s)|_:_:v&lt;-t=v:s|u&lt;-a:t++n=u:s
</code></pre>
<p><a href="https://tio.run/##VYxBDoMgEEX3noLUhRqjByCQsKc9QdsYoqCmikTQbjx7qSK17WL@/J95fxqmH7zrrMA323BW5WLoqjEOk@s9iGgUanyiJ6gDFsYGSqiTpYAFnFFm8Az1MqGMQZOmEk9Q2561EmDQM3UpQKzGVhqQA5Gs8hzGSgOMEKi5ObeSWwoI3cbpKvv2br9sgX4I571Szx6427snPxBxZd8kB@Ex/9wH8pe@31bqVYqO1dpmpVJv" rel="nofollow noreferrer" title="Haskell – Try It Online">Try it online!</a></p>
<p><em>-4 thanks to Wheat Wizard actually using the destructured arguments and realizing that the input only consists of one expression (so at the end there should only be one on the stack)</em></p>
<p>Another translation of my Python answer.</p>
<pre class="lang-hs prettyprint-override"><code>    .            -- The relevant function is the composition of
     foldr(#)    -- right-associative folding #
             []  -- starting from an empty list
head             -- and taking the first element from the result.

'K'#s=           -- If the item encountered is the character 'K', # yields
      &quot;K&quot;:s      -- the string &quot;K&quot; prepended to the accumulator.
a#               -- If it's something else (that is, '@', which we bind to a),
  (t:n: )        -- let t and n be the first two elements of the accumulator
       s         -- and s the remaining elements;
  |_:_:v&lt;-t      -- if t has at least two elements to ignore let v be the rest
           =v:s  -- and yield v prepended to s,
  |u&lt;-           -- else t must be &quot;K&quot;, let u be
      a:t        -- &quot;@K&quot;
         ++n     -- concatenated with n
            =u:s -- and yield u prepended to s.
</code></pre>
</div>
<div id="pu3" class="pu"><h1><a href="https://docs.python.org/3/" rel="nofollow noreferrer">Python 3</a>, 82 bytes</h1>

<pre class="lang-python prettyprint-override"><code>import re
def f(e,n=1):
 while n:e,n=re.subn(r'@(@K)(\1*K)\1*K',r'\2',e)
 return e
</code></pre>
<p><a href="https://tio.run/##VU5BjsIwDLznFb45QQGJ3RtSUe7@AqcVqbBUksikWu3ru0kIhV7smfF47PSXbzF8LwvfU5QM4tXVjzBqb8NwNCcFvzeePIRTFcQfHvNP0IJOOzL6ctyRqQWt4OULrTeqRORZAvhljAITcADOXjSHNGcLiDWULUQYYDo80sRZI@zPgHW3iKPmgpJwyLr4cH9GC2LrbIBoFqpmUo4aKK3AlTRaShcq6XQVqCm0WXottkGvtM1076TWn9h9uF2z9gi3Orqtn@zEbdg7jbY/1dPqHw" rel="nofollow noreferrer" title="Python 3 – Try It Online">Try it online!</a></p>
<p>Obligatory translation of Anders Kaseorg's excellent Perl solution. I will admit to not being sure this works.</p>
<p>Without regex:</p>
<h1><a href="https://docs.python.org/3/" rel="nofollow noreferrer">Python 3</a>, <s>125</s> <s>122</s> <s>97</s> <s>96</s> <s>94</s> 89 bytes</h1>

<pre class="lang-python prettyprint-override"><code>def f(e,*s):
 for x in e[::-1]:s=[x,*s]*(x&gt;'@')or[s[0][2:]or'@K'+s[1]]+s[2:]
 return s[0]
</code></pre>
<p><a href="https://tio.run/##VU5BjsMgDLznFb6ZdMlq270hJeLOExC3EhUpggiolH191rA03VzsmfF47PUnP4L/3ve7nWFmll9SLzqYQ4QNnAerhRiuRqRRbzQzF7ZNKLEPUSf9ZfRNmBBRKvxI@moMVVI6iDY/o4di2UvWUrJctpE5vz4zB8RyxnEIMMLymdbFZYYwTIA9rZM4M0dojc5nRj4cJuQQeZmNEPpdFbPqpKqAGsGDVEqlCYU0egiqKuq09Fqsg1bVOVO@k2r/w/KfW1Zri5CHo9nayUbkib3T1Pmncrr7BQ" rel="nofollow noreferrer" title="Python 3 – Try It Online">Try it online!</a></p>
<p><em>-3 bytes because naming <code>o</code> was entirely pointless</em></p>
<p><em>-23 bytes thanks to tsh, and then I also shaved another 2 off since not needing list mutability opens the door to some splat abuse</em></p>
<p><em>-1 byte because it's not like <code>s</code> has to not be a list either</em></p>
<p><em>-2 bytes thanks to ovs replacing the ternary with another <code>or</code></em></p>
<p><em>-5 porting Wheat Wizard's second golf to my Haskell solution</em></p>
<p>(Note: there are old explanations in the edit history)</p>
<pre class="lang-python prettyprint-override"><code>def f(e   ):             # Define a function f taking an argument e
       ,*s               # and collecting any extra arguments into a tuple s.
                         # (There are no extra arguments, so s is empty.)
 for x in e[::-1]:       # For each element x of e, in reverse order:
  s=[    ]*(x&gt;'@')       # if x is 'K', set s to a list
     x,*s                # containing x followed by the elements of s,
  s=              or     # else set s to:
   [ ... ]+s[2:]         # s without its first two elements, appended to:
                         # (note: this would error if s was not a list,
                         # but a valid input must end in K)
    s[0]                 # the first element of s
        [2:]             # without its first two characters
            or           # unless that's empty, otherwise
              '@K'+s[1]  # the second element of s appended to 'K@'.
 return s[0]             # Return the sole remaining element of s.
</code></pre>
<p>I'd attempted to remove the final reversal before, but it came out longer because I tried using <code>insert</code> instead of removing <code>pop</code>.</p>
<p>Since Python 2 doesn't require you to import <code>reduce</code> (why would they change that? :/ also thanks again to tsh), porting to it saves two more bytes:</p>
<h1><a href="https://docs.python.org/2/" rel="nofollow noreferrer">Python 2</a>, <s>93</s> <s>92</s> 86 bytes</h1>

<pre class="lang-python prettyprint-override"><code>lambda e:reduce(lambda s,x:([x]+s)*(x&gt;'@')or[s[0][2:]or'@K'+s[1]]+s[2:],e[::-1],[])[0]
</code></pre>
<p><a href="https://tio.run/##VU7RbsMgDHzPV1iVImCl09pHpFS88wkUTdmaaEhpiAzV0q/PgLF0ebHvzuezp0f4cuNp6ZvLMrS3j2sLncDuev/saOGez4Lq2ew9e6HzmUjCHGqv34w@CeOQSEX2Xh9NdCSFd1qIw9FwbVg0Lb1DGMCOYEOHFNvvdztO98CBECYqsBwcNDC8@mmwgRI4nIGwCjCKPbURTWjHALvap1GstEa2gxpoXEWejA04tqg0VpVUGcQW4UoyjaUIiRS6CiorarP0t5gHpaptpnwm5f6L5T@3zNYSIVdHsZWThcgNe6ap7U/pdPUD" rel="nofollow noreferrer" title="Python 2 – Try It Online">Try it online!</a></p>
<p><em>-1 porting ovs's golf</em></p>
<p><em>-5 porting Wheat Wizard's second golf to my Haskell solution</em></p>
</div>
<div id="pu4" class="pu"><h1><a href="https://github.com/DennisMitchell/jelly" rel="nofollow noreferrer">Jelly</a>, <s>22</s> 21 bytes</h1>
<pre><code>Ṫṫ3ȯṪ⁾0K;Ɗṭ
ṚṭÇ}V?@/Ṛ
</code></pre>
<p><a href="https://tio.run/##y0rNyan8///hzlUPd642PrEeyHjUuM/A2/pY18Oda7ke7pwFpA6314bZO@gDOf@tHzXMUdC1U3jUMNf6cDsXUK2DQSWQ8XD3loc7Nj3csehw@7GuR01rIv//9wap8@Zy8AYzgBSQCeeAuUACKgDiQLlwAW@wiDeKJphGsASU9EY10wFhEpiGsB2QVDuAlUKNcICrgCqDWgnlOKDwEKZ5o7oJyAcA" rel="nofollow noreferrer" title="Jelly – Try It Online">Try it online!</a></p>
<p>A full program that takes a single argument consisting of <code>K</code>s and <code>0</code>s and prints the output to STDOUT using the same symbols.</p>
<p>Based on @UnrelatedString’s Python answer so be sure to upvote that one too!</p>
<p>Thanks also to @UnrelatedString for saving a byte!</p>
<h2>Explanation</h2>
<h3>Helper link</h3>
<p>Takes the current draft output list and processes it where there was a zero in the next position</p>
<pre><code>Ṫ            | Tail (pop last element from list)
 ṫ3          | Third character onwards
   ȯ     Ɗ   | Or the following as a monad:
    Ṫ        | - Tail (pop last element from list)
     ⁾0K;    | - Concatenate &quot;0K&quot; to this
          ṭ | Tag onto end of draft output list (this will have lost its last two members via the action of Ṫ twice)
</code></pre>
<h3>Main link</h3>
<pre><code>Ṛ         | Reverse
      @/  | Reduce using the following, swapping left and right arguments:
    V?    | - If the next value in the reversed list evaluates to non-zero (i.e. is a K)
 ṭ        | - Then wrap it in a list and add to the end of the draft output list
   Ç      |   - Otherwise call helper link on draft output list
        Ṛ | Finally reverse, and implicitly smash together and print
</code></pre>
</div>
<div id="pu5" class="pu"><h1>JavaScript (ES2019), 70 bytes</h1>

<pre class="lang-javascript prettyprint-override"><code>s=&gt;(i=0,T=(p=s[i++],N=p&lt;s?[p,p=T(),T()]:[p])=&gt;p[1]&gt;s?p[2]:N)().flat(i)
</code></pre>
<p><a href="https://tio.run/##fY7NDoIwEITvvgjdUIl6RBd6b8KJW9MDQTA1hG4s8fUrYoM/ST10251vO7PX5t649mZo2o723PkevcOCGdzxGhmhUyZNNa@QTq5UxAlrBnw@OlekAQtSe124ktRB5xUwyPqhmZgB39rR2aHLBnthPUtkAnDc/IhCRuQYmPUoCjBq@eTyj/WCQ5XxkDVnuV9v8fFPLBHBTKwTYSysEBrx1b3dQrx/AA" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<p>This one try to parse the string into a tree, and then convert back.</p>
<pre class="lang-javascript prettyprint-override"><code>s=&gt; // Input String
(i=0, // cursor for reading the string
T=( // We try to parse the string into a prefix expression tree
    // Tree structure would be `&lt;exp&gt; ::= [&quot;K&quot;] | [&quot;@&quot;, &lt;exp&gt;, &lt;exp&gt;]`
p=s[i++], // get character under cursor, and move cursor to next character
N= // Node for expression tree
  p&lt;s? // s would be a single &quot;K&quot; or start with &quot;@&quot;
       // In either cases, `p&lt;s` indicate `p` is &quot;@&quot;
  [p, // Expression node, &quot;@&quot; character
   p=T(), // We reuse `p` variable to storage left child of current node
   T() // And right child here
  ]:
  [p] // `[&quot;K&quot;]` as leaf node
)=&gt;
  p[1] // If current character is &quot;K&quot;, then p === &quot;K&quot;, p[1] would be (void 0)
       // If current character is &quot;@&quot;, then p is left child
       //    If left child is leaf node [&quot;K&quot;], p[1] is (void 0)
       //    If left child is non-leaf node [&quot;@&quot;, &lt;exp&gt;, &lt;exp&gt;], p[1] is its left child
  &gt;s? // p[1]&gt;s whenever p[1] is &quot;K&quot; since s would start with &quot;@&quot;
      // For the special case s === &quot;K&quot;, p[1] is (void 0) and compare would always be false
  p[2]: // Current node is [&quot;@&quot;, [&quot;@&quot;, &quot;K&quot;, &lt;exp = p[2]&gt;], &lt;exp&gt;]
        // We keep p[2] and drop the right child expression
  N // Otherwise, we keep current expression as is
)().flat( // We flat the expression so we got an array of characters
          // which would be acceptable for string I/O
i) // `i` would equals to length of original string
   // And the expression nested level would always less than `i`
   // So we use `i` here to flatten the array
</code></pre>
<hr />
<h1>JavaScript (ES6), 51 bytes</h1>

<pre class="lang-javascript prettyprint-override"><code>f=s=&gt;s&lt;(s=s.replace(/@(@K)(\1*K)\1*K/,'$2'))?f(s):s
</code></pre>
<p><a href="https://tio.run/##fY7dCgIhEIXve47AMWqXuqysufcVuhHTKGRddqLXN9eG7QcMZHTON3OON/MwZIdrf1918eySV/mQOtAeSFEzuD4Y66BFQC3htF5oOZZ2KeYbIeXRA8ktJRs7isE1IV7Ag9AZ7WY/IuqKXANZryKGVcuR6z/WBXPV9ZApp9yvN37sYYlgM5wmeIy/wA1@dW83jk9P" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<p>The regex used in <a href="https://codegolf.stackexchange.com/a/229296/44718">this Perl answer</a>.</p>
</div>
<div id="pu6" class="pu"><h1><a href="https://github.com/m-ender/retina/wiki/The-Language/a950ad7d925ec9316e3e2fb2cf5d49fd15d23e3d" rel="nofollow noreferrer">Retina 0.8.2</a>, 43 bytes</h1>
<pre><code>+`@@K(((@)|(?&lt;-3&gt;K))*(?(3)$)K){2}(?&lt;-1&gt;)
$1
</code></pre>
<p><a href="https://tio.run/##VYw7EoAwCET7nCMF6FjEtE5CzyW0sLCxcOzUs8d8MGrBsgsPtnlf1imEdiRiACA8wQ@ddYzYgAeLGhmP/kpT41BpEwIr4lRZo5QurmxS4IfIXpSFrXjuxdMHonwsl1QJweS5BPql91ukbg" rel="nofollow noreferrer" title="Retina 0.8.2 – Try It Online">Try it online!</a> Link includes test cases. Explanation: The <code>+</code> simply repeats until the entire expression is normalised. The <code>@@K</code> represents a potential normalisation, but we still need to find <code>a</code> and <code>b</code>. The next portion of the regex achieves this by counting <code>@</code>s and <code>K</code>s, stopping only after an equal number followed by a <code>K</code>. This is matched twice, but the second match <code>b</code> is then is dropped using <code>(?&lt;-1&gt;)</code>, allowing the first match <code>a</code> to be used as the substitution.</p>
<p>Of course this is all blown out of the water when you consider @AndersKaesorg's observation that all you have to do is to normalise depth first for 20 bytes:</p>
<pre><code>+`@(@K)(\1*K)\1*K
$2
</code></pre>
<p><a href="https://tio.run/##K0otycxL/P9fO8FBw8FbUyPGUMtbE0RwqRj9/@/N5eANwmASSEBoKAsiA@J4w1SA2VDSG6oWrhxMQ9gOSIocwJqhOh3gKqDKoIZDOQ4oPIRpQFUA" rel="nofollow noreferrer" title="Retina 0.8.2 – Try It Online">Try it online!</a> Link includes test cases.</p>
</div>
<div id="pu7" class="pu"><h1><a href="https://www.haskell.org/" rel="nofollow noreferrer">Haskell</a>, 137 bytes</h1>

<pre class="lang-hs prettyprint-override"><code>p('K':x)=(K,x)
p(_:x)|(s,z)&lt;-p x,(u,v)&lt;-p z=(s:@u,v)
data M=K|M:@M
f(x:@y)|K&lt;-x=&quot;@K&quot;++f y|K:@z&lt;-x=f z|(u,_)&lt;-p$f x=f$u:@y
f K=&quot;K&quot;
f.fst.p
</code></pre>
<p><a href="https://tio.run/##JYxBCsMgFET3nkJEiBKTA0gE95@cIQjtp6FpkWqKEe9uTTqrmcfwHi4879tWqxcddDpJI0AlSbxY2igiqCynwdOkxK6@V81GBG3PRW4uOjobKLO2M0GRtD1kgWlIhllgfY/0KKBtPgnSXJpkOSUcaQN8b3@CFAwDRqLBEUMcfX259W38Z31Hjrwh7pm9Av@w@gM" rel="nofollow noreferrer" title="Haskell – Try It Online">Try it online!</a></p>
<p>This one actually parses the strings into a tree.  I'm sure this is not the most efficient way to do this but I actually couldn't beat it.  <code>p</code> is our parser, and <code>f</code> performs the actual function.</p>
</div>
<div id="pu8" class="pu"><h1><a href="https://docs.python.org/3/" rel="nofollow noreferrer">Python 3</a>, 190 bytes</h1>

<pre class="lang-python prettyprint-override"><code>lambda x:h(c(g(x)))
g=lambda x:x.pop(0)&gt;&quot;@&quot;and&quot;K&quot;or[g(x),g(x)]
c=lambda x:x==&quot;K&quot;and&quot;K&quot;or(lambda x:x[0][0]==&quot;K&quot;!=x[0]and x[0][1]or x)([*map(c,x)])
h=lambda x:x==&quot;K&quot;and x or&quot;@&quot;+h(x[0])+h(x[1])
</code></pre>
<p><a href="https://tio.run/##bY/LDoMgEEX3fgVlNdOaRtNdExr3fIJ1QTWKiQKhNqFfb8Fnm5RM5nHncAPmPUitLmPN7mMn@kcliLtKKKEBh4hRwzbVnY02kOCNZlSoinKqbR6wOKQiKr9Qxvx6hWDX86TwMW0PLEyeIZOaFtoSh5Afe2GgjL0jRvKPJXFEW/@Ek4RwEaeaFjga26oBauja5wCtMq8B/A9wzObDuQ8@1bmfRb6mDQj9QiwYn9tlyH6m3c1THw" rel="nofollow noreferrer" title="Python 3 – Try It Online">Try it online!</a></p>
<p>Horribly long answer. But, it's the most direct way I could think of at first.</p>
<p>And a horribly scuffed one-liner using weird something-combinators just because this challenge is about combinators:</p>
<h1><a href="https://docs.python.org/3/" rel="nofollow noreferrer">Python 3</a>, 227 bytes</h1>

<pre class="lang-python prettyprint-override"><code>lambda x:(lambda h,c,g:h(h,c(c,g(g,x))))(lambda f,x:x==&quot;K&quot;and&quot;K&quot;or&quot;@&quot;+f(f,x[0])+f(f,x[1]),lambda f,x:x==&quot;K&quot;and&quot;K&quot;or(lambda x:x[0][0]==&quot;K&quot;!=x[0]and x[0][1]or x)([f(f,y)for y in x]),lambda f,x:x.pop(0)&gt;&quot;@&quot;and&quot;K&quot;or[f(f,x),f(f,x)])
</code></pre>
<p><a href="https://tio.run/##dU/RCsMgDPwV51NkMlr2Vujou5/Q9aFbsRU6K50D@/UuVtuxwUIwd8nlVLPYYdJnL8urH9vHrWuJKyChgd95XwyAFRBBzx3D2MaSu8KVJRW01R2e00wrepSA/TprWEJ5w/jfBdjvDCuY6/RQBoYasnbzZpqJY1AHw4VJZAtRmrgf55OZDGTsgq/Y/NcVx3gsDfNmVtqChFE9LShtXhbCl3wVQwhMsdaIY1Nsxy4IOCmSTESYSPXFPm6oegM" rel="nofollow noreferrer" title="Python 3 – Try It Online">Try it online!</a></p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/229295/">229295</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




