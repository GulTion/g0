<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::262329</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>223</td><td>C GCC</td><td>230701T121430Z</td><td><a href="https://codegolf.stackexchange.com/questions/262329/translate-the-keitai-input-method-into-japanese-hiragana/262343#262343">matteo_c</a></td></tr>
<tr d-ix="1"><td>180</td><td>JavaScript Node.js</td><td>230701T092410Z</td><td><a href="https://codegolf.stackexchange.com/questions/262329/translate-the-keitai-input-method-into-japanese-hiragana/262340#262340">Arnauld</a></td></tr>
<tr d-ix="2"><td>132</td><td>Charcoal</td><td>230702T125233Z</td><td><a href="https://codegolf.stackexchange.com/questions/262329/translate-the-keitai-input-method-into-japanese-hiragana/262368#262368">Neil</a></td></tr>
<tr d-ix="3"><td>240</td><td>Raku</td><td>230701T002400Z</td><td><a href="https://codegolf.stackexchange.com/questions/262329/translate-the-keitai-input-method-into-japanese-hiragana/262330#262330">Sean</a></td></tr>
<tr d-ix="4"><td>229</td><td>JavaScript Node.js</td><td>230701T100109Z</td><td><a href="https://codegolf.stackexchange.com/questions/262329/translate-the-keitai-input-method-into-japanese-hiragana/262341#262341">l4m2</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://gcc.gnu.org" rel="nofollow noreferrer">C (GCC)</a>, <s>232</s> <s>228</s> 223 * bytes</h1>
<ul>
<li><em>-2 bytes thanks to <a href="https://codegolf.stackexchange.com/users/76323/l4m2">@l4m2</a></em></li>
<li><em>-(2+4) bytes thanks to <a href="https://codegolf.stackexchange.com/users/112488/c">@c--</a></em></li>
<li><em>-1 bytes thanks to <a href="https://codegolf.stackexchange.com/users/52904/ceilingcat">@ceilingcat</a></em></li>
</ul>
<pre class="lang-c prettyprint-override"><code>f(char**s){for(;**s;){int c=**s-48,n=~-strlen(*s)%(c&amp;7?5:3),a=**++s-42?0:strlen(*s),k='\x06v\xa9'&gt;&gt;2*c&amp;3;s+=a&gt;0;a%=c-4|n-2?k:3;printf(&quot;\xe3%c%c&quot;,(c&amp;8||c&lt;1)+129,&quot;\x91\x82\x8B\x95\x9F\xAA\xAF\xBE\x84\x89&quot;[c]+k*n-(c-4|n-2|a-2?c%7-1?-a:a:1)-(c-4||n&lt;2)-(c+n?-1:1));}}
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=tZbhitNAEMfxi2KfIizkmmwSyCbpNWkuDXegL9EUCctVj2ruaHuSo-1BgopYUdAPIn6wcBZFBfUFfBC_7os4m6QcXFNBVhcmmc5u_7-ZnV3adyt65y6ly-XqdDIw3F_Xrg8Uei8eYTxWp4PjkeKD56vTo2Qi0QB8w3H1JDg3xpPR_cNEgWWyQnfaYatjq3oMKzQN1lih2blcoQ-DZpSauw-jNPaa3a6F6Y7tj7Ug7pp-LAfUcGaJYYXDju2fjAA1UFCUHtoylSnSQd6dzegeUTVieTrMeCRKXQvsAPwW2O0o3d8Hg_fBLYg7YB7q0b42xImhVPqzGBhUbhskNOJO3CFqOTVL9izuakloEIiq_nxebceNHi_8QXyUKKo0bdyc8r2RcNrrS4E0RRbSUQsMzX2pmDnr9QPEsgXLPiNfGiip6ksnpxM-pzSlJv9U1SePowTp0hmE5pu6xeDixfgPBAKangcPTsFgDh_wJoTU4HKWP2PZc5Z9YtkTEa5T4dbYdaFrvFnk5dWksCz4r3kK-UuWL4SqJ2WZ7bJg7pqcbNuFZ1YJwfcRxnhrSrAlP1n2lOWvWPaG5ZDbR8HErGprCly7yMiu7_6i6Ajg34oeA1yWuNFy4TbXqb4XUnW26l6I6JZXDNePGthXsbtdHX3XrZzyABY5XIldBb9g-WO4gCz7UjoiebjlIefPTVL-iGUfBLt1CcDbIat_B_kD5UKQslvTi2-ignUn67uwaJ3qD3HVOtm_24F19HgIUdVvzBvlb-z6r8dv" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>*: you have to encode each char in the hex string as a single byte instead of an escape code; I wasn't able to copy/paste it correctly on ATO.</p>
<p>How to test it: run <code>gcc a.c &amp;&amp; ./a.out | grep -Eva '(\b.+) \1\b'</code>. Outputs each testcase for which the function outputs an incorrect string.</p>
</div>
<div id="pu1" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 180 bytes</h1>
<p>Expects a list of strings, where <code>*</code> sequences are concatenated with digit sequences.</p>
<p>Returns a list of kana.</p>

<pre class="lang-javascript prettyprint-override"><code>a=&gt;a.map(s=&gt;String.fromCharCode(Buffer(&quot;n *4&gt;IN]bh&quot;)[n=+s[0]]+12321+(p=s.lastIndexOf(n),q=s.length+~p,p%=n%8?5:3)*(m=1855**n%79&amp;3)+(n-4?p&amp;&amp;2*!n:q%(m+=p==2)&gt;1?-2:p&gt;1)+(q%m^n%7==1)))
</code></pre>
<p><a href="https://tio.run/##bVFdi9NAFH3vrxgX2sxM0tAkrU27TAouPuyLPvgYIsRu0nZpJ2mSFUEUElTELi6oIIKisIqigvrmkz9m5wf4E@pMPthEeh/uXM6cc@69M8fuXTeeRosw6dLgyNv6ZOsSy1VXbghjYt1KogWdqX4UrA7mbnTAKfDaie97EdyjAPetwxvOnfkesimRY7vnOLKmG7omw5DE6tKNk0N65N276UOKlLWAPDpL5vLDUAnbhLbNyWBsIAxXRDMHA4xpezjqGEiGtNufhJ2Ojq/Q8boNVzIJCdGRpU26@ji0NE5Zt1e3OZ8QDSG03bdbANjAlnRJkQaSowCJpRuWfpWAo1RXeYj7PHaTNH4/GvGkY576IvipaVpJz1j2jKWnLP3C0ic1XR9XmqpLpe3ljqNS/yEXvxT67Ixlm3prEZw8LBqKsifEhpFXvdITY9xw5OP8YelTlr1g6WuWcevPTV8xjF6tNcwNjcvlN/lC3OFNfRQsupQbN7as0Pd1tH@Jn9fwgfjTnVGSvzd@R6xlmrh8bvFNDaCQPGfZY/7yLP1WFDUHs3ggkQty9oilH5ujlhzcJH3aTfqPdd5kXS0n@lHHqs1@NsAK/dVEcc2h5bRUP4iuu9M5hDZwFRCcJMBBgFjgPlh6CYi8GBDgQxepx8GCQklC@2Aa0DhYeuoymEFOUAoWycUTIP39fXbx9hXPEhgD6eLdqdA8QNt/" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<h2>How?</h2>
<h3>Interpreting the input string</h3>
<p>Given the input string <span class="math-container">\$s\$</span>, we compute:</p>
<ul>
<li><span class="math-container">\$p\$</span>: the 0-based position of the last digit in <span class="math-container">\$s\$</span></li>
<li><span class="math-container">\$q\$</span>: the length of <span class="math-container">\$s\$</span>, minus <span class="math-container">\$p\$</span> and minus <span class="math-container">\$1\$</span></li>
</ul>
<h3>Base code point</h3>
<p>We use a lookup Buffer and a fixed offset to get the base code point for the digit <span class="math-container">\$n\$</span>:</p>
<pre class="lang-javascript prettyprint-override"><code>Buffer(&quot;n *4&gt;IN]bh&quot;)[n] + 12321
</code></pre>
<p><a href="https://tio.run/##Fc2xDoIwFIXhnae4IQytBCLoJMKgk4sxcTQkILSIwXtNqV1In72W6Rv@k5x3a9q5U@NXJ0i9cE6SYpPQgFDCtvAcIVuNYw5LALA249vpJ6VQLETY7KvLtX6@Qv7AGmLI8l2eFX7aEc40iXSigTVYRgvaA0SLsZBU3rtWIw6pVPQ5@@sbjaiZ4bbhRWCd@wM" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<h3>Length of the digit cycle</h3>
<p>The length of the digit cycle is <span class="math-container">\$5\$</span>, except when <span class="math-container">\$n=0\$</span> or <span class="math-container">\$n=8\$</span>, in which case it's <span class="math-container">\$3\$</span>:</p>
<pre class="lang-javascript prettyprint-override"><code>n % 8 ? 5 : 3
</code></pre>
<p>We reduce <span class="math-container">\$p\$</span> by the above modulo, which gives the 0-based index in the digit cycle.</p>
<h3>Length of the <code>*</code> cycle</h3>
<p>For the length <span class="math-container">\$m\$</span> of the <code>*</code> cycle, we use the following formula:</p>
<pre class="lang-javascript prettyprint-override"><code>1855 ** n % 79 &amp; 3
</code></pre>
<p>which, with a couple of IEEE-754 approximation errors, gives:</p>
<pre class="lang-javascript prettyprint-override"><code>[ 1, 2, 2, 2, 2, 1, 3, 1, 2, 1 ]
</code></pre>
<p>The 0-based index in the <code>*</code> cycle is <span class="math-container">\$q \bmod m\$</span>.</p>
<h3>Final code point</h3>
<p>The generic formula for the final code point is:</p>
<pre class="lang-javascript prettyprint-override"><code>base_code_point + p * m + (q % m)
</code></pre>
<p>But there are several special cases which are detailed below.</p>
<h3>Case <span class="math-container">\$n=4\$</span>, <span class="math-container">\$p=2\$</span></h3>
<p>For the special case where the digit <span class="math-container">\$4\$</span> is pressed  <span class="math-container">\$3\$</span> times to generate the small kana っ, we need to increment <span class="math-container">\$m\$</span> and to add a correction offset to the final result:</p>
<pre class="lang-javascript prettyprint-override"><code>+ (n - 4 ? ... : q % (m += p == 2) &gt; 1 ? -2 : p &gt; 1)
</code></pre>
<h3>Case <span class="math-container">\$n=0\$</span></h3>
<p>The code points for <span class="math-container">\$n=0\$</span> have a specific offset (<span class="math-container">\$+2\$</span>) when <span class="math-container">\$p&gt;0\$</span>:</p>
<pre class="lang-javascript prettyprint-override"><code>+ (n - 4 ? p &amp;&amp; 2 * !n : ...)
</code></pre>
<h3>Case <span class="math-container">\$n=1\$</span> or <span class="math-container">\$n=8\$</span></h3>
<p>If <span class="math-container">\$n=1\$</span> or <span class="math-container">\$n=8\$</span>, each pair of code points is reversed, leading to the sequence:</p>
<p>$$x+1,x,x+3,x+2,\dots$$</p>
<p>In this case, we add <span class="math-container">\$(q \bmod m)\operatorname{XOR}1\$</span> instead of <span class="math-container">\$q \bmod m\$</span>:</p>
<pre class="lang-javascript prettyprint-override"><code>+ (q % m ^ n % 7 == 1)
</code></pre>
</div>
<div id="pu2" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, 132 bytes</h1>
<pre><code>ＷＳ℅⁺¹²³¹⁵℅§§⪪§⪪”}∧﹪IC↗Ｔ″§×Ｋ_✳Y59G%⸿u-↷*f↨Ｖ±ＩFl⟲⦃⌊CψＲ^4ΦIhGＩT↧Ｐ{$ＱＴⅈZ?≕⌈⟧2EχＰP⊖▷ζＱ§⎇Ｚ∨⁰\`⪪k&gt;+²γ～δïwⅈＶ-⦃ïＢ.｜←⁴Ｇ⭆!±Ｗ⁹✂φβＱ²1”¶Ｉ⌈ι №ι⌈ι№ι*
</code></pre>
<p><a href="https://tio.run/##XU9JV8IwGLzzK@bloEktaotVFDfEDRVBcTcuoVSIhq@1pMK/r30ceE/nMutlwqFKw1iZPJ8MtYnAm5RktmtTTQMuBDqFsLxRrFRoo5R3TDbmnl/xAhfttK9JGV63TepH0zl3E6PtP8emsJhIWlnG4gIEx5KDsiupuolVD34FawHWNyQdNLBVw/YOdvewX5fUusThEY5P0Dw7xfmFpC7a6OAK15LeVQ83t3e4f3jE07OUeHl9kzRAiD4ifEgaGeghvj4lpSDESPDNXDBJTLhoqLHlLTXVo2zEtRBFxDAr4qy4rF38Lecxc5iYoZbnvu@UqlWn5HleKQjmMi//mF8" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Takes input as a list of newline-terminated strings of digits and <code>*</code>s. Explanation:</p>
<pre><code>ＷＳ                                  Loop over each line
               ”...”                Compressed look-up table
              ⪪     ¶               Split on newlines
             §                      Indexed by
                       ι            Current string
                      ⌈             Maximum i.e. first character
                     Ｉ              Cast to integer
            ⪪                       Split on spaces
           §                        Indexed by
                         №          Count of
                            ι       Current string
                           ⌈        Maximum i.e. first character
                          ι         In current string
          §                         Indexed by
                             №      Count of
                               *    Literal string `*`
                              ι     In current string
         ℅                          Take the ASCII code
   ⁺                                Plus
    ¹²³¹⁵                           Literal integer `12315`
  ℅                                 Convert to Unicode
                                    Implicitly print
</code></pre>
<p>The look-up table is adjusted for the 1-indexing of the button value and number of button presses, although the number of <code>*</code>s remains 0-indexed.</p>
</div>
<div id="pu3" class="pu"><h1><a href="https://raku.org/" rel="nofollow noreferrer">Raku</a>, <s>330</s> <s>295</s> <s>248</s> 240 bytes</h1>
<pre><code>*.map:{/(.)(\d)*(_)*/;uniparse 'hiragana letter '~({TR/ksth/gzdb/},{S/h/p/},'small '~*,~*)[flat
^4 Zxx($0 X~~2|3|4|6,6,1|8|{$_*9+$1%5==38},!0)][($2-1)%*]([&lt;wa wo n&gt;,|map((*X~
&lt;a i u e o&gt;),&quot;&quot;,|'kstnhmr'.comb),&lt;ya yu yo&gt;][|^8,9,8][$0][$1%*])}
</code></pre>
<p><a href="https://tio.run/##bU/bUsIwEH3nK1ammKRGegVaBT5CfWCsJROkXMaWMgUGai@/jklpFUfPTHZPTs5udrdBEvbPUQq3Cxid1W7Etw@ZhrsEv82JihlRtcfDZr3lyS4AtFonfMk3HMJgvw8SQCXOXp60j91@pS0/5zOtoNmzttK2gqBdxMNQWFRaqsRbhHzfmtrwejphRYdJWZq5ldt5n/apkTt5pjDVvVOMTm80spyC3ujE97Bi3huko/rYGx45HGPYjGkuZsRYnZStIYc1HCCAeExou01zJCbZrKIEdd/jaEboMOWQHiCNx76XTx3qUsf3FF0cQzQlxXnHU2grDEZjyLzShwUorGjDIk7AQyaiqId8KmkFea9wEQ1xd10RTCaCLSGyYRiXZ5s1T01xY9GrQrfuIiGEwaVWUl0aLKtiel3HGLuuku3M5v9BZbfqfkxa6wkaYn9TMT37H82m8h/HYfUqcmUpsOvVnMtQMv4S2F/lSurXiTX5hwh2/gI" rel="nofollow noreferrer" title="Perl 6 – Try It Online">Try it online!</a></p>
<p>An underscore is used as the single non-digit character.  A sequence of underscores is taken to be appended to the preceding digits rather than being its own element in the input array.</p>
<ul>
<li><code>*.map: { ... }</code> converts each input element into a single Japanese character.</li>
<li><code>/(.)(\d)*(_)*/</code> matches the given pattern against each input element.  The match is assumed to always succeed.  Afterwards, <code>$0</code> is the first digit, <code>$1</code> is a list of succeeding digits, and <code>$2</code> is a list of underscores.  In Raku, lists are treated as numbers equal to their length when used in an arithmetic context, so <code>$1</code> can be interpreted as one less than the number of initial digits, and <code>$2</code> as the number of trailing underscores.</li>
<li><code>[&lt;wa wo n&gt;,|map(...),&lt;ya yo yu&gt;]</code> constructs an array that maps digits to the list of romanized characters in the first &quot;Kana&quot; column given above.  For example, 1 maps to the list <code>&lt;a i u e o&gt;</code>, 2 to the list <code>&lt;ka ki ku ke ko&gt;</code>, 8 to the list <code>&lt;ya yu yo&gt;</code>, etc.  For brevity, the kana groups are generated out of order, so <code>[|^8,9,8]</code> slices the original list into the correct order.  The given digit is used to look up the appropriate list of kana (<code>[$0]</code>), and the number of repetitions of the digit indexes into that list, wrapping around to the front of the list as needed (<code>[$1 % *]</code>).</li>
<li>A list of anonymous transformation functions is consulted.  That's the list <code>({ TR/ksth/gzdb/ }, { S/h/p/ }, 'small ' ~ *, ~*)</code>.  The first function transforms a kana into its dakuten form (by translating &quot;k&quot; to &quot;g&quot;, &quot;s&quot; to &quot;z&quot;, etc), the second one transforms it into its handakuten form (by replacing &quot;h&quot; with &quot;p&quot;), the third one makes the kana small (by prepending &quot;small &quot; to it), and the last one <code>~*</code> is a string-identity function that circles back to the first version of the kana.  Each function except the last is only conditionally included in the list by the following array slice.  For example, if the first digit is 1, only the third and fourth transformations are applicable; if it's 6, all but the third are.  The appropriate function for the number of trailing underscores is called, again wrapping around back to the beginning as needed with <code>[($2 - 1) % *]</code>.</li>
<li>Finally the built-in <code>uniparse</code> function is called to convert the Unicode name of the character to the actual Unicode character, after prepending it with the common prefix &quot;hiragana letter &quot;.</li>
</ul>
</div>
<div id="pu4" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 229 bytes</h1>

<pre class="lang-javascript prettyprint-override"><code>x=&gt;[...x].map(t=&gt;String.fromCharCode(12440+~U(U(X[u=t.split`*`,t[0]],u[0]),u)))
X=['854'];for(M=i=9;i;U=(x,y)=&gt;x[~-y.length%x.length])for(Y=X[i--]=[j=i-7?5:3];j;)for(k of(Z=Y[--j]=[])+(i%7?i&lt;4?M-49?21:213:i-5?1:321:12))Z[k-1]=++M
</code></pre>
<p><a href="https://tio.run/##fVNdi9NAFH3vrxiFJTNpkm3S1H7EaR4WX4TVh2Whu9PAhjZt0@02JU2XLOpCgoq4iwsqiKAorKKooL755I/Z@QH@hDqTJmwii/fhZnLnnDP33GHG9qE97/nuLJCnXt9ZDvAyxG2iKEpoKQf2DAa4vRX47nSoDHzvYGNk@xsMB1VN1yvl4224DTtkgQNlPpu4wZ64JwWkYlnSgmUkLRBCpQ4mQqOmC5Yx8Hy4iV3cNFxjG8NQOkK4HZJj@UiZONNhMFoL04WFOHYHd4gryxYmY@zKdbPWqlrG2Ej29oE3gLt4h8jymAEsVIbuWt10b@rmpqw3TU1taWq15co1U21V2Z@qIbRL9mXVwuXy5rLnTefexFEm3hDe3rp7R5knLt3BEewgxXdmE7vnwPVuvwzNa92@eB3d7/bXhxKbTlj@z0RCbtkgJQAIIIImSEJNsCQg0OiERl8EYEnZVhJ8P4mrQSrbbzZZ0kSWdB7sq6pqCo9p/JRGpzT6TKPHOZ4uZpzslIxbSRSbKf99Qn7B@fEZjU/yR/Ng4PrqQL6scHK1mqwqqaYoigVF1s5vGj2h8XMavaIxk/5U1OXNaJmteiJYvTR/khhiCq/zrYj8lNRxwWVWfZev6pf181ydDVm8OlLwt8LtcFuNhpiOm19TobCiPKPxIzZ5Gn1dLXIKjdWAeF6B44c0@lBsNcWIRdDHq0H/oM6LqBtpR9/ztczZj0Ixq/4sVsWcQskqKeyV3bJ7IwgJsCXgLQJgIYDb4B6YOAHwnTnAYABtpIw9dwoFARkg/6gYQFqhcEI2gfDn19nFm5csC6AFhIu3p5zzAC3/Ag" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<p><code>0</code> is different from unicode-table so hardcoded</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/262329/">262329</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




