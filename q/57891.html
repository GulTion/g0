<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::57891</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>182</td><td>Scala 3</td><td>240421T013830Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/272695#272695">138 Aspe</a></td></tr>
<tr d-ix="1"><td>nan</td><td>Acc!!</td><td>240417T130830Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/272640#272640">Mukundan</a></td></tr>
<tr d-ix="2"><td>nan</td><td>PowerShell Core</td><td>240418T005336Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/272653#272653">Julian</a></td></tr>
<tr d-ix="3"><td>nan</td><td>Python 2</td><td>170718T182836Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/133098#133098">Arnold P</a></td></tr>
<tr d-ix="4"><td>064</td><td>Retina</td><td>170712T193440Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/132174#132174">TwiNight</a></td></tr>
<tr d-ix="5"><td>nan</td><td>Perl 5</td><td>150915T221756Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/58031#58031">LukStorm</a></td></tr>
<tr d-ix="6"><td>nan</td><td>Ruby</td><td>160412T060410Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/77656#77656">Value In</a></td></tr>
<tr d-ix="7"><td>nan</td><td>Python</td><td>150915T141659Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/57979#57979">Taylor L</a></td></tr>
<tr d-ix="8"><td>nan</td><td>JavaScript ES6</td><td>150917T123027Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/58154#58154">edc65</a></td></tr>
<tr d-ix="9"><td>177</td><td>Perl</td><td>150916T104058Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/58070#58070">Toby Spe</a></td></tr>
<tr d-ix="10"><td>nan</td><td>Python 2</td><td>150914T004846Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/57892#57892">Greg Hew</a></td></tr>
<tr d-ix="11"><td>nan</td><td>GNU sed</td><td>150915T175653Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/58007#58007">Toby Spe</a></td></tr>
<tr d-ix="12"><td>nan</td><td>C#</td><td>150914T065539Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/57902#57902">Hand-E-F</a></td></tr>
<tr d-ix="13"><td>294</td><td>Java 326 bytes  10% =</td><td>150914T145025Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/57917#57917">user9023</a></td></tr>
<tr d-ix="14"><td>nan</td><td>Pyth</td><td>150914T083248Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/57904#57904">Jakube</a></td></tr>
<tr d-ix="15"><td>041</td><td>CJam</td><td>150914T035148Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/57897#57897">Dennis</a></td></tr>
<tr d-ix="16"><td>nan</td><td>CJam</td><td>150914T025521Z</td><td><a href="https://codegolf.stackexchange.com/questions/57891/curly-numbers/57896#57896">Reto Kor</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://www.scala-lang.org/" rel="nofollow noreferrer">Scala 3</a>, 182 bytes</h1>
<p>A scala port of <a href="https://codegolf.stackexchange.com/a/57902/110802">@Hand-E-Food's C# answer</a> in Scala.</p>
<p>182 bytes, it can be golfed more.</p>
<hr />
<p>Golfed version. <a href="https://ato.pxeger.com/run?1=PVBNTwIxEI1X_oDXscHQwoKgGz-26SaGE4mGA_FEiCnrLq5ZumRbENL0l3jhohfj1f-iv8Z2d2WavHZeZ17ezNuHjHjGLz6nqCvyV14INPvK5y9xpOCepwL0-1ol3euf76c4gSHmwUQVqVh482AkFOuTOmea91RuqfFKpbmAJVfRs464jGGSL2MsCAtxmmARsjmRSDf1EIszv4OQ5xNjUJzJGCHSQRS1sTj1CS17H1m44QVsWZ_yXpIXMa9VW7TFwm2HDcq6lnFZm_mHLkO3VtuYyv3v0TGAG2BpR8K8WMgAbouC76aV-xkJ4EGkChjoBtjY8AxULNXQyknL3qVSYaQpNcgDpDU19pRPQ2n10I41pq4o0XcwuCrRQd_BzaXFupFSqPVsmFo90mta0Mzs6Ekpcm51wRUgUno7-PpfCHYMsBBWdhaVCSzRSKzWKoCm-_FgvFZVapfuGGIQcVqmUe9nv6_uPw" rel="nofollow noreferrer">Attempt This Online!</a></p>
<pre class="lang-scala prettyprint-override"><code>def C(a:String,b:Int=0):String={a.toIntOption match{case Some(n)=&gt;(if(n&gt;=b)s&quot;{${C(n/4+&quot;&quot;,4)}}&quot;else&quot;&quot;)+&quot;;&quot;*(n%4);case _=&gt;var x=0;a.foreach{case';'=&gt;x+=1;case'}'=&gt;x*=4;case _=&gt;};x+&quot;&quot;}}
</code></pre>
<p>Ungolfed version. <a href="https://ato.pxeger.com/run?1=ZVLBTtwwEJV6zFc8rFY4ZLtdYAXtWlmp2hMSLQfUE0LICV5IlTir2FkJRf4SLlzoJ_XA12B7nWh3SaSRZ9685_HMPP9TOS_56cvLa6uXX7-_ffpfZ39FrvGLFxJdBNyLJRaUz3Ctm0I-jJDNcCE1UkziPmgdlwrwsa4teLXSRS1RcZ0_BgTIuRK4ritBZYx0jhAG1rxE5sAUxRJUYp4ii0E6kiQLav1vmMZWuC9gy0kSYghEacmE7Co2oqrX4t6KEsYYGas2U55DJyN3yRenUxWSnsbxQPRlJElPjrZL_11LsVd3A-n6MET4eFk3gm89emAfskNHlkhSHH8ATQCPUkz3wbudS81wkkMXoh4wURhYZadHefOgZvjZNPzpZpN4ayf2RxZ6mJdrlBZKL-xFykYvC6Up6RgzZGQH0DFjf380rok-5qLGhAxvp84cn3vrzMSZH2fWBiJjCHr2M0E971rWsNI8sQMvcmJ14RLIZh5DXX1TqYu4ZqzsW3QpqSIXctXqGT47ZISrVm_cbuFzY0P8bE1kNusdtrzf9nc" rel="nofollow noreferrer">Attempt This Online!</a></p>
<pre class="lang-scala prettyprint-override"><code>object Main {
  def C(a: String, b: Int = 0): String = {
    a.toIntOption match {
      case Some(n) =&gt; 
        val base = if (n &gt;= b) &quot;{&quot;++C((n / 4).toString, 4).toString++&quot;}&quot; else &quot;&quot; 
        val removed = &quot;;;;&quot;.substring(0, (n % 4).min(3))
        base ++ removed

      case None =&gt; 
        var n = 0
        a.foreach {
          case ';' =&gt; n += 1
          case '}' =&gt; n *= 4
          case _ =&gt; 
        }
        n.toString
    }
  }

  def main(args: Array[String]): Unit = {
    val testCases = List(&quot;{;;}&quot;, &quot;{{;};};&quot;, &quot;{};;;&quot;, &quot;{{{{;}}};}&quot;, &quot;{}&quot;, &quot;4&quot;, &quot;17&quot;, &quot;1&quot;, &quot;0&quot;, &quot;96&quot;,  &quot;{};;;;; &quot;, &quot;{{;;;;};;}&quot;, &quot;c{u;r;l}y;!&quot;, &quot;42{;} ;;;;&quot;)
    testCases.foreach(test =&gt; println(s&quot;Input: $test, Output: ${C(test)}&quot;))
  }
}
</code></pre>
</div>
<div id="pu1" class="pu"><h1><em><a href="https://github.com/dloscutoff/Esolangs/tree/master/Acc!!" rel="nofollow noreferrer">Acc!!</a></em>, <sup><s>410</s> ... <s>318.6</s></sup> 315.9 (351 bytes - 10%)</h1>
<pre class="lang-py prettyprint-override"><code>Count y while _%144-10 {
Count z while _%48/10 {
1
Count i while _%250 {
(_-_%250)*4^0^(_%125)+250*0^((_-59)%250)+N
}
_/250
Count j while 1 {
Count k while 10/(_/10^j+1) {
Write _/10^(j-k)%10+48
}
}
}
(_/144*10+_%48)*144+N
}
_/144
Count i while 1 {
Count j while 0^(_/4^i/4)*i {
Count k while _/4^(i-j)%4-k {
Write 59
}
Write 125+0/(i-j)
}
Write 123
}
</code></pre>
<p><a href="https://tio.run/##ZU/LqsIwFNz3K7op5EFIo6dQydK9W3ct9XG5aUXBB6Il317PiW28XEkCc2YOM5Nmu91shmF5uh2v6SO9/7rDPq0zA6BMnvbJW3hGAUodeDMqLiqzgnhWqwC5gCqvGDrNCi6REDihWCx4kOUq8UmtEY5G7WhkYmg3MblmNaZWrTQc1fXZXTGQGNaqjmcml1CiHR3aBBBIUVcucBijEP3r/Imawqmxhspp4MJ9FSGJOdXyDFQXixQLtH9D/KvEsrTyh5snfhiay@6HXh9BbxGE6631ze4SaOvttGFf" rel="nofollow noreferrer" title="Acc!! â€“ Try It Online">Try it online!</a></p>
<p><a href="https://tio.run/##ZY9PC4JAEMXvfgovC/uHZVwbN/fc3Ws3l5Sg1SgIIyj87DaWWhR7GX7z3ry3u7quqmEoos35eurie3w7hOM@9pC5@DHBMEOWEuNee2YwERJL7tkarFCeZYCSoCqiPvJA0@RtJq9ZrrUzSYCTMikbZQRtt5fQjcFEeKNbwUyiMKdz4/st4ixg/ioDzkpSeoa5kM5OBZz9sXzy50YU4wHLAChk@Gs3rnjQjWCo26Vd5uj6ezRppugHo@SLraJ@GPAJ" rel="nofollow noreferrer">Shorter solution</a> that does not qualify for the bonus</p>
<h3>Commented version</h3>
<pre class="lang-py prettyprint-override"><code># Format of accumulator:
#   when reading curly number:    value*250 + next_char
#   when reading decimal number:  value*144 + next_char
#   after reading input:          value

Count y while _%144-10 {  # while next_char is not newline
  Count z while _%48/10 {  # if next_char is not a digit (has a few false negatives but matches '{' so we don't mind)
    1  # value = 0, next_char = 1

    # Read Curly number
    Count i while _%250 {  # while next_char is not EOF (0)
      # 250*0^((_-59)%250)+  when next_char is ';'  -  add 1 to value
      # 4^0^(_%125)*         when next_char is '}'  -  multiply value by 4
      # (_-_%250)+N          update next_char
      250*0^((_-59)%250)+4^0^(_%125)*(_-_%250)+N
    }

    _/250  # Convert accumulator to store only value

    # Output as Decimal
    Count j while 1 {
      Count k while 10/(_/10^j+1) {
        Write _/10^(j-k)%10+48
        # Exit with error when above becomes float due to negative exponents
      }
    }
  }

  (_/144*10+_%48)*144+N  # Read decimal digit
}

_/144  # Convert accumulator to store only value

# Output as Curly number
Count i while 1 {
  Count j while 0^(_/4^i/4)*i {
    Count k while _/4^(i-j)%4-k {
      Write 59
    }
    Write 125+0/(i-j)
  }
  Write 123
}
</code></pre>
</div>
<div id="pu2" class="pu"><h1><a href="https://github.com/PowerShell/PowerShell" rel="nofollow noreferrer">PowerShell Core</a>, 145 bytes - 10% = 130.5</h1>

<pre class="lang-powershell prettyprint-override"><code>param($n)try{for(;$n){if($n%4){$s=&quot;;$s&quot;
$n-=1}else{$s=&quot;}$s&quot;
$c++
$n/=4}}((&quot;{&quot;*$c+$s),&quot;{}$s&quot;)[!$c]}catch{switch($n|% t*y){'}'{$a*=4}`;{$a+=1}}+$a}
</code></pre>
<p><a href="https://tio.run/##ZY9dT4MwFIbv@RWVdA4GxH1lahqSJcu81TjvlkWxlmyGjUlZ5tKd346nhUmN5YL2ed8@B/b5URRyLbIs4nkhKprGqtonRbL16M4vi5NK88JjuFebFFFn7CsqY5dR6Tp0F8UDEJkUhoFhPAgwuInHAJ7nKreHhEo/dJXO/eUV5SvgScnXSh43@ELruUPK3slXXegqmvTw7hvDTYB2CGgCFTjO1HMIrnCKUsbADcmd3xLFAB@Ew4FFgTHNRnZRVwGMYDjp22Uk1nmMR5wEbosGt4ZpAbPwyFAzq4XDC7TvN8xC/RpZ5H5SD9F/hIMw8cmZPOTFPOHr6PH9U/CSKFOnpZDlLJEiJFR87zEQHyQm9LVOCyEPWYngmqZt12TLp8XsIMt8W/tW01qo1@LAuZBSexpBJL5a/2/vpfHp4h@3XnPra/7dfL58VzPABOBA9QM" rel="nofollow noreferrer" title="PowerShell Core â€“ Try It Online">Try it online!</a></p>
</div>
<div id="pu3" class="pu"><h1><a href="https://docs.python.org/2/" rel="nofollow noreferrer">Python 2</a>, 157 bytes -10% = 141.3</h1>



<pre class="lang-python prettyprint-override"><code>lambda n:'{}'*(int(n)&lt;4)+g(int(n))if n.isdigit()else sum((v==';')*4**n.count('}',i)for i,v in enumerate(n))
g=lambda n:'{%s}'%g(n/4)+';'*(n%4)if n&gt;3else';'*n
</code></pre>

<p><a href="https://tio.run/##dZDtasMgGIV/L1fhCkFNQ9d8sVHnbiTrj6zVTDCmmKRQgteemSYw7Zgg@ry@5xz1cuu/W5VOnH5Osmq@zhVQBzgaGCGheqTwe4639brHggO1E91Z1KJHmMmOgW5oELpSCgnEUR5FandqB9sNDYwF5q0GIr4CoQBTQ8N01bPZKKipkxZ2BoY1Ui82y/pESIX5PesjmzPmkpokLY/B3W9205WqGUr2e3wIniTYUlBy1PUaCYz/a7to@wx7HSBLcYwBR/OKAwhhsBxxtEk2@BdSFzIXchfePE3x6mPhYpJmeeHZjoYQjwkxHttBjB3koUpsozMfNYtuOTTrXPgx/Y@YrCq3ehoHook0N/Ls/UNqQ8BiYf9x@gE" rel="nofollow noreferrer" title="Python 2 â€“ Try It Online">Try it online!</a></p>

<p>A more golfed Python 2 answer that handles the bonus cases.  Didn't want to necro dead posts with this as a comment, so here it is.</p>

<p>It works from the inside in on curly numbers, adding 4^(the number of end curly brackets left in the string) to the sum for each semicolon found.  If the string is a number, then it recursively creates the curly number in the same way as the grammar provided.</p>
</div>
<div id="pu4" class="pu"><h1><a href="https://github.com/m-ender/retina" rel="nofollow noreferrer">Retina</a>, <s>69</s> 64 bytes</h1>

<pre><code>+`{(;*)}
$1$1$1$1
^\d+|^(;*)
$*;$.1
+`(;+)\1\1\1
{$1}
^;|^$
{}$&amp;
</code></pre>

<p><a href="https://tio.run/##JYlBCoNAEATv/Y6JrC6IA0EJ/QA/IcsKevCSQ8htnLdvdgkFBV39Ob/Xey@PNWSUmC1w6B2if5C2I96pRchAGRUxB8Z@0wZM1JF4J4G5dKUY6TCjV2oiq61t93Y4ntAFigmv@Qc" rel="nofollow noreferrer" title="Retina â€“ Try It Online">Try Test Suite</a></p>

<hr>

<h1>Explanation</h1>

<pre><code>+`{(;*)}
$1$1$1$1
</code></pre>

<p>Decompose the innermost braces to just <code>;</code>s. Loop until no more braces.</p>

<pre><code>^\d+|^(;*)
$*;$.1
</code></pre>

<p>Convert between decimal and unary <code>;</code></p>

<pre><code>+`(;+)\1\1\1
{$1}
</code></pre>

<p>Find the longest run of <code>;</code> that is a multiple of 4 and nest into braces, loop until no more runs of 4+ exist.</p>

<pre><code>^;|^$
{}$&amp;
</code></pre>

<p>If the resulting curly number begins with <code>;</code> or is empty string, add <code>{}</code> in front.</p>
</div>
<div id="pu5" class="pu"><h1>Perl 5, 154 (<s>185</s> 170 Bytes - 10% + 1 Penalty)</h1>
<pre><code>$e=$/;if($_=~/{/){s/[^{};]//g;s/;/+1/g;s/{/+4*(/g;s/}/+0)/g;$b=eval}else{$r=$_;$b=$r&lt;4?&quot;{}&quot;:&quot;&quot;;while($r&gt;0){if($r%4&gt;0){$r--;$e=&quot;;$e&quot;}else{$b.=&quot;{&quot;;$e=&quot;}$e&quot;;$r/=4}}}$_=$b.$e
</code></pre>
<p>Regex &amp; eval resolve the curlies.<br />
The generation of the curlies is done differently.</p>
<h3>Test</h3>
<p>Test file contains also the bonus cases</p>
<pre><code>$ cat curlytestcases.txt
{}
{};
{};;
{};;;
{;;}
{{;};};
{{{{;}}};}
0
1
2
3
4
17
96
{};;;;;
42{;} ;;;;
c{u;r;l}y;!
{{;;;;};;}

$ cat curlytestcases.txt |perl -p curlies.pl
0
1
2
3
8
21
260
{}
{};
{};;
{};;;
{;}
{{;}};
{{{;};;}}
5
8
9
72
</code></pre>
</div>
<div id="pu6" class="pu"><h1>Ruby, <s>126.9</s> 129.6 (144 - 10%)</h1>
<p>Uses recursion to convert decimal into curly form. Removing the check for ignoring characters outside of <code>/[;{}]/</code> increases the score by <code>0.4</code> at the moment.</p>
<pre><code>f=-&gt;s{s=~/^\d+$/?(n=s.to_i
&quot;{#{n&lt;1?'':f[(n/4).to_s].gsub('{}','')}}#{?;*(n%4)}&quot;):eval(s.tr(&quot;^{;}&quot;,&quot;&quot;).gsub(/./){|c|c&lt;?A?&quot;+1&quot;:c&gt;?|?&quot;)*4&quot;:&quot;+(0&quot;})}
</code></pre>
</div>
<div id="pu7" class="pu"><h1>Python 266 bytes - 10% = <s>1268.1</s> <s>326.7</s> 239.4 bytes</h1>

<p>Boy am I not a code golfer yet =/, but that 10% helped <em>me</em> out a <em>lot</em> when my score was still over 1000! </p>

<p>I have a fully fleshed out (and verbose) version of this code <a href="http://code.runnable.com/VfcrxGGPpBxlHJzA/curly-number-parser-for-python-and-puzzle" rel="nofollow" title="Curly Number Demo (verbose)">here.</a> It will recognize the validity of curly numbers, and provide a looped interface to enter numbers for testing.</p>

<p>(Comments just for clarification)</p>

<p><a href="http://code.runnable.com/Vfg5e8EQ1X5ySF95/curly-number-parser-code-golf-for-python-and-puzzle" rel="nofollow" title="Curly Number Demo (golfed)">See this code in action</a></p>

<pre><code>def c(t):                           # curly to int function
 v=0                                #  int value of input
 for a in t:                        #  for each character of input
  if a==';':v+=1                    #   if you find a ';', add one to total
  if a=='}':v*=4                    #   if you find a '}', multiply total by 4
 print v                            #  print value
def i(t):                           # int to curly function
 v=int(t);f,b="{}"if v&lt;4 else"",""  #  get integer value. initialize front (f) and back (b) strings
 while 1:                           #  loop until stopped
  r,v=v%4,int(v/4)                  #   get remainder of v/4 and int value of v/4
  if r&gt;0:b=';'*r+b                  #   if remainder exists, prepend that many ';' to back string
  if v&gt;0:f=f+'{';b='}'+b            #   if remaining value &gt; 4, append '{' to front and prepend '}' to back
  if v&lt;4:b=';'*v+b;break            #   if remaining value &lt; 4, prepend that many ';' to back string and break
 print f+b                          #  print result
t=raw_input()                       # get raw input
try:int(t);i(t)                     # use try block to determine which function to call
except:c(t)                         # 
</code></pre>

<p>Thanks to Erik Konstantopoulos for a major byte reduction! You could say... he really took a... byte... out of my code... *self five*</p>
</div>
<div id="pu8" class="pu"><h1>JavaScript (ES6), 95 (105-10%)</h1>

<pre class="lang-js prettyprint-override"><code>f=(n,r='{}')=&gt;-1-n?(n&gt;3?'{'+f(n&gt;&gt;2,'')+'}':r)+';'.repeat(n&amp;3):n.replace(/[;}]/g,c=&gt;c&gt;';'?n*=4:++n,n=0)&amp;&amp;n
</code></pre>

<p>Test running the snippet below</p>

<p><div class="snippet" data-lang="js" data-hide="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js prettyprint-override"><code>f=(n,r='{}')=&gt;-1-n?(n&gt;3?'{'+f(n&gt;&gt;2,'')+'}':r)+';'.repeat(n&amp;3)
:n.replace(/[;}]/g,c=&gt;c&gt;';'?n*=4:++n,n=0)&amp;&amp;n

// Test
function out(x) { O.innerHTML=x+'\n'+O.innerHTML; }

function go() { out(I.value + ' --&gt; ' + f(I.value)) }

;[ 
  ['{;;}', 8]
, ['{{;};};', 21 ]
, ['{};;;', 3 ]
, ['{{{{;}}};}', 260 ]
, ['{}', 0 ]
, [ 4, '{;}' ]
, [ 17, '{{;}};' ]
, [ 1,'{};' ]
, [ 0, '{}' ]
, [ 96, '{{{;};;}}' ]
, ['{};;;;;', 5 ]
, ['{{;;;;};;}' , 72 ]
, ['c{u;r;l}y;!', 9 ]
, ['42{;} ;;;;', 8 ]
].forEach(t =&gt; {
  r=f(t[0])
  k=t[1]
  out('Test ' +(r==k?'OK':'Fail')+'\nInput:  '+t[0]+'\nResult: '+r+'\nCheck:  '+k+'\n')
})</code></pre>
<pre class="snippet-code-html lang-html prettyprint-override"><code>Custom test &lt;input id=I&gt;&lt;button onclick='go()'&gt;-&gt;&lt;/button&gt;
&lt;pre id=O&gt;&lt;/pre&gt;</code></pre>
</div>
</div>

</p>
</div>
<div id="pu9" class="pu"><h1>Perl, <strike>183</strike> 177</h1>
<p>This might not be the shortest Perl answer, but I think it's interesting enough to post (input in <code>$_</code>, output as return value):</p>

<p><code>sub f{if(/}/){s/[{}]/00/g;oct'0b'.s/00(;+)/sprintf'%02b',length$1/ger}else{$_=sprintf'%064b',$_;s/../oct&quot;0b$&amp;&quot;/ge;s/^0+(?!$)//;$_='{'x length.$_;s/\d/'}'.';'x$&amp;/ge;s/\Q{{}/{/r}}</code></p>
<p>We observe that Curly is simply quaternary (base-4) notation.  We're slightly hampered by Perl's lack of native support for quaternary, but luckily, each quaternit is two bits in binary, and we can read and write binary.  So we have the following:</p>
<ol>
<li>Curly to decimal: convert each Curly digit to 2 binary digits, concatenate and convert to decimal</li>
<li>Decimal to Curly: print the number in binary (forcing an even number of digits), then convert each bit-pair to Curly.</li>
</ol>
<h3>Expanded version</h3>
<pre class="lang-perl prettyprint-override"><code>sub f
{
    if (/}/) {
        s/[{}]/00/g;     # digits are now 00 00; 00;; 00;;;
                         # and opening braces become harmless leading zeros
        s/00(;+)/sprintf'%02b',length $1/ge;
                         # convert semicolons to binary, leaving zeros alone
        oct &quot;0b$_&quot;       # now to decimal
    } else {
        $_=sprintf'%064b',$_;   # decimal to binary
        s/../oct&quot;0b$&amp;&quot;/ge;      # bit-pair to quaternit
        s/^0+(?!$)//;           #/remove leading zeros
        $_='{'x length.$_;      # prefix enough opening braces
        s/\d/'}'.';'x$&amp;/ge;     #/digit to semicolons
        s/{{}/{/r               # first empty brace, unless $_ &lt;= {};;;
    }
}
</code></pre>
</div>
<div id="pu10" class="pu"><h1>Python 2, 167 bytes - 10% = 150.3</h1>

<pre><code>d=lambda x:("{"+d(x//4)+"}"if x&gt;3 else"")+";"*(x%4)
c=lambda n:"{}"*(int(n)&lt;4)+d(int(n))if n.isdigit()else reduce(lambda x,y:x*4+y,[x.count(";")for x in n.split("}")])
</code></pre>

<p>In this implementation, <code>c</code> is the function that satisfies the requirements. It returns a string if given an nonnegative integer as input, or an integer if given a curly number as input.</p>
</div>
<div id="pu11" class="pu"><h1>GNU sed, <strike>330</strike> 326 - 10% = 293.4</h1>
<p>(I added one for the use of <code>-r</code> before claiming the bonus 10%; I hope that's correct)</p>
<pre><code>/;/{
s/[^};]//g
:c
s/(;*)\}/\1\1\1\1/
tc
:d
/;/{
s/;;;;;/v/g
s/vv/x/g
/[;v]/!s/\b/0/2
s/;;/b/g
s/bb/4/
s/b;/3/
s/v;/6/
s/vb/7/
s/v3/8/
s/v4/9/
y/;bvx/125;/
td
}
n
}
:u
s/\b9/;8/
s/\b8/;7/
s/\b7/;6/
s/\b6/;5/
s/\b5/;4/
s/\b4/;3/
s/\b3/;2/
s/\b2/;1/
s/\b1/;0/
s/\b0//
/[^;]/s/;/&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;/g
tu
:v
s/;;;;/v/g
s/v+/{&amp;}/
y/v/;/
tv
</code></pre>
<p>The full version shows that most of the above is conversion between decimal and unary:</p>
<pre><code>#!/bin/sed -rf

/;/{

# Delete non-Curly characters
s/[^};]//g

# Curly to unary
:c
s/(;*)\}/\1\1\1\1/
tc

# unary to decimal
:d
/;/{
s/;;;;;/v/g
s/vv/x/g
/[;v]/!s/\b/0/2
s/;;/b/g
s/bb/4/
s/b;/3/
s/v;/6/
s/vb/7/
s/v3/8/
s/v4/9/
y/;bvx/125;/
td
}

# done
n

}


# Decimal to unary
:u
s/\b9/;8/
s/\b8/;7/
s/\b7/;6/
s/\b6/;5/
s/\b5/;4/
s/\b4/;3/
s/\b3/;2/
s/\b2/;1/
s/\b1/;0/
s/\b0//
/[^;]/s/;/&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;/g
tu

# Unary to Curly
:v
s/;;;;/v/g
s/v+/{&amp;}/
y/v/;/
tv
</code></pre>
</div>
<div id="pu12" class="pu"><h1>C#, 173 - 10% = 155.7 <s>171.0, 177.3</s></h1>

<p>This does no validation and only looks for <code>;</code> and <code>}</code> characters.  It assumes all <code>{</code> characters come before any <code>;</code> characters.  The hardest thing I found was to not insert a <code>{}</code> in the middle of a Curly number.</p>

<p>Line breaks and indents for clarity:</p>

<pre><code>string C(string a,int b=0){
    int n;
    if(int.TryParse(a,out n))
        a=(n&gt;=b?"{"+C(""+n/4,4)+"}":"")+";;;".Remove(n%4);
    else
        foreach(int c in a)
            a=""+(c==59?++n:c==125?n*=4:n);
    return a;
}
</code></pre>
</div>
<div id="pu13" class="pu"><h1>Java 326 bytes - 10% = 294 bytes</h1>
<p>It is complete program written in java,</p>
<pre><code>public class a{static String c(long a,int v){if(a==0)return v==0?&quot;{}&quot;:&quot;&quot;;String x=&quot;&quot;;for(int i=0;i&lt;a%4;i++)x+=&quot;;&quot;;return &quot;{&quot;+c(a/4,v+1)+&quot;}&quot;+x;}public static void main(String[]c){try{System.out.println(c(Long.parseLong(c[0]),0));}catch(Exception e){System.out.println(c[0].chars().reduce(0,(a,b)-&gt;b==';'?a+1:b=='}'?a*4:a));}}}
</code></pre>
<p>I'm sure it can be much shorter but i cant have much time now to optimize it</p>
</div>
<div id="pu14" class="pu"><h1>Pyth, <s>35</s> 32 bytes - 10% = 28.8</h1>

<pre><code>.x.U+jb`HZ*R\;.[Z2jsz4i/R\;cz\}4
</code></pre>

<p>Try it online: <a href="http://pyth.herokuapp.com/?code=.x%2B*%5C%7BtlK.[Z2jvz4j%5C%7D*R%5C%3BKi%2FR%5C%3Bcz%5C%7D4&amp;input=%7B%7B%3B%7D%3B%7D%3B&amp;test_suite_input=%7B%3B%3B%7D%0A%7B%7B%3B%7D%3B%7D%3B%0A%7B%7D%3B%3B%3B%0A%7B%7B%7B%7B%3B%7D%7D%7D%3B%7D%0A%7B%7D%0A4%0A17%0A1%0A0%0A96%0A%7B%7D%3B%3B%3B%3B%3B%0A%7B%7B%3B%3B%3B%3B%7D%3B%3B%7D%0Ac%7Bu%3Br%3Bl%7Dy%3B!%0A42%7B%3B%7D+%3B%3B%3B%3B&amp;debug=0">Demonstration</a> or <a href="http://pyth.herokuapp.com/?code=.x%2B*%5C%7BtlK.[Z2jvz4j%5C%7D*R%5C%3BKi%2FR%5C%3Bcz%5C%7D4&amp;input=%7B%7B%3B%7D%3B%7D%3B&amp;test_suite=1&amp;test_suite_input=%7B%3B%3B%7D%0A%7B%7B%3B%7D%3B%7D%3B%0A%7B%7D%3B%3B%3B%0A%7B%7B%7B%7B%3B%7D%7D%7D%3B%7D%0A%7B%7D%0A4%0A17%0A1%0A0%0A96%0A%7B%7D%3B%3B%3B%3B%3B%0A%7B%7B%3B%3B%3B%3B%7D%3B%3B%7D%0Ac%7Bu%3Br%3Bl%7Dy%3B!%0A42%7B%3B%7D+%3B%3B%3B%3B&amp;debug=0">Test Suite</a></p>

<p>edit: As it turned out, I accidentally can also handle improper Curly Numbers. Wasn't planned at all. ;-)</p>

<h3>Explanation:</h3>

<p>There are two expressions in the code. The first one converts a number into a Curly Number, and the second one converts a Curly Number into a regular number. <code>.x</code> handles, which expression gets printed. It will try to print the first expression. If there are any non-digits in the input, the first expression fails (via Exception). <code>.x</code> catches the Exception and prints the second one. </p>

<pre><code>.U+jb`HZ*R\;.[Z2jsz4   # number to Curly Number
                 sz    read the input and converts it to an int
                j  4   convert to base 4
            .[Z2       pad zeros on the left, until length is &gt;= 2
        *R\;           convert each digit to ";"s
                       lets call this list of ";"s Y
.U                     reduce this list, start with b=Y[0], 
                       Z iterates over Y[1], Y[2], ..., 
                       update b in each step with:
   jb`H                   put b into curly brackets
  +    Z                  and append Z

i/R\;cz\}4             # Curly Number to regular number
     cz\}              split the input by "}"
 /R\;                  count the ";"s in each string
i        4             convert this list from base 4 to base 10
</code></pre>
</div>
<div id="pu15" class="pu"><h1>CJam, <s>51</s> <s>47</s> <s>44</s> 41 bytes</h1>

<pre><code>r_'{-_@={i4bYUe[';f*{{}s@*\+}*}{'}/:,4b}?
</code></pre>

<p>Try it online: <a href="http://cjam.aditsu.net/#code=r_&#39;%7B-_%40%3D%7Bi4bYUe%5B&#39;%3Bf*%7B%7B%7Ds%40*%5C%2B%7D*%7D%7B&#39;%7D%2F%3A%2C4b%7D%3F&amp;input=96">sample run</a> | <a href="http://cjam.aditsu.net/#code=qN%2F%7BS%2F0%3D%0A%20%20%20%20_&#39;%7B-_%40%3D%7Bi4bYUe%5B&#39;%3Bf*%7B%7B%7Ds%40*%5C%2B%7D*%7D%7B&#39;%7D%2F%3A%2C4b%7D%3F%0AN%7D%2F&amp;input=%7B%3B%3B%7D%20%20%20%20%20%20%20%208%0A%7B%7B%3B%7D%3B%7D%3B%20%20%20%20%2021%0A%7B%7D%3B%3B%3B%20%20%20%20%20%20%203%0A%7B%7B%7B%7B%3B%7D%7D%7D%3B%7D%20%20260%0A%7B%7D%20%20%20%20%20%20%20%20%20%200%0A4%20%20%20%20%20%20%20%20%20%20%20%7B%3B%7D%0A17%20%20%20%20%20%20%20%20%20%20%7B%7B%3B%7D%7D%3B%0A1%20%20%20%20%20%20%20%20%20%20%20%7B%7D%3B%0A0%20%20%20%20%20%20%20%20%20%20%20%7B%7D%0A96%20%20%20%20%20%20%20%20%20%20%7B%7B%7B%3B%7D%3B%3B%7D%7D">test suite</a></p>

<h3>How it works</h3>

<pre><code>r        e# Read a token from STDIN.
_'{-     e# Remove all left curly brackets from a copy of the token.
_@       e# Copy the modified token and rotate the original on top of it.
=        e# Check for equality.
{        e# If the strings were equal:
  i4b    e#   Convert to integer, then to base 4.
  YUe[   e#   Left-pad the resulting array with zeroes to a length of 2.
  ';f*   e#   Replace each digit with that many semicolons.
  {      e#   For each string of semicolons but the first:
    {}s  e#     Push the string "{}".
    @    e#     Rotate the first string or the result of the previous 
         e#     iteration on top of the stack.
    *    e#     Join, i.e., surround the string with curly brackets.
    \+   e#     Append the current string of semicolons to the result.
  }*     e#
}{       e# Else:
  '}/    e#   Split the modified input at right curly brackets.
  :,     e#   Replace each run of 0 to 3 semicolons by its length.
  4b     e#   Convert from base 4 to integer.
}?       e#
</code></pre>
</div>
<div id="pu16" class="pu"><h1>CJam, <s>87 bytes</s> 80.1 score (89 bytes - 10% bonus)</h1>

<p>Update version that qualifies for the bonus while growing by 2 bytes:</p>

<pre><code>l_'{#){VX@{";{}"#)" _@+\ 4* 4/"S/=~}/;}{i_4&lt;{"{}"\';*}{{4md\_{F'{\+'}+}{;L}?\';*+}:F~}?}?
</code></pre>

<p><a href="http://cjam.aditsu.net/#code=l_&#39;%7B%23)%7BVX%40%7B%22%3B%7B%7D%22%23)%22%20_%40%2B%5C%204*%204%2F%22S%2F%3D~%7D%2F%3B%7D%7Bi_4%3C%7B%22%7B%7D%22%5C&#39;%3B*%7D%7B%7B4md%5C_%7BF&#39;%7B%5C%2B&#39;%7D%2B%7D%7B%3BL%7D%3F%5C&#39;%3B*%2B%7D%3AF~%7D%3F%7D%3F&amp;input=%7B%7B%7B%7B%3B%7D%7D%7D%3B%7D" rel="nofollow">Try it online</a></p>

<p>First time I used recursion in CJam! The whole thing may look kind of lengthy, but the two completely separate conversions add up.</p>

<p>I used a completely separate case for converting numbers smaller than 4 to Curly. It's probably possible to avoid that, but folding the special case handling into the recursive function wouldn't be entirely trivial. And adding the extra <code>{}</code> as a post-processing step didn't really look any better, even though I should try again if it might be slightly shorter.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/57891/">57891</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




