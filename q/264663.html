<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::264663</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>nan</td><td></td><td>230827T124532Z</td><td><a href="https://codegolf.stackexchange.com/questions/264663/half-even-rounding/264664#264664">noodle m</a></td></tr>
<tr d-ix="1"><td>nan</td><td>The nearesteven rounding mode</td><td>230830T025458Z</td><td><a href="https://codegolf.stackexchange.com/questions/264663/half-even-rounding/264751#264751">Peter Co</a></td></tr>
<tr d-ix="2"><td>030</td><td>JavaScript ES6</td><td>230827T131628Z</td><td><a href="https://codegolf.stackexchange.com/questions/264663/half-even-rounding/264667#264667">Arnauld</a></td></tr>
<tr d-ix="3"><td>023</td><td>R</td><td>230828T083820Z</td><td><a href="https://codegolf.stackexchange.com/questions/264663/half-even-rounding/264694#264694">Dominic </a></td></tr>
<tr d-ix="4"><td>016</td><td>K ngn/k</td><td>230828T092311Z</td><td><a href="https://codegolf.stackexchange.com/questions/264663/half-even-rounding/264697#264697">Bubbler</a></td></tr>
<tr d-ix="5"><td>nan</td><td>K ngn/k</td><td>230828T041626Z</td><td><a href="https://codegolf.stackexchange.com/questions/264663/half-even-rounding/264688#264688">doug</a></td></tr>
<tr d-ix="6"><td>007</td><td>J</td><td>230828T012525Z</td><td><a href="https://codegolf.stackexchange.com/questions/264663/half-even-rounding/264686#264686">Bubbler</a></td></tr>
<tr d-ix="7"><td>021</td><td>J</td><td>230827T230036Z</td><td><a href="https://codegolf.stackexchange.com/questions/264663/half-even-rounding/264684#264684">Jonah</a></td></tr>
<tr d-ix="8"><td>057</td><td>R</td><td>230827T195439Z</td><td><a href="https://codegolf.stackexchange.com/questions/264663/half-even-rounding/264683#264683">pajonk</a></td></tr>
<tr d-ix="9"><td>021</td><td>Charcoal</td><td>230827T184212Z</td><td><a href="https://codegolf.stackexchange.com/questions/264663/half-even-rounding/264681#264681">Neil</a></td></tr>
<tr d-ix="10"><td>009</td><td>Jelly</td><td>230827T172214Z</td><td><a href="https://codegolf.stackexchange.com/questions/264663/half-even-rounding/264678#264678">Jonathan</a></td></tr>
<tr d-ix="11"><td>061</td><td>Retina 0.8.2</td><td>230827T133328Z</td><td><a href="https://codegolf.stackexchange.com/questions/264663/half-even-rounding/264668#264668">Neil</a></td></tr>
</table>
<div id="pu0" class="pu"><h3>Builtins in various languages</h3>
<h1><a href="https://github.com/Adriandmen/05AB1E/wiki/Commands/2649a799300cbf3770e2db37ce177d4a19035a25" rel="nofollow noreferrer">05AB1E (legacy)</a>, 1 <a href="https://github.com/Adriandmen/05AB1E/wiki/Codepage" rel="nofollow noreferrer">byte</a></h1>
<pre><code>ò
</code></pre>
<p>Only works in the legacy version of 05AB1E, which is builtin in Python. The new version of 05AB1E, which is built in Elixir, will round away from zero.</p>
<p><a href="https://tio.run/##MzBNTDJM/f//8Kb//3WN9EwB" rel="nofollow noreferrer">Try it online</a> or <a href="https://tio.run/##MzBNTDJM/V9Waa@k8KhtkoKSfeX/w5v@6/yP1jXWM9DRNdIzBxGmIMJIR9cQxDUEcQ1ALAMgywCozEDPRAfCNjXUMQQKGAIVG@qZWFpa6oBUg7QZAYWN9Ix1QIYZ6ZnFAgA" rel="nofollow noreferrer">verify all test cases</a>.</p>
<h1>C, 5 bytes</h1>
<pre><code>lrint
</code></pre>
<p>The <a href="https://man7.org/linux/man-pages/man3/lrint.3.html" rel="nofollow noreferrer">Linux manual page</a> lists this as being part of the C99, POSIX.1-2001, and POSIX.1-2008 standards.  It can be used without a prototype for golfing since it returns <code>long</code>, unlike the 4-byte <a href="https://man7.org/linux/man-pages/man3/rint.3.html" rel="nofollow noreferrer"><code>rint</code></a> which returns <code>double</code> and thus can handle the full range of <code>double</code> inputs.  Both these and <code>nearbyint</code> use the current rounding FP mode, which is nearest-even by default on IEEE-754 systems, unlike <a href="https://man7.org/linux/man-pages/man3/round.3.html" rel="nofollow noreferrer">C's <code>round</code> function</a> which uses away-from-zero as a tiebreak (like Python 2's <code>round</code>).</p>
<p>C++11 includes the C99 math library (which many C/C++ implementations already provided).  Since you need prototypes anyway in C++, <code>std::rint</code> or just <strong><code>rint</code> 4 bytes</strong> should be available after <code>#include &lt;cmath&gt;</code> (<a href="https://en.cppreference.com/w/cpp/numeric/math/rint" rel="nofollow noreferrer">cppreference</a>).</p>
<h1><a href="http://www.mono-project.com/docs/about-mono/releases/5.0.0/#csc" rel="nofollow noreferrer">C# (Visual C# Compiler)</a>, 17 bytes</h1>

<pre class="lang-cs prettyprint-override"><code>x=&gt;Math.Round(x);
</code></pre>
<p><a href="https://tio.run/##NY69CsIwFEb3PsUdE6qlDk79WQQnu@jgHJO0XmiTkpuUSumzx4C4nAOHb/gkHSXJGAjNAI8PeT1VWTaH14gS5CiIYHZ2cGKCDf6dvPBJi0UFnUDDOGxZdg1G1sqmiT781PZNXJu2E/5d3G0wiq28ir11bBEOsCkrrE8Jec7hYg3ZURdPh17f0GjWM8zL4qw4T4/2PX4B" rel="nofollow noreferrer" title="C# (Visual C# Compiler) – Try It Online">Try it online!</a></p>
<p>The build in Math.Round in C# already rounds to the nearest even number</p>
<h1><a href="https://factorcode.org" rel="nofollow noreferrer">Factor</a>, 13 bytes</h1>
<pre class="lang-cs prettyprint-override"><code>round-to-even
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m70sLTG5JL9owU3P0GBPP3crhdzEkgy9tNK85JLM_LxihYKi1JKSyoKizLwSheLUwtLUvOTUYgVrLq5qBSM9UwVDIAbSBoZAlomlpaVCrUL00tKSNF2LtUX5pXkpuiX5uqllqXkQseWxQOMLFPQgvAULIDQA" rel="nofollow noreferrer">Attempt This Online!</a></p>
<h1><a href="http://www.complang.tuwien.ac.at/forth/gforth/Docs-html/" rel="nofollow noreferrer">Forth (gforth)</a>, 6 bytes</h1>

<pre class="lang-forth prettyprint-override"><code>fround
</code></pre>
<p><a href="https://tio.run/##Jco7DoAgEATQnlNM6CF@wAISLwOuVkKInH9Ft3ozk6HSnsuc9MEBBKZW@p0ZUQVUpAbKvYIsrIbZocdnlKjUZP2BqmZhEVbBCV7YhNTG4P7ILw" rel="nofollow noreferrer" title="Forth (gforth) – Try It Online">Try it online!</a></p>
<h1><a href="https://www.haskell.org/" rel="nofollow noreferrer">Haskell</a>, 5 bytes</h1>

<pre class="lang-hs prettyprint-override"><code>round
</code></pre>
<p><a href="https://tio.run/##y0gszk7Nyfmvq6sQ878ovzQv5X9uYmaegq1CSj6XAhAUFGXmlSioKIDlFIz0TLGIGuuZ/v@XnJaTmF78XzfCOSAAAA" rel="nofollow noreferrer" title="Haskell – Try It Online">Try it online!</a> From the <a href="https://hackage.haskell.org/package/base-4.18.0.0/docs/Prelude.html#v:round" rel="nofollow noreferrer">documentation</a>:</p>
<blockquote>
<p><code>round x</code> returns the nearest integer to <code>x</code>; the even integer if <code>x</code> is equidistant between two integers</p>
</blockquote>
<h1><a href="https://github.com/DennisMitchell/jellylanguage" rel="nofollow noreferrer">Jelly</a>, 3 <a href="https://github.com/DennisMitchell/jellylanguage/wiki/Code-page" rel="nofollow noreferrer">bytes</a></h1>
<pre class="lang-hs prettyprint-override"><code>ær0
</code></pre>
<p><a href="https://tio.run/##HYuxDYAwDARXSYuUWLaTgDIBQyBKGpSKjgnYhEUymOHdnN9n/3n0fpuN92KL45lWsy1l4hiS0uKsTv0pbsQNe2ZkxjtTAXytEoNACmpCpbWGWYG/prgpZaAC8/4B" rel="nofollow noreferrer" title="Jelly – Try It Online">Try it online!</a></p>
<h1><a href="https://en.wikipedia.org/wiki/MMIX" rel="nofollow noreferrer">MMIX</a>, 4 bytes/1 instruction</h1>
<pre class="lang-hs prettyprint-override"><code>␗�␄�
</code></pre>
<p>The replacement characters are in order the output and input registers; Unicode control pictures have been used to encode unprintable characters. This is <code>FINT $x,ROUND_NEAR,$y</code>, which rounds a float to the nearest integer (half-even).</p>
<h1><a href="https://github.com/PowerShell/PowerShell" rel="nofollow noreferrer">PowerShell Core</a>, 22 bytes</h1>
<pre class="lang-powershell prettyprint-override"><code>[Math]::Round(&quot;$args&quot;)
</code></pre>
<p><a href="https://tio.run/##XZDRaoMwFIbvfYqDhKEQi8a6YqEgjO1ubLRjN6UMZ08nw83ORDbofHaXxM4mnrvvP3@@hBzrb2x4iVUVFHWDPTmsTv32Phflbrlc1@3n3nNJ3rxx1@87x8k8B@TQzAviWUghiP0xYLPFNEhkwMyA2UGkj1jB5EioG5EZyEY4cqheYeLcxkk5iShcZJE6bCKzcZ6mqZ1IHTNwYSJTNhNjGxMbrynIv/LhF@7q5jYvyuDh9R0LASfdIQK5eM6rFikQ/DnKDe5hBeRlWDfI20rI4IocjLJebh83Ny0X9cdg3GWDUs2mLQrkXInOhgC/LheMPfdJGkErXVW2L1Cz/n/AWaQXndP1fw" rel="nofollow noreferrer">Try it online!</a></p>
<h1><a href="https://php.net/" rel="nofollow noreferrer">PHP</a>, 20 bytes</h1>
<p>PHP's <code>round</code> has a third parameter &quot;mode&quot; that can be used with the constant <code>PHP_ROUND_HALF_EVEN</code> (value: 3)</p>

<pre class="lang-php prettyprint-override"><code>&lt;?=round($argn,0,3);
</code></pre>
<p><a href="https://tio.run/##JYxBCsJADEX3OUZxYaETkkyrDFXc9RTdFBXrZmaoen1jgpvP@5@X1LWqni7nrXzybb9btkfuqIvtqPfrWpo5N6OGiARB8OgxeAgE9speyYmMyDTCHv48MLANbDJjn1ICt/1MbBaM4M8ED99S38@SXxqmHw" rel="nofollow noreferrer" title="PHP – Try It Online">Try it online!</a></p>
<h1><a href="https://www.python.org" rel="nofollow noreferrer">Python</a>, 5 bytes</h1>
<pre class="lang-python prettyprint-override"><code>round
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m72soLIkIz9vweI025ilpSVpuhZLi_JL81Ig7JtuaflFChUKmXkKRYl56akausYGBjoKYMLIVNNKoaAoM69EI02pukJBX8HQwEDPoFZB106hOk0DLqBZq6QJMW3BAggNAA" rel="nofollow noreferrer">Attempt This Online!</a></p>
<h1><a href="https://www.r-project.org" rel="nofollow noreferrer">R</a>, 5 bytes</h1>
<pre class="lang-r prettyprint-override"><code>round
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m72waMGiNNulpSVpuhZLi_JL81Ig7JuqJTa6xamFGrrGOsY6ekammlzJSZl5KRolOsWJBQU5lUBGmqYmRPGCBRAaAA" rel="nofollow noreferrer">Attempt This Online!</a></p>
<h1>Rust, 25 bytes</h1>
<p>Using libmath</p>
<pre class="lang-rust prettyprint-override"><code>math::round::half_to_even
</code></pre>
<h1><a href="https://github.com/Thunno/Thunno2" rel="nofollow noreferrer">Thunno 2</a>, 1 byte</h1>
<pre class="lang-php prettyprint-override"><code>V
</code></pre>
<p><a href="https://Not-Thonnu.github.io/run#aGVhZGVyPSZjb2RlPVYmZm9vdGVyPSZpbnB1dD0tMy4wJTIwJTIwJTIwLSUzRSUyMCUyMCUyMCUyMC0zJTBBLTIuNyUyMCUyMCUyMC0lM0UlMjAlMjAlMjAlMjAtMyUwQS0yLjUlMjAlMjAlMjAtJTNFJTIwJTIwJTIwJTIwLTIlMEEtMi4yJTIwJTIwJTIwLSUzRSUyMCUyMCUyMCUyMC0yJTBBLTEuNyUyMCUyMCUyMC0lM0UlMjAlMjAlMjAlMjAtMiUwQS0xLjUlMjAlMjAlMjAtJTNFJTIwJTIwJTIwJTIwLTIlMEEtMC43JTIwJTIwJTIwLSUzRSUyMCUyMCUyMCUyMC0xJTBBLTAuNSUyMCUyMCUyMC0lM0UlMjAlMjAlMjAlMjAwJTBBMC4wJTIwJTIwJTIwJTIwLSUzRSUyMCUyMCUyMCUyMDAlMEEwLjQlMjAlMjAlMjAlMjAtJTNFJTIwJTIwJTIwJTIwMCUwQTAuNSUyMCUyMCUyMCUyMC0lM0UlMjAlMjAlMjAlMjAwJTBBMC41MSUyMCUyMCUyMC0lM0UlMjAlMjAlMjAlMjAxJTBBMS4wJTIwJTIwJTIwJTIwLSUzRSUyMCUyMCUyMCUyMDElMEExLjIlMjAlMjAlMjAlMjAtJTNFJTIwJTIwJTIwJTIwMSUwQTEuNDk5OSUyMC0lM0UlMjAlMjAlMjAlMjAxJTBBMS41JTIwJTIwJTIwJTIwLSUzRSUyMCUyMCUyMCUyMDIlMEExLjclMjAlMjAlMjAlMjAtJTNFJTIwJTIwJTIwJTIwMiUwQTIuMCUyMCUyMCUyMCUyMC0lM0UlMjAlMjAlMjAlMjAyJTBBMi4zJTIwJTIwJTIwJTIwLSUzRSUyMCUyMCUyMCUyMDIlMEEyLjUlMjAlMjAlMjAlMjAtJTNFJTIwJTIwJTIwJTIwMiUwQTIuNiUyMCUyMCUyMCUyMC0lM0UlMjAlMjAlMjAlMjAzJmZsYWdzPUM=" rel="nofollow noreferrer">Try it online!</a></p>
<h1><a href="https://github.com/Vyxal/Vyxal" rel="nofollow noreferrer">Vyxal</a>, 1 byte</h1>
<pre class="lang-php prettyprint-override"><code>ṙ
</code></pre>
<p><a href="https://vyxal.pythonanywhere.com/?v=2#WyJBIiwiIiwi4bmZIiwiIiwiMVxuMS41XG4yXG4yLjVcbjNcbjMuNVxuNCJd" rel="nofollow noreferrer">Try it Online!</a></p>
</div>
<div id="pu1" class="pu"><p>The <a href="https://en.wikipedia.org/wiki/Rounding#Rounding_half_to_even" rel="nofollow noreferrer">nearest-even rounding mode</a>, aka Banker's Rounding, is the default for IEEE-754 math, so normal programs (which haven't changed the FP environment) on most ISAs including x86 can just use instructions that round a float to an integer-valued float, or convert to integer with the current rounding mode.  (Most programs don't change the rounding mode away from the default.)</p>
<p>This is basically just using built-ins, but I didn't want to clutter up the existing answer with a bunch of machine-code stuff and associated interesting stuff I wanted to write about x86.  If people want to add sections for other ISAs, feel free, although most other mainstream ISAs have fixed-width instructions so it's always either a 2 or 4-byte instruction.</p>
<p>For the convert-to-integer instructions, out-of-range inputs produce the most-negative 2's complement integer of whatever destination width, which Intel calls the &quot;integer indefinite&quot; value.  (e.g. <code>0x80000000</code> for 32-bit.)  For AVX-512 unsigned conversions, the &quot;integer indefinite&quot; value is all-ones, <code>0xffffffff</code> (e.g. from <a href="https://www.felixcloutier.com/x86/vcvtss2usi" rel="nofollow noreferrer"><code>vcvtss2usi</code></a>.)  Rounding instructions that produce a number in the same format as the input don't have this problem.</p>
<h1>x86(-64) machine code, x87 scalar math, 3 bytes</h1>
<p>Uses the rounding mode in <a href="http://www.ray.masmcode.com/tutorial/fpuchap1.htm" rel="nofollow noreferrer">the x87 control word</a>, which defaults to round-to-nearest w. even as a tie-break.  (at reset and <code>finit</code>, and in fresh processes under normal OSes).</p>
<p>Input arg in <code>st0</code>, top of the x87 stack, result stored to an <code>int *</code> pointed-to by RDI (or EDI if the same bytes execute in 32-bit mode).  None of the standard calling conventions even for 32-bit mode pass FP args in x87 registers; unlike the SSE part of the answer, you couldn't write a C prototype to describe it to a C compiler.</p>
<pre><code>  db 1f                   fistp  DWORD PTR [rdi]
  c3                      ret
</code></pre>
<p>Or to round to an integer-valued <code>long double</code> (modifying <code>st0</code> in place), <a href="https://www.felixcloutier.com/x86/frndint" rel="nofollow noreferrer">2-byte <code>frndint</code></a> is <code>D9 FC</code>.</p>
<h1>x86(-64) SSE2 or AVX scalar math, 5 bytes</h1>
<p>These use the current rounding mode in MXCSR, the SSE math control/status register, which is fully independent of the x87 FP environment.  Both use the same 2-bit codes for four different rounding modes, ceil/floor/trunc and nearest-even.  (The Python 2 / C <code>round()</code> rounding mode is not directly available in hardware on x86, so <a href="https://stackoverflow.com/questions/485525/round-for-float-in-c/47347224#47347224">should be avoided for performance reasons unless you specifically want it</a>.  IIRC, ARM does have it in hardware, as well as IEEE standard rounding.)</p>
<p>All the relevant SSE / SSE2 / AVX conversion instructions are 4 bytes long, whether encoded as legacy-SSE or AVX, except for conversion into an MMX register.  SSE1 <a href="https://www.felixcloutier.com/x86/cvtps2pi" rel="nofollow noreferrer"><code>cvtps2pi mm0, xmm0</code></a> is <code>0f 2d c0</code>, allowing for a total 4-byte function if you're willing to return a 32-bit signed integer in the bottom of <code>mm0</code>, which is a pretty inconvenient place for it and would need the caller to use longer instructions to store or do math with it.</p>
<p>SSE1 <code>ps</code> instructions are only 3 bytes, but <a href="https://www.felixcloutier.com/x86/cvtps2dq" rel="nofollow noreferrer"><code>cvtps2dq</code></a> involves packed integers so was new in SSE2 along with <code>cvtpd2dq</code> (packed-double vs. packed-single, converting to a double-quad-word of packed integers).  SSE1 scalar instructions have an extra prefix, so SSE1 <code>cvtss2si eax, xmm0</code> is also 4 bytes, same as SSE2 <code>cvtsd2si eax, xmm0</code>.  An AVX encoding of all of these is available with 2-byte VEX prefixes (plus opcode + modrm byte), again for 4-byte instructions, except there's no <code>cvtps2pi</code> (MMX destination.)</p>
<pre><code>                          sse:       # first arg in XMM0, return in EAX
    f3 0f 2d c0             cvtss2si eax,xmm0         # SSE1
    c3                      ret

Alternatives:  # float vs. double, and scalar vs. packed.
    f2 0f 2d c0             cvtsd2si eax,xmm0         # SSE2 scalar double to i32, note same 0f 2d opcode but different prefix from SSE1 scalar.
       0f 2d c0             cvtps2pi mm0,xmm0         # SSE1 2 floats to 2 i32 in an MMX reg
    66 0f 5b c0             cvtps2dq xmm0,xmm0        # SSE2 packed conversion 4 floats to 4x i32.  cvtpd2dq (2 doubles to 2 i32) is the same size

    c5 f9 5b c0             vcvtps2dq xmm0,xmm0       # AVX encodings; different bits in the C5 ... prefix represent different combinations of prefixes.
    c5 fa 2d c0             vcvtss2si eax,xmm0
    c5 fb 2d c0             vcvtsd2si eax,xmm0      ... etc.
</code></pre>
<p>(There are also truncating versions of these, like <code>cvttsd2si</code>, to implement C <code>(int)double</code> rounding semantics of truncation toward 0 without having to change the rounding mode like in the bad old days of x87 before SSE3 <code>fisttp</code>.)</p>
<p>Implementing C <code>rint[f]</code> / <code>nearbyint[f]</code> (rounding to an integer-valued <code>double</code> [or <code>float</code>]) needs multiple instructions until SSE4.1 <code>roundsd</code> / <code>roundps</code> etc, which are 6-byte instructions (with register args and no REX).  e.g. <code>66 0f 3a 0a c0 00       roundss xmm0,xmm0,0x0</code>.  (roundss and roundsd have separate opcodes, instead of being distinguished by prefixes like SSE1 <code>addss</code> vs. SSE2 <code>addsd</code>).  The instruction needs an immediate to specify the rounding mode: whether to override or not, and if so, which of the 4 modes to use, and whether to suppress FP inexact (precision) exceptions.  See <a href="https://www.felixcloutier.com/x86/roundpd" rel="nofollow noreferrer"><code>roundsd</code></a> documentation.  An immediate of <code>0</code> selects rounding-control = from the immediate, with the <code>00</code> field being the nearest-even mode that's the default.</p>
<p>(Like the &quot;alternatives&quot; above, I'm showing machine code + assembly of multiple instructions.  You'd only ever use one, depending on the input format (float or double, scalar vs. packed).)</p>
<pre><code>66 0f 3a 08 c0 00       roundps xmm0,xmm0,0x0        # other than SSE1, the ps form isn't shorter.
66 0f 3a 0a c0 00       roundss xmm0,xmm0,0x0
66 0f 3a 0b c0 00       roundsd xmm0,xmm0,0x0

c4 e3 79 0b c0 00       vroundsd xmm0,xmm0,xmm0,0x0      # 3-byte VEX prefix needed for instructions in opcode &quot;maps&quot; used by SSE4 and later, i.e. with 3 prefixes such as 66 0f 3a
c4 e3 79 08 c0 00       vroundps xmm0,xmm0,0x0   ... etc.
</code></pre>
<h1>x86 + AVX-512 not relying on the current rounding mode, 7 bytes</h1>
<p><strong>AVX-512 EVEX prefixes can override the rounding mode on a per-instruction basis</strong>, for <em>any</em> instruction with scalar or 512-bit vector width, including when <code>vaddps</code> or whatever have to round their result to a representable float/double.  (Not 128 or 256-bit vector width until <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/advanced-performance-extensions-apx.html" rel="nofollow noreferrer">APX and AVX10.2</a> which finally stops caring about obsolete 32-bit mode so it can use more of the bits of the EVEX prefix, instead of having to slot in to only invalid-in-32-bit-mode encodings of some instruction.)  Fun fact: out-of-order exec CPUs that support SMT (e.g. hyperthreading) already have to track the rounding mode on a per-instruction basis internally, because different logical cores could be using different rounding mode settings.  So it makes some sense to expose this functionality to programmers.</p>
<p>AVX-512 also allows for conversion directly <a href="https://stackoverflow.com/questions/64592329/convertion-of-four-packed-single-precision-floating-point-to-unsigned-double-wor">to unsigned integer, and to <em>packed</em> 64-bit integers</a>, not just scalar-only for conversions involving 64-bit signed integers in SSE/AVX (in 64-bit mode only).</p>
<p>An <a href="https://www.intel.com/content/dam/develop/external/us/en/documents/319433-024-697869.pdf" rel="nofollow noreferrer">Intel manual from 2016</a> when AVX-512 was newish has some details in section 2.5.4 <em>Static Rounding and Suppress All Exceptions</em>, where it compares to instructions like <code>vroundps</code> and <code>vrndscaleps</code> which allow this via an immediate, vs. setting MXCSR.</p>
<pre><code>                         avx512:
    62 f1 ff 18 2d c0       vcvtsd2si rax,xmm0{rn-sae}
    c3                      ret
</code></pre>
<p>The NASM syntax I used is <code>vcvtsd2si  rax, xmm0, {rn-sae}</code>.  The disassembly is from <code>objdump -drwC -Mintel</code>, so is using GAS's <code>.intel_syntax noprefix</code> style for the rounding override.</p>
<p>Using an <code>eax</code> destination wouldn't save any machine code bytes, unlike with legacy SSE (separate REX prefix), or with AVX where <code>vcvtsd2si rax,xmm0</code> needs a 3-byte VEX prefix for a total length of 5 bytes instead of 4.</p>
</div>
<div id="pu2" class="pu"><h1>JavaScript (ES6), 30 bytes</h1>
<p>Uses the <code>Math.round()</code> built-in, then clears the least significant bit of the result if the squared fractional part of the original input is <span class="math-container">\$1/4\$</span>.</p>

<pre class="lang-javascript prettyprint-override"><code>v=&gt;Math.round(v)&amp;~(v*v%1==.25)
</code></pre>
<p><a href="https://tio.run/##Xc7BToMwGAfwO0/xZYm2daOBMjTTFE9608uO6gFZ2TCMzlJIjNEnMPHiUd/D59kL@AjYohkwSEh@fP/v3z7EdVwmKttot5AL0aS8qXl0FesVVbIqFrgmh6@4PqoPfM4pC0mjxGOVKYFHaTkiVIl4cZnlYv5UJNgjVMu5VlmxxISWmzzTeHRbmFgq1UWcrHAJPIJnByAXGm6gnoCsNNwBh/I/j9wIEbqON/i6Wt8LRSYmbR8lzDKk5kJn5k8ii1LmguZyie1kDMi8Y2jBeVt7Dujn@337@WG@CE4Bbb/eEDHrL6RxA@qZUjey1W7guIye7DnszKzZwH4/33qY9/pz37qbe47Xnt7jdMhwj/6OvuP3dy3ZkNPZbNZjr4o5f7fekfWrLIMhwyGPOwa/" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<h3>Explanation</h3>
<p><code>Math.round</code> does <em>rounding half up</em>.</p>
<p>We have 4 cases. Given <span class="math-container">\$k\ge 0\$</span>:</p>
<ul>
<li><p><span class="math-container">\$2k+1/2\$</span> is rounded to <span class="math-container">\$2k+1\$</span>. Clearing the LSB turns it into <span class="math-container">\$2k\$</span>.</p>
<p>Example: <span class="math-container">\$22.5 \rightarrow 23 \rightarrow 22\$</span></p>
</li>
<li><p><span class="math-container">\$2k+1+1/2\$</span> is rounded to <span class="math-container">\$2k+2\$</span>. Clearing the LSB leaves it unchanged.</p>
<p>Example: <span class="math-container">\$23.5 \rightarrow 24 \rightarrow 24\$</span></p>
</li>
<li><p><span class="math-container">\$-(2k+1/2)\$</span> is rounded to <span class="math-container">\$-2k\$</span>. Clearing the LSB leaves it unchanged.</p>
<p>Example: <span class="math-container">\$-22.5 \rightarrow -22 \rightarrow -22\$</span></p>
</li>
<li><p><span class="math-container">\$-(2k+1+1/2)\$</span> is rounded to <span class="math-container">\$-(2k+1)\$</span>. Clearing the LSB turns it into <span class="math-container">\$-(2k+2)\$</span>.</p>
<p>Example: <span class="math-container">\$-23.5 \rightarrow -23 \rightarrow -24\$</span></p>
</li>
</ul>
</div>
<div id="pu3" class="pu"><h1><a href="https://www.r-project.org" rel="nofollow noreferrer">R</a>, <s>35</s> <s>25</s> 23 bytes</h1>
<p><em>Edit: -2 bytes thanks to pajonk</em></p>
<pre class="lang-r prettyprint-override"><code>\(x)(x+.5-!x%%2-.5)%/%1
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m72waMGK3Mqi_NK8FNulpSVpuhbbYzQqNDUqtPVMdRUrVFWNdPVMNVX1VQ0hsjdNS2x0i1MLNXSNdYx19IxMNbmg2jVKNLkSc3I0EFxbWxhLE6J5wQIIDQA" rel="nofollow noreferrer">Attempt This Online!</a></p>
</div>
<div id="pu4" class="pu"><h1><a href="https://codeberg.org/ngn/k" rel="nofollow noreferrer">K (ngn/k)</a>, 16 bytes</h1>
<pre><code>{_x+0.5-1=4!2*x}
</code></pre>
<p><a href="https://ngn.codeberg.page/k#eJxdzr0OgjAQAOD9nqLUxILY2muphhp/1q7MTdAFdwdDYuTZtZhAy3K5L/fb2Xfbl1IYjqcqU5v+A7ADroUkhPAzCVEDV+KwsJmtglVijPtHp/0yrmPwXJcgx+sRq5RmQZyIgPFsoEpZ1XUdMVql4P/1RBWvCtQpTcr9TA0ewFls3XU95O6yZXTnPS1Ynq2clfZ2fz5eBAvI3bEpbCkYo2GUeuYAmoH47pd8AUxCRRc=" rel="nofollow noreferrer">Try it online!</a></p>
<p>A near-port of my own J answer.</p>
</div>
<div id="pu5" class="pu"><h1><a href="https://codeberg.org/ngn/k" rel="nofollow noreferrer">K (ngn/k)</a>, <sup>38</sup> <sup>37</sup> <sup>34</sup> <sup>27</sup> 23 bytes</h1>
<pre><code>{*r-2!r*=/r:|1_:\x+0.5}
</code></pre>
<p><a href="https://ngn.codeberg.page/k#eJxdzjkPwiAUAOD9/QrERHoI5SiaYjxW1s4k1aXuDMZE7W9XatJCl5f35Z29eRWeypUvjpU3b9EZ9yw50x+ACqhiHCFETyhEBVSy/cJ6tgyWiUXcPzrt53FdBM91Dny8HrFOqRcUEwWIeDZQpqybpokYrZLw/3qijFcFqpQ65W6mAgdgjejsZTNk9rwluHIO5yRbra3h5nrz9wcSOWT20OamZITgMIodsQDtgFz/S74IAEdm" rel="nofollow noreferrer">Try it online!</a></p>
<p>-1 : Shuffle<br/>
-3 : Shuffle<br/>
-7 : Rework<br/>
-4 : Wow</p>
</div>
<div id="pu6" class="pu"><h1><a href="http://jsoftware.com/" rel="noreferrer">J</a>, 7 bytes</h1>
<pre><code>0&quot;.@&quot;:]
</code></pre>
<p><a href="https://tio.run/##Xc6xCgIxDIDh3acIXQ5BQ5JePVo4EAQnJ3dxEA9xufef6sEl0txQyveTlH5rwG6CsUAHByAoyzkiXO63a6WA51Aedb97vz4zPCOMMC0Xkg@CgwaxkLZBfODtCv9XeA1kE2ROrck@Yew9dZiN3Jpt2Siefc55LaIleQ4txV4zRk/djcpT/QE" rel="noreferrer" title="J – Try It Online">Try it online!</a></p>
<p>Formats to zero decimal places and then evaluates back to number.</p>
<h1><a href="http://jsoftware.com/" rel="noreferrer">J</a>, 14 bytes</h1>
<pre><code>&lt;.@+1-:@~:4|+:
</code></pre>
<p><a href="https://tio.run/##Xc7BCsIwDIDhu08RvAyZC0naOlocDARPnnwBD@IQL76A@Op1sEaaHUr5fpLSV95iM8GQoIE9EKT5dAin6@Wcjzi23KXxm/ynTXm3edyfb7g5GGCaLyQbBPsSRENYB7GB1yv8X@ElkE6QOtQm/YTSW5ZhVnJt1mWlWPoY41KklGDZ1xR9Teksy64rPOQf" rel="noreferrer" title="J – Try It Online">Try it online!</a></p>
<p>Evaluates <code>floor(x + 0.5)</code> unless <code>2*x%4 == 1</code>, in which case <code>floor(x)</code> is returned instead.</p>
<pre><code>&lt;.@+1-:@~:4|+:
          4|+:   2*x%4
    1   ~:       != 1
     -:@         / 2
   +             x +
&lt;.@              floor()
</code></pre>
</div>
<div id="pu7" class="pu"><h1><a href="http://jsoftware.com/" rel="nofollow noreferrer">J</a>, <sup><s>22</s></sup> 21 bytes</h1>
<pre><code>&lt;.@+&amp;1r2([-AND)1=2|+:
</code></pre>
<p><a href="https://tio.run/##Xc6xCsIwEIDh3ac4HKylNuQuTUuCAUVxEgdXBwexFBfB2XePheYk1yGE7@cu5BWXqugheChgAxr8eGoFh@v5FLdqV63wQ@tbvb8cSwz0rXwsF8/H8Ia7gQD9eCktA6kuBeJg54FkwPkK/ldwCponNNvm1vwJZiOZhpGJuZGXmSTZOOemQqlYyS4n8WtMI5l2TWIbfw" rel="nofollow noreferrer" title="J – Try It Online">Try it online!</a></p>
<p>Heavily inspired by Arnauld's approach, except checks for exact 0.5 by doubling and checking that the remainder mod 2 is exactly 1 <code>1=2|+:</code>.</p>
<p>Then subtracts the adjustment bit <code>AND</code>ed with the standard round from the standard round.</p>
</div>
<div id="pu8" class="pu"><h1><a href="https://www.r-project.org" rel="nofollow noreferrer">R</a>, 57 bytes</h1>
<pre class="lang-r prettyprint-override"><code>\(x,a=x%/%1)`if`(x-a&lt;.5,a,`if`(x-a&gt;.5|a%%2,ceiling(x),a))
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m72waMGiNNulpSVpuhY3LWM0KnQSbStU9VUNNRMy0xI0KnQTbfRMdRJ1YDw7PdOaRFVVI53k1MyczLx0jQpNnURNTagBDiU2usWphRq6xjrGOnpGpppcyUmZeSkaJTrFiQUFOZVARpqmJldiTo4GkoCtbVF-KUgVzJwFCyA0AA" rel="nofollow noreferrer">Attempt This Online!</a></p>
</div>
<div id="pu9" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, 21 bytes</h1>
<pre><code>ＮθＩ⊟⌊Ｅ⟦⌊θ⌈θ⟧⟦↔⁻θι﹪ι²ι
</code></pre>
<p><a href="https://tio.run/##FcqxCsMgFIXhvU/heAVTSqFTphIodLBkDxlMKu0F9Rr19vWtnuk/8O1fk3YyrtZniFxe7Deb4JDjaU4YCkwmF5gpgsaAnj1oE2F5OKKulJgsOgyf1qsSy33L5LjYrjnDoQTKhjS92RGgEtf2cJV9Y63D5Xyrw8/9AQ" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Explanation: Port of @JonathanAllan's Jelly answer.</p>
<pre><code>Ｎθ                      Input as a number
        θ               Input number
       ⌊                Floor
          θ             Input number
         ⌈              Ceiling
     Ｅ⟦    ⟧            Map over both values
               θ        Input number
                ι       Current value
             ↔⁻         Absolute difference
                  ι     Current value
                 ﹪      Modulo
                   ²    Literal integer `2`
                    ι   Current value
            ⟦           Make into list
    ⌊                   Take the minimum
   ⊟                    Pop the rounded result
  Ｉ                     Cast to string
                        Implicitly print
</code></pre>
<p>34 bytes for arbitrary precision:</p>
<pre><code>≔⪪θ.η≔⊟ηζＩ⁻ＩΣη∧⎇﹪ＩΣη²¬‹ζ5›ζ5∨№θ-±¹
</code></pre>
<p><a href="https://tio.run/##XY5BCoMwEEX3PYW4moBKW3DlSlx0U61gLxA0aCAmdpIU6uXTsXZROjAwvP9gfj9x7A1XIZTWylFDtyjp4JFEcRazJJpYcfgmrVlgIrQSalFqBxW3Dmqpvd3Pzs9kkFLqAe4CNccX1GbwyvwJZ9rGOLgKa2GlZ3m84QsK7gT@kBtCZbzeG6Vbo0aM5MCJfaYIIT1meUif6g0" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Explanation:</p>
<pre><code>≔⪪θ.η≔⊟ηζ
</code></pre>
<p>Separate the integer and decimal parts.</p>
<pre><code>Ｉ⁻ＩΣη∧⎇﹪ＩΣη²¬‹ζ5›ζ5∨№θ-±¹
</code></pre>
<p>Compare the decimal <code>&gt;=</code> or <code>&gt;</code> than <code>.5</code> depending on whether the integer is odd or even, and increment the absolute value of the integer if so.</p>
</div>
<div id="pu10" class="pu"><h1><a href="https://github.com/DennisMitchell/jelly" rel="noreferrer">Jelly</a>, 9 bytes</h1>
<p>Jelly's builtin is 3 bytes: <code>ær0</code> - round to nearest multiple of <span class="math-container">\$10^0\$</span>, which employs Python's <code>round</code>.</p>
<pre><code>Ḟ,ĊḂÞạÞ⁸Ḣ
</code></pre>
<p><strong><a href="https://tio.run/##y0rNyan8///hjnk6R7oe7mg6PO/hroWH5z1q3PFwx6L/OofbNd3//4/WNdYz0FHQNdIzB5OmYNIISBqCRQzBIgZgtgGIbQBSbqBnAiLAXFNDHQVDkKAhSJuhnomlpSWINgURQG1GIDkjPWMQYQoizGIB" rel="noreferrer" title="Jelly – Try It Online">Try it online!</a></strong></p>
<h3>How?</h3>
<pre><code>Ḟ,ĊḂÞạÞ⁸Ḣ - Link: float, X
Ḟ         - floor {X}
  Ċ       - ceil {X}
 ,        - pair -&gt; [floor(X), ceil(X)]
    Þ     - sort by:
   Ḃ      -   is odd?
      Þ   - sort by:
     ạ ⁸  -   absolute difference {X}
        Ḣ - head
</code></pre>
</div>
<div id="pu11" class="pu"><h1><a href="https://github.com/m-ender/retina/wiki/The-Language/a950ad7d925ec9316e3e2fb2cf5d49fd15d23e3d" rel="nofollow noreferrer">Retina 0.8.2</a>, 61 bytes</h1>
<pre><code>([02468])\.5$|\.[0-4].*
$1
\b9+\.
0$&amp;
T`9d`d`.9*\.
\..+

-0
0
</code></pre>
<p><a href="https://tio.run/##JY2xDsIwDET3@46CSqtYdpoU/AX8AFtTKaAysHRAjPx7sMVyenc6@97Pz2u/t0N/ra1fOKb5sp4K5e5baOGQVhrQCcpDx0Lg7ohb1a1ulXSwoBCNQGBwa0EpI0zECJHOLtklIohbcctObMRWY0r4cxaIBWJloaSq8LafRYsjTfBnkWbYxg8" rel="nofollow noreferrer" title="Retina 0.8.2 – Try It Online">Try it online!</a> Link includes test cases. Explanation:</p>
<pre><code>([02468])\.5$|\.[0-4].*
$1
</code></pre>
<p>Remove the <code>.5</code> after an even digit, and any decimal less than <code>.5</code>.</p>
<pre><code>\b9+\.
0$&amp;
</code></pre>
<p>If there is an all <code>9</code>s integer part with a decimal part, prefix a zero.</p>
<pre><code>T`9d`d`.9*\.
</code></pre>
<p>If there is a decimal part then increment the integer part.</p>
<pre><code>\..+

-0
0
</code></pre>
<p>Remove any decimal part and change <code>-0</code> to <code>0</code>.</p>
<h1><a href="https://github.com/m-ender/retina/wiki/The-Language" rel="nofollow noreferrer">Retina</a>, 46 bytes</h1>
<pre><code>([02468])\.5$|\.[0-4].*
$1
\d+\..+
$.(*__
-0
0
</code></pre>
<p><a href="https://tio.run/##JY2xDsIwEEN3f0eRQqtYd2lSyBfwEU1VkGBgYUCM/Hu4E4tlW@/O78fn@bppP4TLtYdVUl7O27GxDN/GVWLeOGJQtPvUyAkDw7jviALpPVYWxJmCmHhyKS4JUT2qR3En5sQwYcbfF4VaoQYrc60VTvtZsjpxhj9LXGAbPw" rel="nofollow noreferrer" title="Retina – Try It Online">Try it online!</a> Link includes test cases. Explanation:</p>
<pre><code>([02468])\.5$|\.[0-4].*
$1
</code></pre>
<p>Remove the <code>.5</code> after an even digit, and any decimal less than <code>.5</code>.</p>
<pre><code>\d+\..+
$.(*__
</code></pre>
<p>If there is still a decimal part, remove it and increment the integer part.</p>
<pre><code>-0
0
</code></pre>
<p>Change <code>-0</code> to <code>0</code>.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/264663/">264663</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




