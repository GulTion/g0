<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::273579</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>331</td><td>JavaScript Node.js</td><td>240610T004053Z</td><td><a href="https://codegolf.stackexchange.com/questions/273579/sum-of-positive-and-negative-powers-of-2/273580#273580">Arnauld</a></td></tr>
<tr d-ix="1"><td>nan</td><td></td><td>240610T141442Z</td><td><a href="https://codegolf.stackexchange.com/questions/273579/sum-of-positive-and-negative-powers-of-2/273598#273598">138 Aspe</a></td></tr>
<tr d-ix="2"><td>nan</td><td></td><td>240610T094056Z</td><td><a href="https://codegolf.stackexchange.com/questions/273579/sum-of-positive-and-negative-powers-of-2/273590#273590">corvus_1</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, ≈3.3ms <sup>(1)</sup></h1>
<p><em>This hexadecimal version was suggested by <a href="https://codegolf.stackexchange.com/users/44718/tsh">tsh</a></em></p>
<p>Expects a BigInt.</p>
<p>This computes <code>hammingweight(XOR(n, 3*n))</code>, as suggested on <a href="https://oeis.org/A007302" rel="nofollow noreferrer">A007302</a>.</p>

<pre class="lang-javascript prettyprint-override"><code>function f(binStr) {
  const tableHex = [
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 2, 3, 2, 3, 3, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ];

  const n = BigInt(&quot;0b&quot; + binStr);
  const hex = (n ^ 3n * n).toString(16);
  let count = 0;
  for (let i = 0, l = hex.length; i &lt; l; ++i) {
    count += tableHex[hex.charCodeAt(i)];
  }
  return count;
}
</code></pre>
<p><a href="https://tio.run/##xVJNa8MwDL3nV4ienKYrdr7ckPWw7bJdetmxdJBmTuph5JG6YzD62zM5aUuvg7HBs2weT/IT0lv1Ue3rTr@7G7Svqu@bA9ZOW4SGbTU@uy6ErwCgtrh34KqtUY/qE5awJhKAz36Ev84RA@JzJCTn9797G82MkZD@8j@UsimDy@SQRnav2yd0bMK3E4jgNN3yItkNc2UIL5AgTAHDubMk0dgykQ9CoxyJD@hIyD3R2A6YZ7VnZmDoojpzo7B1u5LoWzAlRJEe1whO6dHysktrr693VfdA@3fnmA43vvKRTqfcocMxpQyO/ehz5V0WmciKRSYlz0Wei0WRy5inaZzIIkllupCJFCLPhkYEpziFhPOi4NddxdRU4Itao@bGtqxhqzAs@28" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<hr />
<h2>Using binary, ≈16ms <sup>(1)</sup></h2>

<pre class="lang-javascript prettyprint-override"><code>function f(binStr) {
  const n = BigInt(&quot;0b&quot; + binStr);
  let bin = (n ^ 3n * n).toString(2);

  return bin.split(&quot;1&quot;).length - 1;
}
</code></pre>
<p><a href="https://tio.run/##Zc0xq8IwFIbh3V9x6JR4aUmaNmkoLm4uLu6C9qY1Ek6kPbqIv72mere7HDjw8L3X0@M0daO/UY7x181zf8eOfETo2dnjgUYOzxVAF3EiQNjA1g87JJaJcwY/8GfaRIKj5U2EIRxBIawBeUExAY8DK5NKbHR0H3GRxXQLPi3JjBfB4UAXyEG2q9f8re2XKVvL2ja1MUJLrWVjtSlFVZXKWFWZqjHKSKnrT02KdNeghLBW/EsvozG4IsSB9WzPeTu/AQ" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<h2>Bitwise approach, ≈12 seconds <sup>(1)</sup></h2>
<p>Converting to a binary or hexadecimal string and iterating over its characters may not be the most elegant method (conceptually speaking), but it's much, <em>much</em> faster than going bitwise.</p>
<p>I assume this one causes several new BigInts to be allocated, inducing a massive overhead in the pipeline when <code>n</code> is large.</p>

<pre class="lang-javascript prettyprint-override"><code>function f(binStr) {
  const n = BigInt(&quot;0b&quot; + binStr);
  let N = n ^ 3n * n,
      count = 0;

  while(N) {
    N &amp;= N - 1n;
    count++;
  }
  return count;
}
</code></pre>
<p><a href="https://tio.run/##PY7BbsIwDIbveQqLA0opoKRpk0YRl9124bL7JChpCaqcqaTjgHj2zl2nWbIl//5tf7fT9@neDOEr7TBe/DS1IzYpRISWnwN@pCGDJwNoIt4TIBzgLXTvmPhKnFeQw5/HkaX3CY5kQPgEhbAB3JI6RxNHTDQRjpHyuIbe8@NyF2hlfaCyA4mO/bvzfG5elINP44CL6thrWkjmR9xWsrJ1ZYzQUmtZW20KUZaFMlaVpqyNMlLq6hdGCqobUEJYKzDbp0jcATteEDybj8be7/vY8ZbYMjf9AA" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<hr />
<p><em>(1) All benchmarks were done on my laptop with Node 20.10.0, using several calls to the function in a loop.</em></p>
</div>
<div id="pu1" class="pu"><h1>Python <sup>+ gmpy2    2.1.5</sup></h1>
<pre class="lang-python prettyprint-override"><code>import gmpy2
from gmpy2 import mpz
import time

def main():
    input_value = mpz('9515985770616618967204423793474873711653') * (mpz(10) ** 300990)
    print(f(input_value))

def f(n):
    bin_value = n ^ (n + (n &lt;&lt; 1))
    return gmpy2.popcount(bin_value)

if __name__ == &quot;__main__&quot;:
    start_time=time.time()
    main()
    print(f&quot;{(time.time()-start_time)*1000} ms&quot;)
</code></pre>
<p>It is around 16ms on my machine.</p>
</div>
<div id="pu2" class="pu"><h1>Rust <sup>+ num_bigint 0.4.5</sup></h1>
<pre class="lang-rust prettyprint-override"><code>use num_bigint::BigUint;
use std::str::FromStr;

fn main() {
    let input = BigUint::from_str(&quot;9515985770616618967204423793474873711653&quot;).unwrap()
        * (BigUint::from(10u64).pow(300990));
    print!(&quot;{}&quot;, f(input))
}

fn f(n: BigUint) -&gt; u64 {
    let bin: BigUint = &amp;n ^ (&amp;n + (&amp;n &lt;&lt; 1));
    bin.count_ones()
}
</code></pre>
<p>For the best performance, make sure to compile with<br />
<code>RUSTFLAGS='-C target-cpu=native' cargo build --release</code>. It is around 20ms on my machine.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/273579/">273579</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




