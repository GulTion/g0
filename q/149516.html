<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::149516</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>1067</td><td>Python3</td><td>230918T155443Z</td><td><a href="https://codegolf.stackexchange.com/questions/149516/jolly-gerrymandering/265338#265338">Ajax1234</a></td></tr>
<tr d-ix="1"><td>952</td><td>R</td><td>171201T000415Z</td><td><a href="https://codegolf.stackexchange.com/questions/149516/jolly-gerrymandering/149602#149602">NofP</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>Python3, 1067 bytes:</h1>
<pre class="lang-py prettyprint-override"><code>E=enumerate
R=range
def P(b):
 c=[(x,y)for x,r in E(b)for y,_ in E(r)]
 while c:
  C=c.pop(0)
  q,s=[C],[C]
  while q:
   x,y=q.pop(0)
   for X,Y in[(0,1),(0,-1),(-1,0),(1,0)]:
    T=(x+X,y+Y)
    if T in c and T not in s and b[x+X][y+Y]==b[x][y]:q+=[T];s+=[T]
  yield s;c=[*{*c}-{*s}]
def S(b,g):
 k=[0,0]
 for x,y in g:k[b[x][y]]+=1
 return k[1]&gt;k[0]
def F(n,m,b):
 B=eval(str(b))
 for G in P(B):
  if len(G)&lt;4:
   for x,y in G:B[x][y]=int(not B[x][y])
 q=[(B,L:=[*P(B)],sum(S(b,i)for i in L))]
 H=[L]
 while 1:
  B,G,C=q.pop(0)
  O=max(j for k in B for j in k)+1
  if len(G)==n and sum(S(b,i)for i in G)&gt;=m:
   for Y,i in E(G,65):
    for x,y in i:B[x][y]=chr(Y)
   return B
  for x in R(len(b)+1):
   for y in R(len(b[0])+1):
    for X in R(x+1,len(b)+1):
     for Y in R(y+1,len(b[0])+1):
      if(X-x)*(Y-y)&gt;=4 and S(b,T:=[(j,k)for j in R(x,X)for k in R(y,Y)]):
       Q=eval(str(B))
       for U,I in T:Q[U][I]=O
       if len(W:=[*P(Q)])&lt;=n and len(W)&gt;=len(G)and W not in H and all(len(i)&gt;=4 for i in W)and(N_C:=sum(S(b,i)for i in W))&gt;=C:q+=[(Q,W,N_C)];H+=[W]
</code></pre>
<p><a href="https://tio.run/##pVNRT@JAEH6@/oqNL@zCYrqil0t1fShRNCEqHgZIb2MKFC2UFtp6R2P87dzMbql4MXcP16TtTOebb2a@6a6K/DmJW99W6XZ7IYP4ZRmkfh5Y9zL146fAmgYzckfHzLHIRHp0wws2S1Ky4SkJY3IBEXQL/mjclCmL/HoOo4BMIIW05eRwlayozcBZ80x6bcXhBs@g1ogCukKu34EEOYd8BJwetblgHJ5NfDUFt@GFT6UzSV/STWPIi8ZIZ5JwRvrYy4T48RTMOMnRzbQ79gCrPAArKcEBUznrhvT66jTTL@AowiCakuwU5q2/1idvzdd69qa0Et/pmD@hFgvp2dwGtBGjwBJPzsIrOVVDCoukQf6SxmThCXW@8GxDcUljvuRaUFcGP/2IZnkKMjLD1UGmO@piHGeJgph22Nmxs5OlLNZxXFNKhnFOccjSB541LMrlXQf6RybFs5clxdZDvawQ87sMN3UlvW61MIE1XN7h7f1d3Mqlv6FzXXuBma4252guWEPstyllrGX@pF6HnctlNcSIh@Z/6fCvJ8wscm@4sBpu8pxSs9hSTNcqkYi7p1h3DF2wirrYC4DmVcz8Uya4aQj@MbNsy4SLXfhDPs5Jh80Nq9NRs4BxjvWsOGcfpKZzvmCVMlCDD1mlGXDyEVMVE@m9r95lbPcV8Q/8GjP6Ts97UN61kre7aCnzwOy1B3Rnpd76M3RktoBfBrv//koD/CjSioS67WopA8TSm8e2Iz9Z2YABuq2PB@3xAQccU6dX4A7UNhNEkoODA8vGSwh8WsI4O7t0hYVhUWK0ZRyrNP@whaUzjWP4DZeF9bKjsrDAqqKsaWkHK@FlgK2/AnUBDcRTmSeP48RPpzSDHX0p/zXPqy/9FYUDBrKoSpdZGOVBSm@SOOAkO8xWUZjT2o@4hkfKslYpnkj0D@dJGFOkqBmbX9IT3uLvxQTDa5fSrNVPbPYPgtYHgqP/JWhpgu1v" rel="nofollow noreferrer">Try it online!</a></p>
<h2>Notes:</h2>
<ol>
<li>A little longer than the other solution, but deterministic and runs in ~3.65 seconds</li>
<li>Fatally-errors if there is no possible output</li>
</ol>
</div>
<div id="pu1" class="pu"><h1><a href="https://www.r-project.org/" rel="nofollow noreferrer">R</a>, <s>938</s> <s>896</s>  <s>858</s> 952 bytes</h1>



<pre class="lang-r prettyprint-override"><code>function(N,M,m){U="We tried...
"
L=length
A=matrix
W=which
K=sum
S=sample
G=unique
H=function(s,p=s-1){Y=S(c(s-j,s+j,p*(p%%j&gt;0),(s+1)*(s%%j&gt;0)))
Y[Y&gt;0&amp;Y&lt;=k]}
C=function(v,z=W(r==v))K(z%%j&lt;2,z-j&lt;0,(z+j)&gt;k)
m=A(strsplit(m,"")[[1]],1)
i=W(m&lt;0)[1]-1
m=((t(A(m,i+1))[,1:i]&gt;0)-.5)*2
if((K(m)&lt;M&amp;(N-M)&lt;1)|K(m&gt;0)&lt;(3*M))cat(U) else{j=max(1,nrow(m))
k=i*j;w=g=T
while(w&lt;9&amp;g){Z=R=N;Q=M;b=0
r=A(0,j,i)
while(b&lt;9&amp;g){s=W(r&lt;1)
s=s[S(L(s))][1:min(L(s),R)]
r[s]=1:L(s);a=0
while(K(r&lt;1)&gt;0&amp;a&lt;(k^2)){a=a+1
s=S(W(r&gt;0&amp;r&lt;=R),1);p=r[s]
Y=H(s)
Y=Y[r[Y]&lt;1]
if(L(Y)){Y=Y[order(m[Y])]
if(K(m[r==p]&gt;1))r[Y[1]]=p else r[Y[L(Y)]]=p}}
if(a&lt;(k^2)){for(v in 1:R){if(K(m[r==v])&gt;0){r[r==v]=max(k,max(r))+1
Q=Q-1;Z=Z-1}}
if(Q&lt;1){g=F
for(v in 1:R)r[r==v]=max(k,max(r))+1
for(v in G(c(r)))g=g|(K(r==v)&lt;4)|(L(G(r[H(W(r==v))]))+C(v))&lt;3}}
b=b+1;r[r&lt;=R]=0;R=Z}
w=w+1}
if(g)cat(U) else{u=G(c(r))
for(v in 1:L(u))r[r==u[v]]=v
cat(paste(apply(A(LETTERS[r],j,i),1,paste,collapse=""),collapse="
"))}}}
</code></pre>

<p><a href="https://tio.run/##dVPbbtpAEH3fr7CQEs3AgrykfSh4kKKIJhIXCUgUGcuVDHGIAYPr5ZJC@HY6axOSVCoP9pydM2dmj4f02KUryxIdqlr8ii0SBdv8lDJPoXLwHp@gEiatTpwsyoE4hf/ESmSVORC2fRYVBSGadHxeL8araLmAruzIGPcPVHgMrVUahU@VSoVJbZqHi8nqRVxTHPD5q3ik7Us0fhEt0utYDEgHcTIPxS2tF9HvdSju6CyqZUK6rHDv0gDGoMtTqUtTmRQhubiYNmyUoEsKi6BziChcz23Yl65DM/8gbj6kNnJHj5ASbRBbsGO@U5W78tSxJexKU2zMUMR0DXqV6mQerSCWhQJ6nvJ9qVBEXBw7NjIuKyYCrOCaORG3R0@qWuRz/3LlOxarInoGaEGMTucSuuUOOgrfGDPBgatiB3EcrOABrXCuw/2UfXkFJRfpcss1KGYUFaf1LU3oXrBT8xC2zo/LCe6H1KduvUed@ohskfKwtpzKCE@sUc7S5prcUWjS3gDaoBF9T9XiaJEB2UdfpJ72SdUMrgcsliu0skK2L3Bg9quKuA8oKClWGgCLciJ1qI/sRz0hIyFcumMJfrle6rm@o3xz@Ta4aL6Z6y3TpzCFmFOYZdgFj79B4jfYNq4w9lKSGWEZaCrNyeFg2OcxnpcpbKxoYalaH/cfOhufp8V9mseZkTNpnikiz92jXlnVhzQsq1ywx9fbT@in@CL4v/Iz6ZZ3j49wQpM3Y5JZIucbvvFFbyH17uB9sXyuuwEOnCtuOKJRSdVZnU3zya73aXgQW9qWVDbM5MsarOnU5fNsbVhjPt7a27AvG2FKkkCvQgiSZP6Hd7DdvL9v9gde6mfLIJXM8nK8nM@DRIfEa/wJiALi4XA4Nk//2ONf" rel="nofollow noreferrer" title="R â€“ Try It Online">Try it online!</a></p>

<p>A massive <s>>900</s> <s>>800</s> (nope!) >900 bytes solution.
The code works as follows. Let N be the number of electoral districts and M the minimum number of district where 1 wishes to have a majority. </p>

<p>First, the code randomly assigns N districts to different groups. Next, it randomly expands them, i.e. adds a district to a randomly selected group, ensuring that the district is next to a district already belonging to that group. In the expansion process, it gives precedence to a district with a 1 majority, if the district group is not yet a full 1 majority; if the group is already a certain 1 majority, then it gives precedence to a 0 district. It continues until all districts have been assigned.</p>

<p>Every group where there is a majority for the 1 party is stored, and its districts are locked. If there are at least M groups with a majority of 1, then everything is good and <s>we can print the result</s> we can check whether there are at least 4 districts in each group. If the cutoff of 4 districts is met, then we can happily print the result. Otherwise, the code tries to reassign the districts that are not locked to as many groups as available, i.e. N - #stored-groups.</p>

<p>The codes tries a few times (9 times). If it fails, it resets everything and starts again. It does so for other 9 times before giving up and printing "we tried...".</p>

<p>If the code does not succeed at first, try again a few times. I tuned the number of repetitions such that it can run in TIO under a minute. However if there is a solution, this code can (eventually) find it. The randomness part of the algorithm gives a non-zero probability that, if there is a solution, it can find it. The limited number of trials is the only limiting factor to success. </p>

<p>EDIT: added the control that no district group can be fully surrounded by just another one, unless the district group has districts on the edge of the given square. I think I missed it at first.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/149516/">149516</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




