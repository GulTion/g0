<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::206169</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>425</td><td>Python3</td><td>240227T182302Z</td><td><a href="https://codegolf.stackexchange.com/questions/206169/what-is-the-fastest-safe-way-down-a-mountain/271353#271353">Ajax1234</a></td></tr>
<tr d-ix="1"><td>185</td><td>J</td><td>200618T165352Z</td><td><a href="https://codegolf.stackexchange.com/questions/206169/what-is-the-fastest-safe-way-down-a-mountain/206265#206265">xash</a></td></tr>
<tr d-ix="2"><td>199</td><td>JavaScript ES6</td><td>200615T222422Z</td><td><a href="https://codegolf.stackexchange.com/questions/206169/what-is-the-fastest-safe-way-down-a-mountain/206181#206181">Arnauld</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>Python3, 425 bytes</h1>
<pre class="lang-py prettyprint-override"><code>E=enumerate
M=[('R',0,1),('L',0,-1),('U',-1,0),('D',1,0)]
def f(B):
 d={(x,y):v for x,r in E(B)for y,v in E(r)}
 q=[(0,0,{},'',2,0,0)]
 for x,y,D,m,l,s,u in q:
  if(x,y)==(len(B)-1,len(B[0])-1):return m
  for T,X,Y in M:
   if(N:=(x+X,y+Y))in d:
    a,b=d[(x,y)],d[N]
    L=a-b in[3,4]and l and not u and m and not s
    if N not in(U:=D.get((x,y),[]))and(0&lt;=a-b&lt;3 or L or b-a==1):q+=[(*N,{**D,(x,y):U+[N]},m+T,l-L,L,b-a==1)]
</code></pre>
<p><a href="https://tio.run/##bVNNa9tAED13f8WQi3btcdBKsiOb7KU4N8eHkkCCKoqMpFZgy44kh5iQ3@7MjISbQ2BY5uO9N28X6XDq/u3rMD405/OdK@rjrmiyrlD3LtHeLw99tAa1t@JsIumjRwn6nC495CxVeVFCqX@ahYLcves3PJnFK5T7Bt6wgaqGOxpyecLXvmzMh4IXWuKT8PsHeh4GlLHYwDvhEne4xRaPTHkhbahK0XZOb4uaJMmIJImfUm4WTdEdmxp2BGWRB3zCZybfM5nZ64XTb@MnPI2fjaFBLgPIcOPyRLRTzJN1Kt2VyyYboichRmlW57AFPut9B0fJdpe6FUJVwlrKqtaPC7e8/lt0WlQxSY0hsPZvWfQ2BLK34mMzyZwj6y9jeozRGt9HoyX2L/g4JicfuBs/4HaywhUO2PTcWnBXV1fK@mDDS6gYYA5gLZfBVPkAN30ZQBCqGcAUIJDwFdPbAByIzowxHD7EMANlI66IQZI@RMCbAk6YbOngXdQQPLV9UHMB0xlMaT4sCIcFDJ2DnbIbv3c5lT2xqISy20o/ppwNkcxcLjAbllIovolsjWCIkKdqUAhZ/Ev0JqIvJmIm909CY/ZkWTqSt/HFEO0O4RKMifuHvOE7hBfTdljJnRuZziQiNkSAwAomkjuLE/5Nuv2fzT5rct3S3/Jj@GCTZLTLDrqqO4Tquj1sq04bk/I3XPH3W1bbrmj0el8XCO0A8H7XHoGUUoeGmLrU/7WtMeabdvB9O/y@HVH7/Ak" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu1" class="pu"><h1><a href="http://jsoftware.com/" rel="nofollow noreferrer">J</a>, 185 bytes</h1>
<p>Far from perfect, but it's something. Could theoretically save 17 bytes by omitting the check for revisiting places, but then the last example ran out of memory on my machine and I couldn't truthfully say all examples were verified. :-)</p>
<p>Takes in the map and outputs a list of offset coordinates <code>1 0,0 1,_1 0,0 _1</code> that I've mapped to <code>DRUL</code> in TIO for easier comparison.</p>
<pre><code>}.@{.@(((](\:+/&quot;2)@#~[*/@((4((1&gt;=&amp;3-_1|.2=])*&gt;&amp;0*3&gt;[:+/\3=])@:|(+:&lt;:i.4)I.0,2-/\({~ ::_&quot;_ 0&lt;&quot;1))*3&gt;[:+/[:=&quot;1/~&lt;&quot;1@])0 2+/\@|:])[:,/((,-)=i.2),~&quot;1 2/])^:(0=&lt;:@$@[-:+/@{.@])^:_&amp;(1 1 2$0))
</code></pre>
<p><a href="https://tio.run/##fZFPb6MwEMXv/hRPtErsBIz/ACFuiJB2tdJKPVXqiVBOW6l7bW9N89XTmQnbvbSVBoSfHzO/Z/89Z3b5iC5hiRwOiZ7C4sfd7a/zm@1fba@1HvUhrcssmP7qNKxKkiqt/b5bxGLyRxu60az2C7eK@4F8h0jrPh31Ou3Sk63Mb@vyUJQH/XpCSlM2we0yb8zsH1KX@fJEUj8ah0Ad@mMazZDyUuu8MN2TDSY/ZR6hHM1D0q7bpf66Hwr6mxFZnBbagxzXzpizOb/8eX7xHMstMntjpwAt4YzyDj5@lGqBLeA9L0OtHLC5LANCVA1QA0HKKaOW97e4@7kEJQlY48riETJK8Tt8PrDhZlwOLRooX/GKWtNshwqMFPiDp1AEMBQJ4ifZQW3FTO9Q0z4JX6MEQYmfonDTLXzNAd0leC1ErcyLQulFb@mb0WngVs6kmfGoFB@O8FWYK/KumjtEbv6/voGNAlt9CdvykMttUGhm50vmgTVEIUPDw/8Ve9rLHW44a/wI52c0Vjay20hVDE6G4MVTydl8g1ypdw" rel="nofollow noreferrer" title="J – Try It Online">Try it online!</a></p>
<h3>How it works</h3>
<pre><code>(1 1 2$0)
</code></pre>
<p>We keep the routes as a list of offsets, starting with <code>0 0</code>.</p>
<pre><code>(…)^:(0 = &lt;:@$@[ -: +/@{.@])^:_
</code></pre>
<p>Do until the head of the list – which is nearest the bottom right – equals the dimensions of the map - 1.</p>
<pre><code>[: ,/ ((,-)=i.2) ,~&quot;1 2/ ]
</code></pre>
<p>Each route gets the 4 offsets added, so we have 4 times as many routes: <code>(0 0,1 0),(0 0,0 1),(0 0,_1 0),(0 0, 0 _1)</code>. Then we have to filter these routes based on several checks.</p>
<pre><code>0 2 +/\@|: ]
</code></pre>
<p>List of offsets -&gt; List of absolute coordinates, transposed so each routes' first points are in one list, then each routes' second points are in one list, etc:</p>
<pre><code>0 0,0 0, 0 0,0  0
1 0,0 1,_1 0,0 _1
</code></pre>
<p>This format seems more suitable for the checks, but maybe a <code>(…)&quot;2</code> would have been enough. However, now each check can build up a matrix saying which coordinate is ok and which not and in the end we can easily reduce it.</p>
<pre><code>3 &gt; [: +/ [: =&quot;1/~ &lt;&quot;1@]
</code></pre>
<p>No place should be visited 3 times. This check is just to keep the number of routes from exploding.</p>
<pre><code>0, 2 -/\ ({~ ::_&quot;_ 0&lt;&quot;1)
</code></pre>
<p>Gets the height values from the map at the absolute coordinates. If something is out of range, it will be replaced with infinity. Then we'll get the diff between neighboring heights and prepend 0 so the matrix will align with the previous one. Now we have (given the first map):</p>
<pre><code>0  0 0 0
2 _3 _ _
</code></pre>
<p>With</p>
<pre><code>4 …@| (+:&lt;:i.4) I.
</code></pre>
<p>we sort the height diffs into 4 categories: 0 = not reachable, 1 = climb up, 2 = gentle slope, 3 = steep slope.</p>
<pre><code>3 &gt; [: +/\ 3=]
</code></pre>
<p>Less then 3 steep slopes.</p>
<pre><code>&gt;&amp;0
</code></pre>
<p>Point must be reachable</p>
<pre><code>1 &gt; =&amp;3 - _1 |. 2 = ]
</code></pre>
<p>3 is only allowed if 2 was in front of it.</p>
<pre><code>] …@ #~ [ */
</code></pre>
<p>A route is only taken if all of its coordinates passed all tests.</p>
<pre><code>(\:+/&quot;2)
</code></pre>
<p>Sort the routes based on their last, absolute coordinate.</p>
<pre><code>}.@{.
</code></pre>
<p>Finally the loop has ended and the first route contains the best route written in offsets, with only a <code>0 0</code> at the top that gets dropped.</p>
</div>
<div id="pu2" class="pu"><h1>JavaScript (ES6), <s> 223 ... 205 </s> 199 bytes</h1>

<pre class="lang-javascript prettyprint-override"><code>f=(m,x=o=0,y=0,n=2,V,s,p='',r=m[y]||0,v=r[x],h=V%32-v%32|0)=&gt;63&gt;&gt;h+1&amp;v&lt;64&amp;!p[o.length-1]?h&lt;3||s*n--?1+r[x+!m[y+1]]?[...'LURD'].map((c,d)=&gt;r[f(m,x+--d%2,y+~-d%2,n,r[x]+=32,6&gt;&gt;h&amp;1,p+c),x]=v)&amp;&amp;o:o=p:0:0
</code></pre>
<p><a href="https://tio.run/##bVJNj6JAEL37K2omGZGlId0Ngx87rRf2ZrIJiXNhORhlxt0oEGGMJmb/ulvVDcjs7qEkXa/qvVdV/lqf1tXm@LOs3bzYZrfbmxod2FkVirMLRq4ke2UVK5VlsaM6JJf0euXspI7JOWU79frkS/eEP1duq3noz@c7RwxPL2EwfCiTwttn@Xu9c0W62L3412v1JXfdhXCw23lAMkek6SLxPM9aruLISr3DuhyNNmyLZMfkjaw4rrt9kuzi/NbfnJGyo3zJQhQbClY6G5udU3Wyh8NiVqhyxmf8VmdVDQqQASob1Bw2RV4V@8zbF@8j6/tHXX7UADADCxxAIRs/1o/827nMNnW2bYDKZC3762BAjKMBQAKJ4AyE34@UIYLYhAFMMYQwiHxuEWyBcYtIRLqeELPPGLIJDilo7DGKoyiO48eB/Uk9NAw6kBY1w5ZLBCZPnOQF4aDD8CEp0eigEdn3TVjDRzU8ZWDAaUNGX4lOJYGtxYgsruI4@tumpsMWgR00NG9Xg@8QOlMTY0qvUZpKXTWhd1cVMq08bZYY3kcAceeSrBsiMEPo8Kn6XtUq@cbTp@hWH@vV0/aj/801MSrtMXlHPm2SjTTdlfdnpUn8xpOOfuek/Y@Mzer8f7Yk7t7vIFWPDbWOoHdY6pKi6QyaS/SPRyPGq@VytaQrxpTBgW9/AA" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<h2>Commented</h2>
<p>The 5 least significant bits of the cells are left unchanged. The upper bits are used to count the number of times a cell has been visited in a given path.</p>
<p>We need quite a lot of variables to fully describe the skier status at any given time, notably the possibility to do a big steep slope.</p>
<h3>Header</h3>
<pre class="lang-javascript prettyprint-override"><code>f = (                      // a recursive function taking:
  m,                       //   m[] = input matrix
  x =                      //   (x, y) = current position, starting at (0, 0)
  o = 0,                   //   o = output string, initialized to a numerical value
  y = 0,                   //
  n = 2,                   //   n = remaining number of big steep slopes
  V,                       //   V = value of the previous cell
  s,                       //   s = a flag that is set if a big steep slope is allowed
                           //       for this turn
  p = '',                  //   p = current path string
  r = m[y] || 0,           //   r[] = current row (using 0 as a fallback)
  v = r[x],                //   v = value of the current cell (or undefined)
  h = V % 32 - v % 32 | 0  //   h = height between the previous and the current cell
) =&gt;                       //       (0 if V is undefined)
  (...)                    //
</code></pre>
<h3>Tests</h3>
<pre class="lang-javascript prettyprint-override"><code>63 &gt;&gt; h + 1 &amp;              // if the height is greater than or equal to -1 and less
                           // than or equal to 4 and
v &lt; 64 &amp;                   // v is defined and less than 64 and
!p[o.length - 1] ?         // the current path is shorter than the best solution or
                           // we don't have a solution yet (in which case o.length - 1
                           // is NaN):
  h &lt; 3 ||                 //   if the height is less than 3 or
  s * n-- ?                //   a big steep slope is allowed and we can still do one:
    1 + r[x + !m[y + 1]] ? //     if we haven't reached the bottom-right cell,
                           //     i.e. m[y + 1] is defined or 1 + r[x + 1] is not NaN:
      (...)                //       process the recursive calls
    :                      //     else:
      o = p                //       update the solution to this path
  :                        //   else:
    0                      //     do nothing
:                          // else:
  0                        //   do nothing
</code></pre>
<h3>Recursive calls</h3>
<pre class="lang-javascript prettyprint-override"><code>[...'LURD'].map((c, d) =&gt;  // for each direction character c at index d:
  r[                       //   we will eventually restore r[x]
    f(                     //     recursive call:
      m,                   //       m[] is unchanged
      x + --d % 2,         //       add dx to x
      y + ~-d % 2,         //       add dy to y
      n,                   //       n is unchanged
      r[x] += 32,          //       add 32 to the current cell
      6 &gt;&gt; h &amp; 1,          //       set s if h is either 1 or 2
      p + c                //       append c to the path
    ),                     //     end of recursive call
    x                      //     restore r[x] to ...
  ] = v                    //   ... v
) &amp;&amp; o                     // end of map(); yield o
</code></pre>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/206169/">206169</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




